---

title: OOD Experiment


keywords: fastai
sidebar: home_sidebar

summary: "Can we get better by training on our assumptions?"
description: "Can we get better by training on our assumptions?"
nb_path: "09c_ood_experiment.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 09c_ood_experiment.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Appended /home/blackhc/PycharmProjects/bald-ical/src to paths
Switched to directory /home/blackhc/PycharmProjects/bald-ical
%load_ext autoreload
%autoreload 2
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Import modules and functions were are going to use.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">dataclasses</span>
<span class="kn">import</span> <span class="nn">traceback</span>
<span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Type</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">torch.utils.data</span>
<span class="kn">from</span> <span class="nn">blackhc.project</span> <span class="kn">import</span> <span class="n">is_run_from_ipython</span>
<span class="kn">from</span> <span class="nn">blackhc.project.experiment</span> <span class="kn">import</span> <span class="n">embedded_experiments</span>
<span class="kn">from</span> <span class="nn">torch.utils.data</span> <span class="kn">import</span> <span class="n">Dataset</span>

<span class="kn">import</span> <span class="nn">batchbald_redux.acquisition_functions</span> <span class="k">as</span> <span class="nn">acquisition_functions</span>
<span class="kn">from</span> <span class="nn">batchbald_redux.acquisition_functions</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">CandidateBatchComputer</span><span class="p">,</span>
    <span class="n">EvalCandidateBatchComputer</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">batchbald_redux.active_learning</span> <span class="kn">import</span> <span class="n">ActiveLearningData</span><span class="p">,</span> <span class="n">RandomFixedLengthSampler</span>
<span class="kn">from</span> <span class="nn">batchbald_redux.black_box_model_training</span> <span class="kn">import</span> <span class="n">evaluate</span><span class="p">,</span> <span class="n">train</span>
<span class="kn">from</span> <span class="nn">batchbald_redux.dataset_challenges</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">AdditiveGaussianNoise</span><span class="p">,</span>
    <span class="n">AliasDataset</span><span class="p">,</span>
    <span class="n">NamedDataset</span><span class="p">,</span>
    <span class="n">create_named_mnist</span><span class="p">,</span>
    <span class="n">get_balanced_sample_indices_by_class</span><span class="p">,</span>
    <span class="n">get_base_dataset_index</span><span class="p">,</span>
    <span class="n">get_target</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">batchbald_redux.datasets</span> <span class="kn">import</span> <span class="n">train_validation_split</span>
<span class="kn">from</span> <span class="nn">batchbald_redux.di</span> <span class="kn">import</span> <span class="n">DependencyInjection</span>
<span class="kn">from</span> <span class="nn">batchbald_redux.fast_mnist</span> <span class="kn">import</span> <span class="n">FastFashionMNIST</span><span class="p">,</span> <span class="n">FastMNIST</span>
<span class="kn">from</span> <span class="nn">batchbald_redux.model_optimizer_factory</span> <span class="kn">import</span> <span class="n">ModelOptimizerFactory</span>
<span class="kn">from</span> <span class="nn">batchbald_redux.models</span> <span class="kn">import</span> <span class="n">MnistOptimizerFactory</span>
<span class="kn">from</span> <span class="nn">batchbald_redux.train_eval_model</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">TrainEvalModel</span><span class="p">,</span>
    <span class="n">TrainSelfDistillationEvalModel</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">batchbald_redux.trained_model</span> <span class="kn">import</span> <span class="n">TrainedMCDropoutModel</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="ExperimentData" class="doc_header"><code>class</code> <code>ExperimentData</code><a href="https://github.com/blackhc/batchbald_redux/tree/master/batchbald_redux/ood_experiment.py#L49" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>ExperimentData</code>(<strong><code>active_learning</code></strong>:<a href="/batchbald_redux/active_learning.html#ActiveLearningData"><code>ActiveLearningData</code></a>, <strong><code>ood_dataset</code></strong>:<a href="/batchbald_redux/dataset_challenges.html#NamedDataset"><code>NamedDataset</code></a>, <strong><code>validation_dataset</code></strong>:<code>Dataset</code>, <strong><code>test_dataset</code></strong>:<code>Dataset</code>, <strong><code>evaluation_dataset</code></strong>:<code>Dataset</code>, <strong><code>initial_training_set_indices</code></strong>:<code>[&lt;class 'int'&gt;]</code>, <strong><code>evaluation_set_indices</code></strong>:<code>[&lt;class 'int'&gt;]</code>)</p>
</blockquote>
<p>ExperimentData(active_learning: batchbald_redux.active_learning.ActiveLearningData, ood_dataset: batchbald_redux.dataset_challenges.NamedDataset, validation_dataset: torch.utils.data.dataset.Dataset, test_dataset: torch.utils.data.dataset.Dataset, evaluation_dataset: torch.utils.data.dataset.Dataset, initial_training_set_indices: [&lt;class 'int'&gt;], evaluation_set_indices: [&lt;class 'int'&gt;])</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="ExperimentDataConfig" class="doc_header"><code>class</code> <code>ExperimentDataConfig</code><a href="https://github.com/blackhc/batchbald_redux/tree/master/batchbald_redux/ood_experiment.py#L60" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>ExperimentDataConfig</code>(<strong><code>uniform_ood</code></strong>:<code>bool</code>, <strong><code>id_dataset_type</code></strong>:<code>Union</code>[<code>Type</code>[<a href="/batchbald_redux/fast_mnist.html#FastMNIST"><code>FastMNIST</code></a>], <code>Type</code>[<a href="/batchbald_redux/fast_mnist.html#FastFashionMNIST"><code>FastFashionMNIST</code></a>]], <strong><code>ood_dataset_type</code></strong>:<code>Union</code>[<code>Type</code>[<a href="/batchbald_redux/fast_mnist.html#FastMNIST"><code>FastMNIST</code></a>], <code>Type</code>[<a href="/batchbald_redux/fast_mnist.html#FastFashionMNIST"><code>FastFashionMNIST</code></a>]], <strong><code>initial_training_set_size</code></strong>:<code>int</code>, <strong><code>validation_set_size</code></strong>:<code>int</code>, <strong><code>evaluation_set_size</code></strong>:<code>int</code>, <strong><code>id_repetitions</code></strong>:<code>float</code>, <strong><code>ood_repetitions</code></strong>:<code>float</code>, <strong><code>add_dataset_noise</code></strong>:<code>bool</code>, <strong><code>validation_split_random_state</code></strong>:<code>int</code>, <strong><code>device</code></strong>:<code>str</code>)</p>
</blockquote>
<p>ExperimentDataConfig(uniform_ood: bool, id_dataset_type: Union[Type[batchbald_redux.fast_mnist.FastMNIST], Type[batchbald_redux.fast_mnist.FastFashionMNIST]], ood_dataset_type: Union[Type[batchbald_redux.fast_mnist.FastMNIST], Type[batchbald_redux.fast_mnist.FastFashionMNIST]], initial_training_set_size: int, validation_set_size: int, evaluation_set_size: int, id_repetitions: float, ood_repetitions: float, add_dataset_noise: bool, validation_split_random_state: int, device: str)</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="load_experiment_data" class="doc_header"><code>load_experiment_data</code><a href="https://github.com/blackhc/batchbald_redux/tree/master/batchbald_redux/ood_experiment.py#L91" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>load_experiment_data</code>(<strong><code>id_dataset_type</code></strong>:<code>Union</code>[<code>Type</code>[<a href="/batchbald_redux/fast_mnist.html#FastMNIST"><code>FastMNIST</code></a>], <code>Type</code>[<a href="/batchbald_redux/fast_mnist.html#FastFashionMNIST"><code>FastFashionMNIST</code></a>]], <strong><code>ood_dataset_type</code></strong>:<code>Union</code>[<code>Type</code>[<a href="/batchbald_redux/fast_mnist.html#FastMNIST"><code>FastMNIST</code></a>], <code>Type</code>[<a href="/batchbald_redux/fast_mnist.html#FastFashionMNIST"><code>FastFashionMNIST</code></a>]], <strong><code>initial_training_set_size</code></strong>:<code>int</code>, <strong><code>validation_set_size</code></strong>:<code>int</code>, <strong><code>evaluation_set_size</code></strong>:<code>int</code>, <strong><code>id_repetitions</code></strong>:<code>float</code>, <strong><code>ood_repetitions</code></strong>:<code>float</code>, <strong><code>add_dataset_noise</code></strong>:<code>bool</code>, <strong><code>validation_split_random_state</code></strong>:<code>int</code>, <strong><code>device</code></strong>:<code>str</code>, <strong><code>uniform_ood</code></strong>:<code>bool</code>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">ExperimentData</span><span class="p">:</span>
    <span class="n">active_learning</span><span class="p">:</span> <span class="n">ActiveLearningData</span>
    <span class="n">ood_dataset</span><span class="p">:</span> <span class="n">NamedDataset</span>
    <span class="n">validation_dataset</span><span class="p">:</span> <span class="n">Dataset</span>
    <span class="n">test_dataset</span><span class="p">:</span> <span class="n">Dataset</span>
    <span class="n">evaluation_dataset</span><span class="p">:</span> <span class="n">Dataset</span>
    <span class="n">initial_training_set_indices</span><span class="p">:</span> <span class="p">[</span><span class="nb">int</span><span class="p">]</span>
    <span class="n">evaluation_set_indices</span><span class="p">:</span> <span class="p">[</span><span class="nb">int</span><span class="p">]</span>


<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">ExperimentDataConfig</span><span class="p">:</span>
    <span class="n">uniform_ood</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">id_dataset_type</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">FastMNIST</span><span class="p">],</span> <span class="n">Type</span><span class="p">[</span><span class="n">FastFashionMNIST</span><span class="p">]]</span>
    <span class="n">ood_dataset_type</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">FastMNIST</span><span class="p">],</span> <span class="n">Type</span><span class="p">[</span><span class="n">FastFashionMNIST</span><span class="p">]]</span>

    <span class="n">initial_training_set_size</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">validation_set_size</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">evaluation_set_size</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">id_repetitions</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">ood_repetitions</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">add_dataset_noise</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">validation_split_random_state</span><span class="p">:</span> <span class="nb">int</span>

    <span class="n">device</span><span class="p">:</span> <span class="nb">str</span>

    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ExperimentData</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">load_experiment_data</span><span class="p">(</span>
            <span class="n">id_dataset_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id_dataset_type</span><span class="p">,</span>
            <span class="n">ood_dataset_type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ood_dataset_type</span><span class="p">,</span>
            <span class="n">initial_training_set_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">initial_training_set_size</span><span class="p">,</span>
            <span class="n">validation_set_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">validation_set_size</span><span class="p">,</span>
            <span class="n">evaluation_set_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">evaluation_set_size</span><span class="p">,</span>
            <span class="n">id_repetitions</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id_repetitions</span><span class="p">,</span>
            <span class="n">ood_repetitions</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ood_repetitions</span><span class="p">,</span>
            <span class="n">add_dataset_noise</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">add_dataset_noise</span><span class="p">,</span>
            <span class="n">uniform_ood</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">uniform_ood</span><span class="p">,</span>
            <span class="n">validation_split_random_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">validation_split_random_state</span><span class="p">,</span>
            <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span>
        <span class="p">)</span>


<span class="k">def</span> <span class="nf">load_experiment_data</span><span class="p">(</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">id_dataset_type</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">FastMNIST</span><span class="p">],</span> <span class="n">Type</span><span class="p">[</span><span class="n">FastFashionMNIST</span><span class="p">]],</span>
    <span class="n">ood_dataset_type</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">FastMNIST</span><span class="p">],</span> <span class="n">Type</span><span class="p">[</span><span class="n">FastFashionMNIST</span><span class="p">]],</span>
    <span class="n">initial_training_set_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">validation_set_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">evaluation_set_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">id_repetitions</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">ood_repetitions</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">add_dataset_noise</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
    <span class="n">validation_split_random_state</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">device</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">uniform_ood</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ExperimentData</span><span class="p">:</span>
    <span class="n">id_name</span> <span class="o">=</span> <span class="n">id_dataset_type</span><span class="o">.</span><span class="vm">__name__</span>
    <span class="n">ood_name</span> <span class="o">=</span> <span class="n">ood_dataset_type</span><span class="o">.</span><span class="vm">__name__</span>

    <span class="n">full_train_dataset</span> <span class="o">=</span> <span class="n">create_named_mnist</span><span class="p">(</span><span class="n">id_dataset_type</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">train</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">download</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>

    <span class="n">train_dataset</span><span class="p">,</span> <span class="n">validation_dataset</span> <span class="o">=</span> <span class="n">train_validation_split</span><span class="p">(</span>
        <span class="n">full_train_dataset</span><span class="o">=</span><span class="n">full_train_dataset</span><span class="p">,</span>
        <span class="n">full_validation_dataset</span><span class="o">=</span><span class="n">full_train_dataset</span><span class="p">,</span>
        <span class="n">train_labels</span><span class="o">=</span><span class="n">full_train_dataset</span><span class="o">.</span><span class="n">get_targets</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">(),</span>
        <span class="n">validation_set_size</span><span class="o">=</span><span class="n">validation_set_size</span><span class="p">,</span>
        <span class="n">validation_split_random_state</span><span class="o">=</span><span class="n">validation_split_random_state</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">train_dataset</span> <span class="o">=</span> <span class="n">AliasDataset</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">id_name</span><span class="si">}</span><span class="s2"> (train; </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">)</span><span class="si">}</span><span class="s2"> samples)&quot;</span><span class="p">)</span>
    <span class="n">validation_dataset</span> <span class="o">=</span> <span class="n">AliasDataset</span><span class="p">(</span><span class="n">validation_dataset</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ood_name</span><span class="si">}</span><span class="s2"> (validation; </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">validation_dataset</span><span class="p">)</span><span class="si">}</span><span class="s2"> samples)&quot;</span><span class="p">)</span>

    <span class="c1"># If we reduce the train set, we need to do so before picking the initial train set.</span>
    <span class="k">if</span> <span class="n">id_repetitions</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">train_dataset</span> <span class="o">=</span> <span class="n">train_dataset</span> <span class="o">*</span> <span class="n">id_repetitions</span>

    <span class="n">num_classes</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="o">.</span><span class="n">get_num_classes</span><span class="p">()</span>
    <span class="n">initial_samples_per_class</span> <span class="o">=</span> <span class="n">initial_training_set_size</span> <span class="o">//</span> <span class="n">num_classes</span>
    <span class="n">evaluation_set_samples_per_class</span> <span class="o">=</span> <span class="n">evaluation_set_size</span> <span class="o">//</span> <span class="n">num_classes</span>
    <span class="n">samples_per_class</span> <span class="o">=</span> <span class="n">initial_samples_per_class</span> <span class="o">+</span> <span class="n">evaluation_set_samples_per_class</span>
    <span class="n">balanced_samples_indices</span> <span class="o">=</span> <span class="n">get_balanced_sample_indices_by_class</span><span class="p">(</span>
        <span class="n">train_dataset</span><span class="p">,</span>
        <span class="n">num_classes</span><span class="o">=</span><span class="n">num_classes</span><span class="p">,</span>
        <span class="n">samples_per_class</span><span class="o">=</span><span class="n">samples_per_class</span><span class="p">,</span>
        <span class="n">seed</span><span class="o">=</span><span class="n">validation_split_random_state</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">initial_training_set_indices</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">idx</span> <span class="k">for</span> <span class="n">by_class</span> <span class="ow">in</span> <span class="n">balanced_samples_indices</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">by_class</span><span class="p">[:</span><span class="n">initial_samples_per_class</span><span class="p">]</span>
    <span class="p">]</span>
    <span class="n">evaluation_set_indices</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">idx</span> <span class="k">for</span> <span class="n">by_class</span> <span class="ow">in</span> <span class="n">balanced_samples_indices</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">by_class</span><span class="p">[</span><span class="n">initial_samples_per_class</span><span class="p">:]</span>
    <span class="p">]</span>

    <span class="c1"># If we over-sample the train set, we do so after picking the initial train set to avoid duplicates.</span>
    <span class="k">if</span> <span class="n">id_repetitions</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">train_dataset</span> <span class="o">=</span> <span class="n">train_dataset</span> <span class="o">*</span> <span class="n">id_repetitions</span>

    <span class="n">original_ood_dataset</span> <span class="o">=</span> <span class="n">create_named_mnist</span><span class="p">(</span><span class="n">ood_dataset_type</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">train</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">download</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">uniform_ood</span><span class="p">:</span>
        <span class="n">train_dataset</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="o">.</span><span class="n">one_hot</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
        <span class="n">ood_dataset</span> <span class="o">=</span> <span class="n">original_ood_dataset</span><span class="o">.</span><span class="n">uniform_target</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ood_dataset</span> <span class="o">=</span> <span class="n">original_ood_dataset</span><span class="o">.</span><span class="n">constant_target</span><span class="p">(</span>
            <span class="n">target</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">),</span> <span class="n">num_classes</span><span class="o">=</span><span class="n">train_dataset</span><span class="o">.</span><span class="n">get_num_classes</span><span class="p">()</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">ood_repetitions</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">ood_dataset</span> <span class="o">=</span> <span class="n">ood_dataset</span> <span class="o">*</span> <span class="n">ood_repetitions</span>

    <span class="n">train_dataset</span> <span class="o">=</span> <span class="n">train_dataset</span> <span class="o">+</span> <span class="n">ood_dataset</span>

    <span class="k">if</span> <span class="n">add_dataset_noise</span><span class="p">:</span>
        <span class="n">train_dataset</span> <span class="o">=</span> <span class="n">AdditiveGaussianNoise</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>

    <span class="n">test_dataset</span> <span class="o">=</span> <span class="n">create_named_mnist</span><span class="p">(</span><span class="n">id_dataset_type</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">train</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

    <span class="n">active_learning_data</span> <span class="o">=</span> <span class="n">ActiveLearningData</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">)</span>

    <span class="n">active_learning_data</span><span class="o">.</span><span class="n">acquire_base_indices</span><span class="p">(</span><span class="n">initial_training_set_indices</span><span class="p">)</span>

    <span class="n">evaluation_dataset</span> <span class="o">=</span> <span class="n">AliasDataset</span><span class="p">(</span>
        <span class="n">active_learning_data</span><span class="o">.</span><span class="n">extract_dataset_from_base_indices</span><span class="p">(</span><span class="n">evaluation_set_indices</span><span class="p">),</span>
        <span class="sa">f</span><span class="s2">&quot;Evaluation Set (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">evaluation_set_indices</span><span class="p">)</span><span class="si">}</span><span class="s2"> samples)&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">ExperimentData</span><span class="p">(</span>
        <span class="n">active_learning</span><span class="o">=</span><span class="n">active_learning_data</span><span class="p">,</span>
        <span class="n">ood_dataset</span><span class="o">=</span><span class="n">original_ood_dataset</span><span class="p">,</span>
        <span class="n">validation_dataset</span><span class="o">=</span><span class="n">validation_dataset</span><span class="p">,</span>
        <span class="n">test_dataset</span><span class="o">=</span><span class="n">test_dataset</span><span class="p">,</span>
        <span class="n">evaluation_dataset</span><span class="o">=</span><span class="n">evaluation_dataset</span><span class="p">,</span>
        <span class="n">initial_training_set_indices</span><span class="o">=</span><span class="n">initial_training_set_indices</span><span class="p">,</span>
        <span class="n">evaluation_set_indices</span><span class="o">=</span><span class="n">evaluation_set_indices</span><span class="p">,</span>
    <span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="OodExperiment" class="doc_header"><code>class</code> <code>OodExperiment</code><a href="https://github.com/blackhc/batchbald_redux/tree/master/batchbald_redux/ood_experiment.py#L189" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>OodExperiment</code>(<strong><code>seed</code></strong>:<code>int</code>, <strong><code>uniform_ood</code></strong>:<code>bool</code>, <strong><code>id_dataset_type</code></strong>:<code>Union</code>[<code>Type</code>[<a href="/batchbald_redux/fast_mnist.html#FastMNIST"><code>FastMNIST</code></a>], <code>Type</code>[<a href="/batchbald_redux/fast_mnist.html#FastFashionMNIST"><code>FastFashionMNIST</code></a>]], <strong><code>ood_dataset_type</code></strong>:<code>Union</code>[<code>Type</code>[<a href="/batchbald_redux/fast_mnist.html#FastMNIST"><code>FastMNIST</code></a>], <code>Type</code>[<a href="/batchbald_redux/fast_mnist.html#FastFashionMNIST"><code>FastFashionMNIST</code></a>]], <strong><code>initial_training_set_size</code></strong>:<code>int</code>=<em><code>20</code></em>, <strong><code>validation_set_size</code></strong>:<code>int</code>=<em><code>1024</code></em>, <strong><code>evaluation_set_size</code></strong>:<code>int</code>=<em><code>1024</code></em>, <strong><code>id_repetitions</code></strong>:<code>float</code>=<em><code>1</code></em>, <strong><code>ood_repetitions</code></strong>:<code>float</code>=<em><code>1</code></em>, <strong><code>add_dataset_noise</code></strong>:<code>bool</code>=<em><code>False</code></em>, <strong><code>validation_split_random_state</code></strong>:<code>int</code>=<em><code>0</code></em>, <strong><code>acquisition_size</code></strong>:<code>int</code>=<em><code>5</code></em>, <strong><code>max_training_set</code></strong>:<code>int</code>=<em><code>200</code></em>, <strong><code>num_pool_samples</code></strong>:<code>int</code>=<em><code>20</code></em>, <strong><code>num_validation_samples</code></strong>:<code>int</code>=<em><code>20</code></em>, <strong><code>num_training_samples</code></strong>:<code>int</code>=<em><code>1</code></em>, <strong><code>num_patience_epochs</code></strong>:<code>int</code>=<em><code>3</code></em>, <strong><code>max_training_epochs</code></strong>:<code>int</code>=<em><code>30</code></em>, <strong><code>training_batch_size</code></strong>:<code>int</code>=<em><code>64</code></em>, <strong><code>device</code></strong>:<code>str</code>=<em><code>'cuda'</code></em>, <strong><code>min_samples_per_epoch</code></strong>:<code>int</code>=<em><code>5056</code></em>, <strong><code>acquisition_function</code></strong>:<code>Union</code>[<code>Type</code>[<a href="/batchbald_redux/acquisition_functions.html#CandidateBatchComputer"><code>CandidateBatchComputer</code></a>], <code>Type</code>[<a href="/batchbald_redux/acquisition_functions.html#EvalCandidateBatchComputer"><code>EvalCandidateBatchComputer</code></a>]]=<em><code>BALD</code></em>, <strong><code>train_eval_model</code></strong>:<code>Type</code>[<a href="/batchbald_redux/train_eval_model.html#TrainEvalModel"><code>TrainEvalModel</code></a>]=<em><code>TrainSelfDistillationEvalModel</code></em>, <strong><code>model_optimizer_factory</code></strong>:<code>Type</code>[<a href="/batchbald_redux/model_optimizer_factory.html#ModelOptimizerFactory"><code>ModelOptimizerFactory</code></a>]=<em><code>MnistOptimizerFactory</code></em>, <strong><code>acquisition_function_args</code></strong>:<code>dict</code>=<em><code>None</code></em>, <strong><code>temperature</code></strong>:<code>float</code>=<em><code>0.0</code></em>)</p>
</blockquote>
<p>OodExperiment(seed: int, uniform_ood: bool, id_dataset_type: Union[Type[batchbald_redux.fast_mnist.FastMNIST], Type[batchbald_redux.fast_mnist.FastFashionMNIST]], ood_dataset_type: Union[Type[batchbald_redux.fast_mnist.FastMNIST], Type[batchbald_redux.fast_mnist.FastFashionMNIST]], initial_training_set_size: int = 20, validation_set_size: int = 1024, evaluation_set_size: int = 1024, id_repetitions: float = 1, ood_repetitions: float = 1, add_dataset_noise: bool = False, validation_split_random_state: int = 0, acquisition_size: int = 5, max_training_set: int = 200, num_pool_samples: int = 20, num_validation_samples: int = 20, num_training_samples: int = 1, num_patience_epochs: int = 3, max_training_epochs: int = 30, training_batch_size: int = 64, device: str = 'cuda', min_samples_per_epoch: int = 5056, acquisition_function: Union[Type[batchbald_redux.acquisition_functions.CandidateBatchComputer], Type[batchbald_redux.acquisition_functions.EvalCandidateBatchComputer]] = &lt;class 'batchbald_redux.acquisition_functions.BALD'&gt;, train_eval_model: Type[batchbald_redux.train_eval_model.TrainEvalModel] = &lt;class 'batchbald_redux.train_eval_model.TrainSelfDistillationEvalModel'&gt;, model_optimizer_factory: Type[batchbald_redux.model_optimizer_factory.ModelOptimizerFactory] = &lt;class 'batchbald_redux.models.MnistOptimizerFactory'&gt;, acquisition_function_args: dict = None, temperature: float = 0.0)</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">OodExperiment</span><span class="p">:</span>
    <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">uniform_ood</span><span class="p">:</span> <span class="nb">bool</span>

    <span class="n">id_dataset_type</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">FastMNIST</span><span class="p">],</span> <span class="n">Type</span><span class="p">[</span><span class="n">FastFashionMNIST</span><span class="p">]]</span>
    <span class="n">ood_dataset_type</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="n">FastMNIST</span><span class="p">],</span> <span class="n">Type</span><span class="p">[</span><span class="n">FastFashionMNIST</span><span class="p">]]</span>
    <span class="n">initial_training_set_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span>
    <span class="n">validation_set_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1024</span>
    <span class="n">evaluation_set_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1024</span>
    <span class="n">id_repetitions</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">ood_repetitions</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">add_dataset_noise</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">validation_split_random_state</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">acquisition_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">max_training_set</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">200</span>
    <span class="n">num_pool_samples</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span>
    <span class="n">num_validation_samples</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span>
    <span class="n">num_training_samples</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">num_patience_epochs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">max_training_epochs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span>
    <span class="n">training_batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">64</span>
    <span class="n">device</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;cuda&quot;</span>
    <span class="n">min_samples_per_epoch</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5056</span>
    <span class="n">acquisition_function</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
        <span class="n">Type</span><span class="p">[</span><span class="n">CandidateBatchComputer</span><span class="p">],</span> <span class="n">Type</span><span class="p">[</span><span class="n">EvalCandidateBatchComputer</span><span class="p">]</span>
    <span class="p">]</span> <span class="o">=</span> <span class="n">acquisition_functions</span><span class="o">.</span><span class="n">BALD</span>
    <span class="n">train_eval_model</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">TrainEvalModel</span><span class="p">]</span> <span class="o">=</span> <span class="n">TrainSelfDistillationEvalModel</span>
    <span class="n">model_optimizer_factory</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">ModelOptimizerFactory</span><span class="p">]</span> <span class="o">=</span> <span class="n">MnistOptimizerFactory</span>
    <span class="n">acquisition_function_args</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">temperature</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="k">def</span> <span class="nf">load_experiment_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ExperimentData</span><span class="p">:</span>
        <span class="n">di</span> <span class="o">=</span> <span class="n">DependencyInjection</span><span class="p">(</span><span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="n">edc</span><span class="p">:</span> <span class="n">ExperimentDataConfig</span> <span class="o">=</span> <span class="n">di</span><span class="o">.</span><span class="n">create_dataclass_type</span><span class="p">(</span><span class="n">ExperimentDataConfig</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">edc</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>

    <span class="c1"># Simple Dependency Injection</span>
    <span class="k">def</span> <span class="nf">create_acquisition_function</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">di</span> <span class="o">=</span> <span class="n">DependencyInjection</span><span class="p">(</span><span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">di</span><span class="o">.</span><span class="n">create_dataclass_type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">acquisition_function</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">create_train_eval_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">runtime_config</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TrainEvalModel</span><span class="p">:</span>
        <span class="n">config</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="o">**</span><span class="n">runtime_config</span><span class="p">}</span>
        <span class="n">di</span> <span class="o">=</span> <span class="n">DependencyInjection</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">return</span> <span class="n">di</span><span class="o">.</span><span class="n">create_dataclass_type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_eval_model</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">store</span><span class="p">):</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>

        <span class="c1"># Active Learning setup</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_experiment_data</span><span class="p">()</span>
        <span class="n">store</span><span class="p">[</span><span class="s2">&quot;dataset_info&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">training</span><span class="o">=</span><span class="nb">repr</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">active_learning</span><span class="o">.</span><span class="n">base_dataset</span><span class="p">),</span> <span class="n">test</span><span class="o">=</span><span class="nb">repr</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">test_dataset</span><span class="p">))</span>
        <span class="n">store</span><span class="p">[</span><span class="s2">&quot;initial_training_set_indices&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">initial_training_set_indices</span>
        <span class="n">store</span><span class="p">[</span><span class="s2">&quot;evaluation_set_indices&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">evaluation_set_indices</span>

        <span class="n">train_loader</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">(</span>
            <span class="n">data</span><span class="o">.</span><span class="n">active_learning</span><span class="o">.</span><span class="n">training_dataset</span><span class="p">,</span>
            <span class="n">batch_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">training_batch_size</span><span class="p">,</span>
            <span class="n">sampler</span><span class="o">=</span><span class="n">RandomFixedLengthSampler</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">active_learning</span><span class="o">.</span><span class="n">training_dataset</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_samples_per_epoch</span><span class="p">),</span>
            <span class="n">drop_last</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">pool_loader</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">(</span>
            <span class="n">data</span><span class="o">.</span><span class="n">active_learning</span><span class="o">.</span><span class="n">pool_dataset</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">drop_last</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>

        <span class="n">validation_loader</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">validation_dataset</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">drop_last</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">test_loader</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">test_dataset</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">drop_last</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">store</span><span class="p">[</span><span class="s2">&quot;active_learning_steps&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">active_learning_steps</span> <span class="o">=</span> <span class="n">store</span><span class="p">[</span><span class="s2">&quot;active_learning_steps&quot;</span><span class="p">]</span>

        <span class="n">acquisition_function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_acquisition_function</span><span class="p">()</span>

        <span class="n">num_iterations</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">max_iterations</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">1.5</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_training_set</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_training_set_size</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">acquisition_size</span><span class="p">)</span>

        <span class="c1"># Active Training Loop</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">training_set_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">active_learning</span><span class="o">.</span><span class="n">training_dataset</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Training set size </span><span class="si">{</span><span class="n">training_set_size</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>

            <span class="c1"># iteration_log = dict(training={}, pool_training={}, evaluation_metrics=None, acquisition=None)</span>
            <span class="n">active_learning_steps</span><span class="o">.</span><span class="n">append</span><span class="p">({})</span>
            <span class="n">iteration_log</span> <span class="o">=</span> <span class="n">active_learning_steps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

            <span class="n">iteration_log</span><span class="p">[</span><span class="s2">&quot;training&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="n">model_optimizer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_optimizer_factory</span><span class="p">()</span><span class="o">.</span><span class="n">create_model_optimizer</span><span class="p">()</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">uniform_ood</span><span class="p">:</span>
                <span class="n">loss</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">KLDivLoss</span><span class="p">(</span><span class="n">log_target</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">reduction</span><span class="o">=</span><span class="s2">&quot;batchmean&quot;</span><span class="p">)</span>
                <span class="n">validation_loss</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">NLLLoss</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">loss</span> <span class="o">=</span> <span class="n">validation_loss</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">NLLLoss</span><span class="p">()</span>

            <span class="n">train</span><span class="p">(</span>
                <span class="n">model</span><span class="o">=</span><span class="n">model_optimizer</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
                <span class="n">optimizer</span><span class="o">=</span><span class="n">model_optimizer</span><span class="o">.</span><span class="n">optimizer</span><span class="p">,</span>
                <span class="n">training_samples</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_training_samples</span><span class="p">,</span>
                <span class="n">validation_samples</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_validation_samples</span><span class="p">,</span>
                <span class="n">train_loader</span><span class="o">=</span><span class="n">train_loader</span><span class="p">,</span>
                <span class="n">validation_loader</span><span class="o">=</span><span class="n">validation_loader</span><span class="p">,</span>
                <span class="n">patience</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_patience_epochs</span><span class="p">,</span>
                <span class="n">max_epochs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_training_epochs</span><span class="p">,</span>
                <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span>
                <span class="n">training_log</span><span class="o">=</span><span class="n">iteration_log</span><span class="p">[</span><span class="s2">&quot;training&quot;</span><span class="p">],</span>
                <span class="n">loss</span><span class="o">=</span><span class="n">loss</span><span class="p">,</span>
                <span class="n">validation_loss</span><span class="o">=</span><span class="n">validation_loss</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">evaluation_metrics</span> <span class="o">=</span> <span class="n">evaluate</span><span class="p">(</span>
                <span class="n">model</span><span class="o">=</span><span class="n">model_optimizer</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
                <span class="n">num_samples</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_validation_samples</span><span class="p">,</span>
                <span class="n">loader</span><span class="o">=</span><span class="n">test_loader</span><span class="p">,</span>
                <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">iteration_log</span><span class="p">[</span><span class="s2">&quot;evaluation_metrics&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">evaluation_metrics</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Perf after training </span><span class="si">{</span><span class="n">evaluation_metrics</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">training_set_size</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_training_set</span> <span class="ow">or</span> <span class="n">num_iterations</span> <span class="o">&gt;=</span> <span class="n">max_iterations</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Done.&quot;</span><span class="p">)</span>
                <span class="k">break</span>

            <span class="n">trained_model</span> <span class="o">=</span> <span class="n">TrainedMCDropoutModel</span><span class="p">(</span><span class="n">num_samples</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_pool_samples</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">model_optimizer</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">acquisition_function</span><span class="p">,</span> <span class="n">CandidateBatchComputer</span><span class="p">):</span>
                <span class="n">candidate_batch</span> <span class="o">=</span> <span class="n">acquisition_function</span><span class="o">.</span><span class="n">compute_candidate_batch</span><span class="p">(</span><span class="n">trained_model</span><span class="p">,</span> <span class="n">pool_loader</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">acquisition_function</span><span class="p">,</span> <span class="n">EvalCandidateBatchComputer</span><span class="p">):</span>
                <span class="n">current_max_epochs</span> <span class="o">=</span> <span class="n">iteration_log</span><span class="p">[</span><span class="s2">&quot;training&quot;</span><span class="p">][</span><span class="s2">&quot;best_epoch&quot;</span><span class="p">]</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_set_size</span><span class="p">:</span>
                    <span class="n">eval_dataset</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">evaluation_dataset</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">eval_dataset</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">active_learning</span><span class="o">.</span><span class="n">pool_dataset</span>

                <span class="n">train_eval_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_train_eval_model</span><span class="p">(</span>
                    <span class="nb">dict</span><span class="p">(</span>
                        <span class="n">max_epochs</span><span class="o">=</span><span class="n">current_max_epochs</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="n">training_dataset</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">active_learning</span><span class="o">.</span><span class="n">training_dataset</span><span class="p">,</span>
                        <span class="n">eval_dataset</span><span class="o">=</span><span class="n">eval_dataset</span><span class="p">,</span>
                        <span class="n">validation_loader</span><span class="o">=</span><span class="n">validation_loader</span><span class="p">,</span>
                        <span class="n">trained_model</span><span class="o">=</span><span class="n">trained_model</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>

                <span class="n">iteration_log</span><span class="p">[</span><span class="s2">&quot;eval_training&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">trained_eval_model</span> <span class="o">=</span> <span class="n">train_eval_model</span><span class="p">(</span><span class="n">training_log</span><span class="o">=</span><span class="n">iteration_log</span><span class="p">[</span><span class="s2">&quot;eval_training&quot;</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>

                <span class="n">candidate_batch</span> <span class="o">=</span> <span class="n">acquisition_function</span><span class="o">.</span><span class="n">compute_candidate_batch</span><span class="p">(</span>
                    <span class="n">trained_model</span><span class="p">,</span> <span class="n">trained_eval_model</span><span class="p">,</span> <span class="n">pool_loader</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown acquisition function </span><span class="si">{</span><span class="n">acquisition_function</span><span class="si">}</span><span class="s2">!&quot;</span><span class="p">)</span>

            <span class="n">candidate_global_dataset_indices</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">candidate_labels</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">candidate_batch</span><span class="o">.</span><span class="n">indices</span><span class="p">:</span>
                <span class="n">base_di</span> <span class="o">=</span> <span class="n">get_base_dataset_index</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">active_learning</span><span class="o">.</span><span class="n">pool_dataset</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
                <span class="n">dataset_type</span> <span class="o">=</span> <span class="s2">&quot;ood&quot;</span> <span class="k">if</span> <span class="n">base_di</span><span class="o">.</span><span class="n">dataset</span> <span class="o">==</span> <span class="n">data</span><span class="o">.</span><span class="n">ood_dataset</span> <span class="k">else</span> <span class="s2">&quot;id&quot;</span>
                <span class="n">candidate_global_dataset_indices</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">dataset_type</span><span class="p">,</span> <span class="n">base_di</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
                <span class="n">label</span> <span class="o">=</span> <span class="n">get_target</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">active_learning</span><span class="o">.</span><span class="n">pool_dataset</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
                <span class="n">candidate_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>

            <span class="n">iteration_log</span><span class="p">[</span><span class="s2">&quot;acquisition&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">indices</span><span class="o">=</span><span class="n">candidate_global_dataset_indices</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">candidate_labels</span><span class="p">,</span> <span class="n">scores</span><span class="o">=</span><span class="n">candidate_batch</span><span class="o">.</span><span class="n">scores</span>
            <span class="p">)</span>

            <span class="nb">print</span><span class="p">(</span><span class="n">candidate_batch</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">candidate_global_dataset_indices</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">uniform_ood</span><span class="p">:</span>
                <span class="n">data</span><span class="o">.</span><span class="n">active_learning</span><span class="o">.</span><span class="n">acquire</span><span class="p">(</span><span class="n">candidate_batch</span><span class="o">.</span><span class="n">indices</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">data</span><span class="o">.</span><span class="n">active_learning</span><span class="o">.</span><span class="n">acquire</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">index</span> <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">candidate_batch</span><span class="o">.</span><span class="n">indices</span><span class="p">,</span> <span class="n">candidate_labels</span><span class="p">)</span> <span class="k">if</span> <span class="n">label</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="p">)</span>

            <span class="n">ls</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">score</span><span class="si">:</span><span class="s2">.4</span><span class="si">}</span><span class="s2">)&quot;</span> <span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">score</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">candidate_labels</span><span class="p">,</span> <span class="n">candidate_batch</span><span class="o">.</span><span class="n">scores</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Acquiring (label, score)s: </span><span class="si">{</span><span class="n">ls</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="n">num_iterations</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span>
    <span class="n">OodExperiment</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s2">&quot;cpu&quot;</span><span class="p">,</span> <span class="n">id_dataset_type</span><span class="o">=</span><span class="n">FastMNIST</span><span class="p">,</span> <span class="n">ood_dataset</span><span class="o">=</span><span class="n">FastFashionMNIST</span><span class="p">,</span> <span class="n">uniform_ood</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="o">.</span><span class="n">load_experiment_data</span><span class="p">()</span>
    <span class="o">.</span><span class="n">active_learning</span><span class="o">.</span><span class="n">base_dataset</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span>
    <span class="n">OodExperiment</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s2">&quot;cpu&quot;</span><span class="p">,</span> <span class="n">id_dataset_type</span><span class="o">=</span><span class="n">FastMNIST</span><span class="p">,</span> <span class="n">ood_dataset</span><span class="o">=</span><span class="n">FastFashionMNIST</span><span class="p">,</span> <span class="n">uniform_ood</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="o">.</span><span class="n">load_experiment_data</span><span class="p">()</span>
    <span class="o">.</span><span class="n">active_learning</span><span class="o">.</span><span class="n">base_dataset</span>
<span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Creating: ExperimentDataConfig(
	uniform_ood=False,
	id_dataset_type=&lt;class &#39;batchbald_redux.fast_mnist.FastMNIST&#39;&gt;,
	ood_dataset_type=&lt;class &#39;batchbald_redux.fast_mnist.FastFashionMNIST&#39;&gt;,
	initial_training_set_size=20,
	validation_set_size=1024,
	evaluation_set_size=1024,
	id_repetitions=1,
	ood_repetitions=1,
	add_dataset_noise=False,
	validation_split_random_state=0,
	device=cpu
)
(FastMNIST (train; 58976 samples)) + (&#39;FastFashionMNIST Train (60000 samples)&#39; | constant_target{&#39;target&#39;: tensor(-1), &#39;num_classes&#39;: 10})
Creating: ExperimentDataConfig(
	uniform_ood=True,
	id_dataset_type=&lt;class &#39;batchbald_redux.fast_mnist.FastMNIST&#39;&gt;,
	ood_dataset_type=&lt;class &#39;batchbald_redux.fast_mnist.FastFashionMNIST&#39;&gt;,
	initial_training_set_size=20,
	validation_set_size=1024,
	evaluation_set_size=1024,
	id_repetitions=1,
	ood_repetitions=1,
	add_dataset_noise=False,
	validation_split_random_state=0,
	device=cpu
)
(FastMNIST (train; 58976 samples) | one_hot_targets{&#39;num_classes&#39;: 10}) + (&#39;FastFashionMNIST Train (60000 samples)&#39; | uniform_targets{&#39;num_classes&#39;: 10})
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">experiment</span> <span class="o">=</span> <span class="n">OodExperiment</span><span class="p">(</span>
    <span class="n">uniform_ood</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">id_dataset_type</span><span class="o">=</span><span class="n">FastMNIST</span><span class="p">,</span>
    <span class="n">ood_dataset</span><span class="o">=</span><span class="n">FastFashionMNIST</span><span class="p">,</span>
    <span class="n">seed</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">max_training_epochs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">max_training_set</span><span class="o">=</span><span class="mi">20</span> <span class="o">+</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">acquisition_function</span><span class="o">=</span><span class="n">acquisition_functions</span><span class="o">.</span><span class="n">BALD</span><span class="p">,</span>
    <span class="n">evaluation_set_size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">acquisition_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">num_pool_samples</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">temperature</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">device</span><span class="o">=</span><span class="s2">&quot;cuda&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">experiment</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
<span class="n">results</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Creating: ExperimentDataConfig(
	uniform_ood=True,
	id_dataset_type=&lt;class &#39;batchbald_redux.fast_mnist.FastMNIST&#39;&gt;,
	ood_dataset_type=&lt;class &#39;batchbald_redux.fast_mnist.FastFashionMNIST&#39;&gt;,
	initial_training_set_size=20,
	validation_set_size=1024,
	evaluation_set_size=100,
	id_repetitions=1,
	ood_repetitions=1,
	add_dataset_noise=False,
	validation_split_random_state=0,
	device=cuda
)
Creating: BALD(
	acquisition_size=10
)
Training set size 20:
Epoch metrics: {&#39;accuracy&#39;: 0.634765625, &#39;crossentropy&#39;: 2.1894690990448}
RestoringEarlyStopping: Restoring best parameters. (Score: 0.634765625)
RestoringEarlyStopping: Restoring optimizer.
Perf after training {&#39;accuracy&#39;: 0.6565, &#39;crossentropy&#39;: 2.054827853393555}
CandidateBatch(scores=[0.6930233091115952, 0.6929996777325869, 0.6929977312684059, 0.6929853782057762, 0.692970871925354, 0.6929508233442903, 0.6929328721016645, 0.6929304301738739, 0.6929165720939636, 0.6928967721760273], indices=[37754, 20802, 26425, 51966, 46199, 33347, 5448, 13296, 21745, 4910])
[(&#39;id&#39;, 46785), (&#39;id&#39;, 36269), (&#39;id&#39;, 46751), (&#39;id&#39;, 58402), (&#39;id&#39;, 46535), (&#39;id&#39;, 45952), (&#39;id&#39;, 47902), (&#39;id&#39;, 34634), (&#39;id&#39;, 21910), (&#39;id&#39;, 5884)]
Acquiring (label, score)s: tensor([1., 0., 0., 0., 0., 0., 0., 0., 0., 0.], device=&#39;cuda:0&#39;) (0.693), tensor([1., 0., 0., 0., 0., 0., 0., 0., 0., 0.], device=&#39;cuda:0&#39;) (0.693), tensor([1., 0., 0., 0., 0., 0., 0., 0., 0., 0.], device=&#39;cuda:0&#39;) (0.693), tensor([1., 0., 0., 0., 0., 0., 0., 0., 0., 0.], device=&#39;cuda:0&#39;) (0.693), tensor([1., 0., 0., 0., 0., 0., 0., 0., 0., 0.], device=&#39;cuda:0&#39;) (0.693), tensor([1., 0., 0., 0., 0., 0., 0., 0., 0., 0.], device=&#39;cuda:0&#39;) (0.693), tensor([1., 0., 0., 0., 0., 0., 0., 0., 0., 0.], device=&#39;cuda:0&#39;) (0.6929), tensor([1., 0., 0., 0., 0., 0., 0., 0., 0., 0.], device=&#39;cuda:0&#39;) (0.6929), tensor([1., 0., 0., 0., 0., 0., 0., 0., 0., 0.], device=&#39;cuda:0&#39;) (0.6929), tensor([1., 0., 0., 0., 0., 0., 0., 0., 0., 0.], device=&#39;cuda:0&#39;) (0.6929)
Training set size 30:
Epoch metrics: {&#39;accuracy&#39;: 0.6337890625, &#39;crossentropy&#39;: 2.4598926305770874}
RestoringEarlyStopping: Restoring best parameters. (Score: 0.6337890625)
RestoringEarlyStopping: Restoring optimizer.
Perf after training {&#39;accuracy&#39;: 0.6611, &#39;crossentropy&#39;: 2.2145120666503906}
Done.
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;dataset_info&#39;: {&#39;training&#39;: &#34;(FastMNIST (train; 58976 samples) | one_hot_targets{&#39;num_classes&#39;: 10}) + (&#39;FastFashionMNIST Train (60000 samples)&#39; | uniform_targets{&#39;num_classes&#39;: 10})&#34;,
  &#39;test&#39;: &#34;&#39;FastMNIST Test (10000 samples)&#39;&#34;},
 &#39;initial_training_set_indices&#39;: [53434,
  8533,
  14640,
  39579,
  30392,
  58125,
  37915,
  3091,
  57520,
  43803,
  44119,
  52296,
  58226,
  40334,
  46037,
  22015,
  22304,
  43812,
  12640,
  53689],
 &#39;evaluation_set_indices&#39;: [29974,
  55573,
  35472,
  44048,
  48031,
  5616,
  10110,
  47420,
  56990,
  34198,
  3792,
  5715,
  15969,
  32775,
  19757,
  34588,
  28991,
  47417,
  26501,
  12108,
  5573,
  48032,
  40646,
  43252,
  2404,
  36797,
  29079,
  40018,
  37047,
  41512,
  45567,
  801,
  10664,
  52801,
  42890,
  32972,
  45974,
  20801,
  23496,
  5803,
  10508,
  46870,
  49549,
  306,
  38725,
  13074,
  19689,
  27135,
  16068,
  18137,
  2728,
  43321,
  29950,
  380,
  27254,
  50466,
  31965,
  24052,
  44454,
  20076,
  21423,
  58741,
  27145,
  38430,
  37354,
  49986,
  4321,
  12610,
  34482,
  35794,
  396,
  50036,
  46861,
  57811,
  53831,
  49304,
  51555,
  29614,
  767,
  23451,
  49512,
  26479,
  50997,
  1774,
  44803,
  55187,
  30013,
  33736,
  49169,
  46464,
  31444,
  52440,
  33486,
  2206,
  15675,
  54426,
  9574,
  54012,
  28833,
  44428],
 &#39;active_learning_steps&#39;: [{&#39;training&#39;: {&#39;epochs&#39;: [{&#39;accuracy&#39;: 0.634765625,
      &#39;crossentropy&#39;: 2.1894690990448}],
    &#39;best_epoch&#39;: 1},
   &#39;evaluation_metrics&#39;: {&#39;accuracy&#39;: 0.6565,
    &#39;crossentropy&#39;: 2.054827853393555},
   &#39;acquisition&#39;: {&#39;indices&#39;: [(&#39;id&#39;, 46785),
     (&#39;id&#39;, 36269),
     (&#39;id&#39;, 46751),
     (&#39;id&#39;, 58402),
     (&#39;id&#39;, 46535),
     (&#39;id&#39;, 45952),
     (&#39;id&#39;, 47902),
     (&#39;id&#39;, 34634),
     (&#39;id&#39;, 21910),
     (&#39;id&#39;, 5884)],
    &#39;labels&#39;: [tensor([1., 0., 0., 0., 0., 0., 0., 0., 0., 0.], device=&#39;cuda:0&#39;),
     tensor([1., 0., 0., 0., 0., 0., 0., 0., 0., 0.], device=&#39;cuda:0&#39;),
     tensor([1., 0., 0., 0., 0., 0., 0., 0., 0., 0.], device=&#39;cuda:0&#39;),
     tensor([1., 0., 0., 0., 0., 0., 0., 0., 0., 0.], device=&#39;cuda:0&#39;),
     tensor([1., 0., 0., 0., 0., 0., 0., 0., 0., 0.], device=&#39;cuda:0&#39;),
     tensor([1., 0., 0., 0., 0., 0., 0., 0., 0., 0.], device=&#39;cuda:0&#39;),
     tensor([1., 0., 0., 0., 0., 0., 0., 0., 0., 0.], device=&#39;cuda:0&#39;),
     tensor([1., 0., 0., 0., 0., 0., 0., 0., 0., 0.], device=&#39;cuda:0&#39;),
     tensor([1., 0., 0., 0., 0., 0., 0., 0., 0., 0.], device=&#39;cuda:0&#39;),
     tensor([1., 0., 0., 0., 0., 0., 0., 0., 0., 0.], device=&#39;cuda:0&#39;)],
    &#39;scores&#39;: [0.6930233091115952,
     0.6929996777325869,
     0.6929977312684059,
     0.6929853782057762,
     0.692970871925354,
     0.6929508233442903,
     0.6929328721016645,
     0.6929304301738739,
     0.6929165720939636,
     0.6928967721760273]}},
  {&#39;training&#39;: {&#39;epochs&#39;: [{&#39;accuracy&#39;: 0.6337890625,
      &#39;crossentropy&#39;: 2.4598926305770874}],
    &#39;best_epoch&#39;: 1},
   &#39;evaluation_metrics&#39;: {&#39;accuracy&#39;: 0.6611,
    &#39;crossentropy&#39;: 2.2145120666503906}}]}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">experiment</span> <span class="o">=</span> <span class="n">OodExperiment</span><span class="p">(</span>
    <span class="n">uniform_ood</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">id_dataset_type</span><span class="o">=</span><span class="n">FastMNIST</span><span class="p">,</span>
    <span class="n">ood_dataset</span><span class="o">=</span><span class="n">FastFashionMNIST</span><span class="p">,</span>
    <span class="n">seed</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">max_training_epochs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">max_training_set</span><span class="o">=</span><span class="mi">20</span> <span class="o">+</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">acquisition_function</span><span class="o">=</span><span class="n">acquisition_functions</span><span class="o">.</span><span class="n">BALD</span><span class="p">,</span>
    <span class="n">evaluation_set_size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">acquisition_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">num_pool_samples</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">temperature</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">device</span><span class="o">=</span><span class="s2">&quot;cuda&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">experiment</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
<span class="n">results</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Creating: ExperimentDataConfig(
	uniform_ood=False,
	id_dataset_type=&lt;class &#39;batchbald_redux.fast_mnist.FastMNIST&#39;&gt;,
	ood_dataset_type=&lt;class &#39;batchbald_redux.fast_mnist.FastFashionMNIST&#39;&gt;,
	initial_training_set_size=20,
	validation_set_size=1024,
	evaluation_set_size=100,
	id_repetitions=1,
	ood_repetitions=1,
	add_dataset_noise=False,
	validation_split_random_state=0,
	device=cuda
)
Creating: BALD(
	acquisition_size=10
)
Training set size 20:
Epoch metrics: {&#39;accuracy&#39;: 0.6328125, &#39;crossentropy&#39;: 2.2057557106018066}
RestoringEarlyStopping: Restoring best parameters. (Score: 0.6328125)
RestoringEarlyStopping: Restoring optimizer.
Perf after training {&#39;accuracy&#39;: 0.6557, &#39;crossentropy&#39;: 2.067915026473999}
CandidateBatch(scores=[0.6930213868618011, 0.6930111590772867, 0.6930059990845621, 0.6929988877382129, 0.6929858811199665, 0.69298055768013, 0.6929786503314972, 0.6929723918437958, 0.6929657161235809, 0.6929287277162075], indices=[37754, 20802, 5448, 184, 51966, 13296, 26425, 46199, 21745, 4910])
[(&#39;id&#39;, 46785), (&#39;id&#39;, 36269), (&#39;id&#39;, 47902), (&#39;id&#39;, 26859), (&#39;id&#39;, 58402), (&#39;id&#39;, 34634), (&#39;id&#39;, 46751), (&#39;id&#39;, 46535), (&#39;id&#39;, 21910), (&#39;id&#39;, 5884)]
Acquiring (label, score)s: 0 (0.693), 0 (0.693), 0 (0.693), 0 (0.693), 0 (0.693), 0 (0.693), 0 (0.693), 0 (0.693), 0 (0.693), 0 (0.6929)
Training set size 30:
Epoch metrics: {&#39;accuracy&#39;: 0.611328125, &#39;crossentropy&#39;: 2.4593361616134644}
RestoringEarlyStopping: Restoring best parameters. (Score: 0.611328125)
RestoringEarlyStopping: Restoring optimizer.
Perf after training {&#39;accuracy&#39;: 0.6549, &#39;crossentropy&#39;: 2.1096548225402834}
Done.
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;dataset_info&#39;: {&#39;training&#39;: &#34;(FastMNIST (train; 58976 samples)) + (&#39;FastFashionMNIST Train (60000 samples)&#39; | constant_target{&#39;target&#39;: tensor(-1, device=&#39;cuda:0&#39;), &#39;num_classes&#39;: 10})&#34;,
  &#39;test&#39;: &#34;&#39;FastMNIST Test (10000 samples)&#39;&#34;},
 &#39;initial_training_set_indices&#39;: [53434,
  8533,
  14640,
  39579,
  30392,
  58125,
  37915,
  3091,
  57520,
  43803,
  44119,
  52296,
  58226,
  40334,
  46037,
  22015,
  22304,
  43812,
  12640,
  53689],
 &#39;evaluation_set_indices&#39;: [29974,
  55573,
  35472,
  44048,
  48031,
  5616,
  10110,
  47420,
  56990,
  34198,
  3792,
  5715,
  15969,
  32775,
  19757,
  34588,
  28991,
  47417,
  26501,
  12108,
  5573,
  48032,
  40646,
  43252,
  2404,
  36797,
  29079,
  40018,
  37047,
  41512,
  45567,
  801,
  10664,
  52801,
  42890,
  32972,
  45974,
  20801,
  23496,
  5803,
  10508,
  46870,
  49549,
  306,
  38725,
  13074,
  19689,
  27135,
  16068,
  18137,
  2728,
  43321,
  29950,
  380,
  27254,
  50466,
  31965,
  24052,
  44454,
  20076,
  21423,
  58741,
  27145,
  38430,
  37354,
  49986,
  4321,
  12610,
  34482,
  35794,
  396,
  50036,
  46861,
  57811,
  53831,
  49304,
  51555,
  29614,
  767,
  23451,
  49512,
  26479,
  50997,
  1774,
  44803,
  55187,
  30013,
  33736,
  49169,
  46464,
  31444,
  52440,
  33486,
  2206,
  15675,
  54426,
  9574,
  54012,
  28833,
  44428],
 &#39;active_learning_steps&#39;: [{&#39;training&#39;: {&#39;epochs&#39;: [{&#39;accuracy&#39;: 0.6328125,
      &#39;crossentropy&#39;: 2.2057557106018066}],
    &#39;best_epoch&#39;: 1},
   &#39;evaluation_metrics&#39;: {&#39;accuracy&#39;: 0.6557,
    &#39;crossentropy&#39;: 2.067915026473999},
   &#39;acquisition&#39;: {&#39;indices&#39;: [(&#39;id&#39;, 46785),
     (&#39;id&#39;, 36269),
     (&#39;id&#39;, 47902),
     (&#39;id&#39;, 26859),
     (&#39;id&#39;, 58402),
     (&#39;id&#39;, 34634),
     (&#39;id&#39;, 46751),
     (&#39;id&#39;, 46535),
     (&#39;id&#39;, 21910),
     (&#39;id&#39;, 5884)],
    &#39;labels&#39;: [tensor(0, device=&#39;cuda:0&#39;),
     tensor(0, device=&#39;cuda:0&#39;),
     tensor(0, device=&#39;cuda:0&#39;),
     tensor(0, device=&#39;cuda:0&#39;),
     tensor(0, device=&#39;cuda:0&#39;),
     tensor(0, device=&#39;cuda:0&#39;),
     tensor(0, device=&#39;cuda:0&#39;),
     tensor(0, device=&#39;cuda:0&#39;),
     tensor(0, device=&#39;cuda:0&#39;),
     tensor(0, device=&#39;cuda:0&#39;)],
    &#39;scores&#39;: [0.6930213868618011,
     0.6930111590772867,
     0.6930059990845621,
     0.6929988877382129,
     0.6929858811199665,
     0.69298055768013,
     0.6929786503314972,
     0.6929723918437958,
     0.6929657161235809,
     0.6929287277162075]}},
  {&#39;training&#39;: {&#39;epochs&#39;: [{&#39;accuracy&#39;: 0.611328125,
      &#39;crossentropy&#39;: 2.4593361616134644}],
    &#39;best_epoch&#39;: 1},
   &#39;evaluation_metrics&#39;: {&#39;accuracy&#39;: 0.6549,
    &#39;crossentropy&#39;: 2.1096548225402834}}]}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">experiment</span> <span class="o">=</span> <span class="n">OodExperiment</span><span class="p">(</span>
    <span class="n">uniform_ood</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">id_dataset_type</span><span class="o">=</span><span class="n">FastMNIST</span><span class="p">,</span>
    <span class="n">ood_dataset</span><span class="o">=</span><span class="n">FastFashionMNIST</span><span class="p">,</span>
    <span class="n">seed</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">max_training_epochs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">max_training_set</span><span class="o">=</span><span class="mi">20</span> <span class="o">+</span> <span class="mi">10</span><span class="p">,</span>
    <span class="n">acquisition_function</span><span class="o">=</span><span class="n">acquisition_functions</span><span class="o">.</span><span class="n">EvalBALD</span><span class="p">,</span>
    <span class="n">evaluation_set_size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">acquisition_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">num_pool_samples</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">temperature</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">device</span><span class="o">=</span><span class="s2">&quot;cuda&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">experiment</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
<span class="n">results</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Creating: ExperimentDataConfig(
	uniform_ood=False,
	id_dataset_type=&lt;class &#39;batchbald_redux.fast_mnist.FastMNIST&#39;&gt;,
	ood_dataset_type=&lt;class &#39;batchbald_redux.fast_mnist.FastFashionMNIST&#39;&gt;,
	initial_training_set_size=20,
	validation_set_size=1024,
	evaluation_set_size=100,
	id_repetitions=1,
	ood_repetitions=1,
	add_dataset_noise=False,
	validation_split_random_state=0,
	device=cuda
)
Creating: EvalBALD(
	acquisition_size=10
)
Training set size 20:
Epoch metrics: {&#39;accuracy&#39;: 0.6328125, &#39;crossentropy&#39;: 2.1983988285064697}
RestoringEarlyStopping: Restoring best parameters. (Score: 0.6328125)
RestoringEarlyStopping: Restoring optimizer.
Perf after training {&#39;accuracy&#39;: 0.6559, &#39;crossentropy&#39;: 2.0655145431518553}
Creating: TrainSelfDistillationEvalModel(
	num_pool_samples=2,
	num_training_samples=1,
	num_validation_samples=20,
	num_patience_epochs=3,
	max_epochs=3,
	training_dataset=&lt;torch.utils.data.dataset.Subset object at 0x7fdc2a2f6520&gt;,
	eval_dataset=Evaluation Set (100 samples),
	validation_loader=&lt;torch.utils.data.dataloader.DataLoader object at 0x7fdc2a2f6f40&gt;,
	training_batch_size=64,
	model_optimizer_factory=&lt;class &#39;batchbald_redux.models.MnistOptimizerFactory&#39;&gt;,
	trained_model=TrainedMCDropoutModel(num_samples=2, model=BayesianMNISTCNN(
  (conv1): Conv2d(1, 32, kernel_size=(5, 5), stride=(1, 1))
  (conv1_drop): ConsistentMCDropout2d(p=0.5)
  (conv2): Conv2d(32, 64, kernel_size=(5, 5), stride=(1, 1))
  (conv2_drop): ConsistentMCDropout2d(p=0.5)
  (fc1): Linear(in_features=1024, out_features=128, bias=True)
  (fc1_drop): ConsistentMCDropout(p=0.5)
  (fc2): Linear(in_features=128, out_features=10, bias=True)
)),
	min_samples_per_epoch=5056
)
Epoch metrics: {&#39;accuracy&#39;: 0.5966796875, &#39;crossentropy&#39;: 1.5679776072502136}
Epoch metrics: {&#39;accuracy&#39;: 0.5908203125, &#39;crossentropy&#39;: 1.7015655040740967}
RestoringEarlyStopping: 1 / 3
Epoch metrics: {&#39;accuracy&#39;: 0.5869140625, &#39;crossentropy&#39;: 1.7359371781349182}
RestoringEarlyStopping: 2 / 3
RestoringEarlyStopping: Restoring best parameters. (Score: 0.5966796875)
RestoringEarlyStopping: Restoring optimizer.
CandidateBatch(scores=[0.6806451752781868, 0.6790880858898163, 0.6763254124671221, 0.6758237481117249, 0.675022229552269, 0.6749783530831337, 0.6741648018360138, 0.6734838634729385, 0.6730879247188568, 0.6723472699522972], indices=[54855, 56792, 22122, 40241, 10674, 15235, 14226, 26593, 14211, 1276])
[(&#39;id&#39;, 55525), (&#39;id&#39;, 45346), (&#39;id&#39;, 8446), (&#39;id&#39;, 28278), (&#39;id&#39;, 54369), (&#39;id&#39;, 51180), (&#39;id&#39;, 53366), (&#39;id&#39;, 16103), (&#39;id&#39;, 13247), (&#39;id&#39;, 55629)]
Acquiring (label, score)s: 2 (0.6806), 2 (0.6791), 2 (0.6763), 2 (0.6758), 9 (0.675), 7 (0.675), 2 (0.6742), 9 (0.6735), 9 (0.6731), 2 (0.6723)
Training set size 30:
Epoch metrics: {&#39;accuracy&#39;: 0.6474609375, &#39;crossentropy&#39;: 2.016913414001465}
RestoringEarlyStopping: Restoring best parameters. (Score: 0.6474609375)
RestoringEarlyStopping: Restoring optimizer.
Perf after training {&#39;accuracy&#39;: 0.6889, &#39;crossentropy&#39;: 1.9067923236846924}
Done.
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;dataset_info&#39;: {&#39;training&#39;: &#34;(FastMNIST (train; 58976 samples)) + (&#39;FastFashionMNIST Train (60000 samples)&#39; | constant_target{&#39;target&#39;: tensor(-1, device=&#39;cuda:0&#39;), &#39;num_classes&#39;: 10})&#34;,
  &#39;test&#39;: &#34;&#39;FastMNIST Test (10000 samples)&#39;&#34;},
 &#39;initial_training_set_indices&#39;: [53434,
  8533,
  14640,
  39579,
  30392,
  58125,
  37915,
  3091,
  57520,
  43803,
  44119,
  52296,
  58226,
  40334,
  46037,
  22015,
  22304,
  43812,
  12640,
  53689],
 &#39;evaluation_set_indices&#39;: [29974,
  55573,
  35472,
  44048,
  48031,
  5616,
  10110,
  47420,
  56990,
  34198,
  3792,
  5715,
  15969,
  32775,
  19757,
  34588,
  28991,
  47417,
  26501,
  12108,
  5573,
  48032,
  40646,
  43252,
  2404,
  36797,
  29079,
  40018,
  37047,
  41512,
  45567,
  801,
  10664,
  52801,
  42890,
  32972,
  45974,
  20801,
  23496,
  5803,
  10508,
  46870,
  49549,
  306,
  38725,
  13074,
  19689,
  27135,
  16068,
  18137,
  2728,
  43321,
  29950,
  380,
  27254,
  50466,
  31965,
  24052,
  44454,
  20076,
  21423,
  58741,
  27145,
  38430,
  37354,
  49986,
  4321,
  12610,
  34482,
  35794,
  396,
  50036,
  46861,
  57811,
  53831,
  49304,
  51555,
  29614,
  767,
  23451,
  49512,
  26479,
  50997,
  1774,
  44803,
  55187,
  30013,
  33736,
  49169,
  46464,
  31444,
  52440,
  33486,
  2206,
  15675,
  54426,
  9574,
  54012,
  28833,
  44428],
 &#39;active_learning_steps&#39;: [{&#39;training&#39;: {&#39;epochs&#39;: [{&#39;accuracy&#39;: 0.6328125,
      &#39;crossentropy&#39;: 2.1983988285064697}],
    &#39;best_epoch&#39;: 1},
   &#39;evaluation_metrics&#39;: {&#39;accuracy&#39;: 0.6559,
    &#39;crossentropy&#39;: 2.0655145431518553},
   &#39;eval_training&#39;: {&#39;epochs&#39;: [{&#39;accuracy&#39;: 0.5966796875,
      &#39;crossentropy&#39;: 1.5679776072502136},
     {&#39;accuracy&#39;: 0.5908203125, &#39;crossentropy&#39;: 1.7015655040740967},
     {&#39;accuracy&#39;: 0.5869140625, &#39;crossentropy&#39;: 1.7359371781349182}],
    &#39;best_epoch&#39;: 1},
   &#39;acquisition&#39;: {&#39;indices&#39;: [(&#39;id&#39;, 55525),
     (&#39;id&#39;, 45346),
     (&#39;id&#39;, 8446),
     (&#39;id&#39;, 28278),
     (&#39;id&#39;, 54369),
     (&#39;id&#39;, 51180),
     (&#39;id&#39;, 53366),
     (&#39;id&#39;, 16103),
     (&#39;id&#39;, 13247),
     (&#39;id&#39;, 55629)],
    &#39;labels&#39;: [tensor(2, device=&#39;cuda:0&#39;),
     tensor(2, device=&#39;cuda:0&#39;),
     tensor(2, device=&#39;cuda:0&#39;),
     tensor(2, device=&#39;cuda:0&#39;),
     tensor(9, device=&#39;cuda:0&#39;),
     tensor(7, device=&#39;cuda:0&#39;),
     tensor(2, device=&#39;cuda:0&#39;),
     tensor(9, device=&#39;cuda:0&#39;),
     tensor(9, device=&#39;cuda:0&#39;),
     tensor(2, device=&#39;cuda:0&#39;)],
    &#39;scores&#39;: [0.6806451752781868,
     0.6790880858898163,
     0.6763254124671221,
     0.6758237481117249,
     0.675022229552269,
     0.6749783530831337,
     0.6741648018360138,
     0.6734838634729385,
     0.6730879247188568,
     0.6723472699522972]}},
  {&#39;training&#39;: {&#39;epochs&#39;: [{&#39;accuracy&#39;: 0.6474609375,
      &#39;crossentropy&#39;: 2.016913414001465}],
    &#39;best_epoch&#39;: 1},
   &#39;evaluation_metrics&#39;: {&#39;accuracy&#39;: 0.6889,
    &#39;crossentropy&#39;: 1.9067923236846924}}]}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">configs</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">OodExperiment</span><span class="p">(</span>
        <span class="n">seed</span><span class="o">=</span><span class="n">seed</span> <span class="o">+</span> <span class="mi">1234</span><span class="p">,</span>
        <span class="n">uniform_ood</span><span class="o">=</span><span class="n">uniform_ood</span><span class="p">,</span>
        <span class="n">acquisition_function</span><span class="o">=</span><span class="n">acquisition_function</span><span class="p">,</span>
        <span class="n">acquisition_size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
        <span class="n">num_pool_samples</span><span class="o">=</span><span class="n">num_pool_samples</span><span class="p">,</span>
        <span class="n">evaluation_set_size</span><span class="o">=</span><span class="n">evaluation_set_size</span><span class="p">,</span>
        <span class="n">temperature</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
        <span class="n">id_dataset_type</span><span class="o">=</span><span class="n">id_dataset_type</span><span class="p">,</span>
        <span class="n">ood_dataset_type</span><span class="o">=</span><span class="n">ood_dataset_type</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">seed</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">acquisition_function</span> <span class="ow">in</span> <span class="p">[</span><span class="n">acquisition_functions</span><span class="o">.</span><span class="n">BatchEvalBALD</span><span class="p">,</span> <span class="n">acquisition_functions</span><span class="o">.</span><span class="n">BatchBALD</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">evaluation_set_size</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">16</span><span class="p">,</span> <span class="mi">256</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">num_pool_samples</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">100</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">uniform_ood</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">True</span><span class="p">,</span> <span class="kc">False</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">id_dataset_type</span><span class="p">,</span> <span class="n">ood_dataset_type</span> <span class="ow">in</span> <span class="p">[(</span><span class="n">FastMNIST</span><span class="p">,</span> <span class="n">FastFashionMNIST</span><span class="p">),</span> <span class="p">(</span><span class="n">FastFashionMNIST</span><span class="p">,</span> <span class="n">FastMNIST</span><span class="p">)]</span>
<span class="p">]</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">is_run_from_ipython</span><span class="p">()</span> <span class="ow">and</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">job_id</span><span class="p">,</span> <span class="n">store</span> <span class="ow">in</span> <span class="n">embedded_experiments</span><span class="p">(</span><span class="vm">__file__</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">configs</span><span class="p">)):</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">configs</span><span class="p">[</span><span class="n">job_id</span><span class="p">]</span>
        <span class="n">config</span><span class="o">.</span><span class="n">seed</span> <span class="o">+=</span> <span class="n">job_id</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
        <span class="n">store</span><span class="p">[</span><span class="s2">&quot;config&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataclasses</span><span class="o">.</span><span class="n">asdict</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
        <span class="n">store</span><span class="p">[</span><span class="s2">&quot;log&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">config</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">store</span><span class="o">=</span><span class="n">store</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">store</span><span class="p">[</span><span class="s2">&quot;exception&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span>
            <span class="k">raise</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">configs</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>80</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">prettyprinter</span>

<span class="n">prettyprinter</span><span class="o">.</span><span class="n">install_extras</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;dataclasses&quot;</span><span class="p">})</span>

<span class="n">prettyprinter</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">configs</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[
    OodExperiment(
        seed=1234,
        uniform_ood=True,
        id_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        evaluation_set_size=16,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchEvalBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1234,
        uniform_ood=True,
        id_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        evaluation_set_size=16,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchEvalBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1234,
        uniform_ood=False,
        id_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        evaluation_set_size=16,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchEvalBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1234,
        uniform_ood=False,
        id_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        evaluation_set_size=16,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchEvalBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1234,
        uniform_ood=True,
        id_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        evaluation_set_size=256,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchEvalBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1234,
        uniform_ood=True,
        id_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        evaluation_set_size=256,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchEvalBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1234,
        uniform_ood=False,
        id_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        evaluation_set_size=256,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchEvalBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1234,
        uniform_ood=False,
        id_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        evaluation_set_size=256,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchEvalBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1234,
        uniform_ood=True,
        id_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        evaluation_set_size=16,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1234,
        uniform_ood=True,
        id_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        evaluation_set_size=16,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1234,
        uniform_ood=False,
        id_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        evaluation_set_size=16,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1234,
        uniform_ood=False,
        id_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        evaluation_set_size=16,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1234,
        uniform_ood=True,
        id_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        evaluation_set_size=256,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1234,
        uniform_ood=True,
        id_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        evaluation_set_size=256,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1234,
        uniform_ood=False,
        id_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        evaluation_set_size=256,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1234,
        uniform_ood=False,
        id_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        evaluation_set_size=256,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1235,
        uniform_ood=True,
        id_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        evaluation_set_size=16,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchEvalBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1235,
        uniform_ood=True,
        id_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        evaluation_set_size=16,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchEvalBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1235,
        uniform_ood=False,
        id_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        evaluation_set_size=16,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchEvalBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1235,
        uniform_ood=False,
        id_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        evaluation_set_size=16,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchEvalBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1235,
        uniform_ood=True,
        id_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        evaluation_set_size=256,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchEvalBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1235,
        uniform_ood=True,
        id_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        evaluation_set_size=256,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchEvalBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1235,
        uniform_ood=False,
        id_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        evaluation_set_size=256,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchEvalBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1235,
        uniform_ood=False,
        id_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        evaluation_set_size=256,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchEvalBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1235,
        uniform_ood=True,
        id_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        evaluation_set_size=16,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1235,
        uniform_ood=True,
        id_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        evaluation_set_size=16,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1235,
        uniform_ood=False,
        id_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        evaluation_set_size=16,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1235,
        uniform_ood=False,
        id_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        evaluation_set_size=16,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1235,
        uniform_ood=True,
        id_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        evaluation_set_size=256,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1235,
        uniform_ood=True,
        id_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        evaluation_set_size=256,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1235,
        uniform_ood=False,
        id_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        evaluation_set_size=256,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1235,
        uniform_ood=False,
        id_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        evaluation_set_size=256,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1236,
        uniform_ood=True,
        id_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        evaluation_set_size=16,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchEvalBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1236,
        uniform_ood=True,
        id_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        evaluation_set_size=16,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchEvalBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1236,
        uniform_ood=False,
        id_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        evaluation_set_size=16,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchEvalBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1236,
        uniform_ood=False,
        id_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        evaluation_set_size=16,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchEvalBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1236,
        uniform_ood=True,
        id_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        evaluation_set_size=256,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchEvalBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1236,
        uniform_ood=True,
        id_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        evaluation_set_size=256,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchEvalBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1236,
        uniform_ood=False,
        id_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        evaluation_set_size=256,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchEvalBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1236,
        uniform_ood=False,
        id_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        evaluation_set_size=256,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchEvalBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1236,
        uniform_ood=True,
        id_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        evaluation_set_size=16,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1236,
        uniform_ood=True,
        id_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        evaluation_set_size=16,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1236,
        uniform_ood=False,
        id_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        evaluation_set_size=16,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1236,
        uniform_ood=False,
        id_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        evaluation_set_size=16,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1236,
        uniform_ood=True,
        id_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        evaluation_set_size=256,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1236,
        uniform_ood=True,
        id_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        evaluation_set_size=256,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1236,
        uniform_ood=False,
        id_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        evaluation_set_size=256,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1236,
        uniform_ood=False,
        id_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        evaluation_set_size=256,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1237,
        uniform_ood=True,
        id_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        evaluation_set_size=16,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchEvalBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1237,
        uniform_ood=True,
        id_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        evaluation_set_size=16,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchEvalBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1237,
        uniform_ood=False,
        id_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        evaluation_set_size=16,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchEvalBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1237,
        uniform_ood=False,
        id_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        evaluation_set_size=16,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchEvalBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1237,
        uniform_ood=True,
        id_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        evaluation_set_size=256,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchEvalBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1237,
        uniform_ood=True,
        id_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        evaluation_set_size=256,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchEvalBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1237,
        uniform_ood=False,
        id_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        evaluation_set_size=256,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchEvalBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1237,
        uniform_ood=False,
        id_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        evaluation_set_size=256,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchEvalBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1237,
        uniform_ood=True,
        id_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        evaluation_set_size=16,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1237,
        uniform_ood=True,
        id_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        evaluation_set_size=16,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1237,
        uniform_ood=False,
        id_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        evaluation_set_size=16,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1237,
        uniform_ood=False,
        id_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        evaluation_set_size=16,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1237,
        uniform_ood=True,
        id_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        evaluation_set_size=256,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1237,
        uniform_ood=True,
        id_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        evaluation_set_size=256,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1237,
        uniform_ood=False,
        id_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        evaluation_set_size=256,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1237,
        uniform_ood=False,
        id_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        evaluation_set_size=256,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1238,
        uniform_ood=True,
        id_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        evaluation_set_size=16,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchEvalBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1238,
        uniform_ood=True,
        id_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        evaluation_set_size=16,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchEvalBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1238,
        uniform_ood=False,
        id_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        evaluation_set_size=16,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchEvalBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1238,
        uniform_ood=False,
        id_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        evaluation_set_size=16,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchEvalBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1238,
        uniform_ood=True,
        id_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        evaluation_set_size=256,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchEvalBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1238,
        uniform_ood=True,
        id_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        evaluation_set_size=256,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchEvalBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1238,
        uniform_ood=False,
        id_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        evaluation_set_size=256,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchEvalBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1238,
        uniform_ood=False,
        id_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        evaluation_set_size=256,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchEvalBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1238,
        uniform_ood=True,
        id_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        evaluation_set_size=16,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1238,
        uniform_ood=True,
        id_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        evaluation_set_size=16,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1238,
        uniform_ood=False,
        id_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        evaluation_set_size=16,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1238,
        uniform_ood=False,
        id_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        evaluation_set_size=16,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1238,
        uniform_ood=True,
        id_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        evaluation_set_size=256,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1238,
        uniform_ood=True,
        id_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        evaluation_set_size=256,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1238,
        uniform_ood=False,
        id_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        evaluation_set_size=256,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchBALD,
        temperature=8
    ),
    OodExperiment(
        seed=1238,
        uniform_ood=False,
        id_dataset_type=batchbald_redux.fast_mnist.FastFashionMNIST,  # class
        ood_dataset_type=batchbald_redux.fast_mnist.FastMNIST,  # class
        evaluation_set_size=256,
        num_pool_samples=100,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchBALD,
        temperature=8
    )
]
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

