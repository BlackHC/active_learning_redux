---

title: Datasets


keywords: fastai
sidebar: home_sidebar

summary: "What the name says..."
description: "What the name says..."
nb_path: "05c_more_datasets.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 05c_more_datasets.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">StratifiedShuffleSplit</span>
<span class="kn">from</span> <span class="nn">torch.utils</span> <span class="kn">import</span> <span class="n">data</span>
<span class="kn">from</span> <span class="nn">torchvision</span> <span class="kn">import</span> <span class="n">datasets</span><span class="p">,</span> <span class="n">transforms</span>

<span class="kn">from</span> <span class="nn">batchbald_redux.fast_mnist</span> <span class="kn">import</span> <span class="n">FastMNIST</span>

<span class="kn">from</span> <span class="nn">batchbald_redux.dataset_challenges</span> <span class="kn">import</span> <span class="n">NamedDataset</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">data</span><span class="o">.</span><span class="n">Dataset</span><span class="o">.</span><span class="fm">__new__</span> <span class="o">=</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__new__</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>To speed up experiments, we are going to use Joost's FastMNIST (<a href="https://tinyurl.com/pytorch-fast-mnist">https://tinyurl.com/pytorch-fast-mnist</a>), which preloads the dataset onto the device.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="SplitDataset" class="doc_header"><code>class</code> <code>SplitDataset</code><a href="https://github.com/blackhc/batchbald_redux/tree/master/batchbald_redux/datasets.py#L22" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>SplitDataset</code>(<strong><code>input_size</code></strong>:<code>int</code>, <strong><code>num_classes</code></strong>:<code>int</code>, <strong><code>options</code></strong>:<code>dict</code>, <strong><code>train</code></strong>:<code>Dataset</code>, <strong><code>validation</code></strong>:<code>Dataset</code>, <strong><code>test</code></strong>:<code>Dataset</code>)</p>
</blockquote>
<p>SplitDataset(input_size: int, num_classes: int, options: dict, train: torch.utils.data.dataset.Dataset, validation: torch.utils.data.dataset.Dataset, test: torch.utils.data.dataset.Dataset)</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="SplitDataLoader" class="doc_header"><code>class</code> <code>SplitDataLoader</code><a href="https://github.com/blackhc/batchbald_redux/tree/master/batchbald_redux/datasets.py#L33" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>SplitDataLoader</code>(<strong><code>input_size</code></strong>:<code>int</code>, <strong><code>num_class</code></strong>:<code>int</code>, <strong><code>options</code></strong>:<code>dict</code>, <strong><code>train</code></strong>:<code>DataLoader</code>, <strong><code>validation</code></strong>:<code>DataLoader</code>, <strong><code>test</code></strong>:<code>DataLoader</code>)</p>
</blockquote>
<p>SplitDataLoader(input_size: int, num_class: int, options: dict, train: torch.utils.data.dataloader.DataLoader, validation: torch.utils.data.dataloader.DataLoader, test: torch.utils.data.dataloader.DataLoader)</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">SplitDataset</span><span class="p">:</span>
    <span class="n">input_size</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">num_classes</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span>

    <span class="n">train</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">Dataset</span>
    <span class="n">validation</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">Dataset</span>
    <span class="n">test</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">Dataset</span>


<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">SplitDataLoader</span><span class="p">:</span>
    <span class="n">input_size</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">num_class</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">options</span><span class="p">:</span> <span class="nb">dict</span>

    <span class="n">train</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span>
    <span class="n">validation</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span>
    <span class="n">test</span><span class="p">:</span> <span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span>

        
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="train_validation_split" class="doc_header"><code>train_validation_split</code><a href="https://github.com/blackhc/batchbald_redux/tree/master/batchbald_redux/datasets.py#L47" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>train_validation_split</code>(<strong><code>full_train_dataset</code></strong>, <strong><code>full_validation_dataset</code></strong>, <strong><code>train_labels</code></strong>, <strong><code>validation_set_size</code></strong>, <strong><code>validation_split_random_state</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">train_validation_split</span><span class="p">(</span>
    <span class="o">*</span><span class="p">,</span> <span class="n">full_train_dataset</span><span class="p">,</span> <span class="n">full_validation_dataset</span><span class="p">,</span> <span class="n">train_labels</span><span class="p">,</span> <span class="n">validation_set_size</span><span class="p">,</span> <span class="n">validation_split_random_state</span>
<span class="p">):</span>
    <span class="c1"># Split off validation set</span>
    <span class="k">if</span> <span class="n">validation_set_size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">cv</span> <span class="o">=</span> <span class="n">StratifiedShuffleSplit</span><span class="p">(</span>
            <span class="n">n_splits</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="n">validation_set_size</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">validation_split_random_state</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">train_indices</span><span class="p">,</span> <span class="n">validation_indices</span> <span class="ow">in</span> <span class="n">cv</span><span class="o">.</span><span class="n">split</span><span class="p">(</span>
            <span class="n">X</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">full_train_dataset</span><span class="p">)),</span> <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">train_labels</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="k">pass</span>

        <span class="n">train_dataset</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">Subset</span><span class="p">(</span><span class="n">full_train_dataset</span><span class="p">,</span> <span class="n">train_indices</span><span class="p">)</span>
        <span class="n">validation_dataset</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">Subset</span><span class="p">(</span><span class="n">full_validation_dataset</span><span class="p">,</span> <span class="n">validation_indices</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">train_dataset</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">Subset</span><span class="p">(</span><span class="n">full_train_dataset</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">full_train_dataset</span><span class="p">))))</span>
        <span class="n">validation_dataset</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">Subset</span><span class="p">(</span><span class="n">full_validation_dataset</span><span class="p">,</span> <span class="p">[])</span>

    <span class="k">return</span> <span class="n">train_dataset</span><span class="p">,</span> <span class="n">validation_dataset</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_SVHN" class="doc_header"><code>get_SVHN</code><a href="https://github.com/blackhc/batchbald_redux/tree/master/batchbald_redux/datasets.py#L73" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_SVHN</code>(<strong><code>root</code></strong>, <strong><code>validation_set_size</code></strong>, <strong><code>validation_split_random_state</code></strong>, <strong><code>normalize_like_cifar10</code></strong>, <strong><code>train_augmentation</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_CIFAR10" class="doc_header"><code>get_CIFAR10</code><a href="https://github.com/blackhc/batchbald_redux/tree/master/batchbald_redux/datasets.py#L107" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_CIFAR10</code>(<strong><code>root</code></strong>, <strong><code>validation_set_size</code></strong>, <strong><code>validation_split_random_state</code></strong>, <strong><code>normalize_like_cifar10</code></strong>, <strong><code>train_augmentation</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_CIFAR100" class="doc_header"><code>get_CIFAR100</code><a href="https://github.com/blackhc/batchbald_redux/tree/master/batchbald_redux/datasets.py#L159" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_CIFAR100</code>(<strong><code>root</code></strong>, <strong><code>validation_set_size</code></strong>, <strong><code>validation_split_random_state</code></strong>, <strong><code>normalize_like_cifar10</code></strong>, <strong><code>train_augmentation</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">CIFAR10_NORMALIZE</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">Normalize</span><span class="p">((</span><span class="mf">0.4914</span><span class="p">,</span> <span class="mf">0.4822</span><span class="p">,</span> <span class="mf">0.4465</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.2023</span><span class="p">,</span> <span class="mf">0.1994</span><span class="p">,</span> <span class="mf">0.2010</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">get_SVHN</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">validation_set_size</span><span class="p">,</span> <span class="n">validation_split_random_state</span><span class="p">,</span> <span class="n">normalize_like_cifar10</span><span class="p">,</span> <span class="n">train_augmentation</span><span class="p">):</span>
    <span class="n">input_size</span> <span class="o">=</span> <span class="mi">32</span>
    <span class="n">num_classes</span> <span class="o">=</span> <span class="mi">10</span>

    <span class="c1"># NOTE: these are not correct mean and std for SVHN, but are commonly used</span>
    <span class="n">normalize</span> <span class="o">=</span> <span class="n">CIFAR10_NORMALIZE</span> <span class="k">if</span> <span class="n">normalize_like_cifar10</span> <span class="k">else</span> <span class="n">transforms</span><span class="o">.</span><span class="n">Normalize</span><span class="p">((</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>
    <span class="n">transform</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">Compose</span><span class="p">([</span><span class="n">transforms</span><span class="o">.</span><span class="n">ToTensor</span><span class="p">(),</span> <span class="n">normalize</span><span class="p">])</span>

    <span class="n">full_train_dataset</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">SVHN</span><span class="p">(</span><span class="n">root</span> <span class="o">+</span> <span class="s2">&quot;data/SVHN&quot;</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="s2">&quot;train&quot;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">transform</span><span class="p">,</span> <span class="n">download</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">full_validation_dataset</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">SVHN</span><span class="p">(</span><span class="n">root</span> <span class="o">+</span> <span class="s2">&quot;data/SVHN&quot;</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="s2">&quot;train&quot;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">transform</span><span class="p">,</span> <span class="n">download</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">train_dataset</span><span class="p">,</span> <span class="n">validation_dataset</span> <span class="o">=</span> <span class="n">train_validation_split</span><span class="p">(</span>
        <span class="n">full_train_dataset</span><span class="o">=</span><span class="n">full_train_dataset</span><span class="p">,</span>
        <span class="n">full_validation_dataset</span><span class="o">=</span><span class="n">full_validation_dataset</span><span class="p">,</span>
        <span class="n">train_labels</span><span class="o">=</span><span class="n">full_train_dataset</span><span class="o">.</span><span class="n">labels</span><span class="p">,</span>
        <span class="n">validation_set_size</span><span class="o">=</span><span class="n">validation_set_size</span><span class="p">,</span>
        <span class="n">validation_split_random_state</span><span class="o">=</span><span class="n">validation_split_random_state</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">test_dataset</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">SVHN</span><span class="p">(</span><span class="n">root</span> <span class="o">+</span> <span class="s2">&quot;data/SVHN&quot;</span><span class="p">,</span> <span class="n">split</span><span class="o">=</span><span class="s2">&quot;test&quot;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">transform</span><span class="p">,</span> <span class="n">download</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">SplitDataset</span><span class="p">(</span>
        <span class="n">input_size</span><span class="p">,</span>
        <span class="n">num_classes</span><span class="p">,</span>
        <span class="nb">dict</span><span class="p">(</span>
            <span class="n">validation_split_random_state</span><span class="o">=</span><span class="n">validation_split_random_state</span><span class="p">,</span>
            <span class="n">normalize_like_cifar10</span><span class="o">=</span><span class="n">normalize_like_cifar10</span><span class="p">,</span>
            <span class="n">train_augmentation</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">NamedDataset</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;SVHN (Train, seed=</span><span class="si">{</span><span class="n">validation_split_random_state</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">)</span><span class="si">}</span><span class="s2"> samples)&quot;</span><span class="p">),</span>
        <span class="n">NamedDataset</span><span class="p">(</span><span class="n">validation_dataset</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;SVHN (Validation, seed=</span><span class="si">{</span><span class="n">validation_split_random_state</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">validation_dataset</span><span class="p">)</span><span class="si">}</span><span class="s2"> samples)&quot;</span><span class="p">),</span>
        <span class="n">NamedDataset</span><span class="p">(</span><span class="n">test_dataset</span><span class="p">,</span> <span class="s2">&quot;SVHN (Test)&quot;</span><span class="p">),</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">get_CIFAR10</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">validation_set_size</span><span class="p">,</span> <span class="n">validation_split_random_state</span><span class="p">,</span> <span class="n">normalize_like_cifar10</span><span class="p">,</span> <span class="n">train_augmentation</span><span class="p">):</span>
    <span class="n">input_size</span> <span class="o">=</span> <span class="mi">32</span>
    <span class="n">num_classes</span> <span class="o">=</span> <span class="mi">10</span>

    <span class="n">test_transform</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">Compose</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">transforms</span><span class="o">.</span><span class="n">ToTensor</span><span class="p">(),</span>
            <span class="n">CIFAR10_NORMALIZE</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">train_augmentation</span><span class="p">:</span>
        <span class="n">train_transform</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">Compose</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">transforms</span><span class="o">.</span><span class="n">RandomCrop</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span>
                <span class="n">transforms</span><span class="o">.</span><span class="n">RandomHorizontalFlip</span><span class="p">(),</span>
                <span class="n">transforms</span><span class="o">.</span><span class="n">ToTensor</span><span class="p">(),</span>
                <span class="n">CIFAR10_NORMALIZE</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">train_transform</span> <span class="o">=</span> <span class="n">test_transform</span>

    <span class="n">full_train_dataset</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">CIFAR10</span><span class="p">(</span><span class="n">root</span> <span class="o">+</span> <span class="s2">&quot;data/CIFAR10&quot;</span><span class="p">,</span> <span class="n">train</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">train_transform</span><span class="p">,</span> <span class="n">download</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">full_validation_dataset</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">CIFAR10</span><span class="p">(</span>
        <span class="n">root</span> <span class="o">+</span> <span class="s2">&quot;data/CIFAR10&quot;</span><span class="p">,</span> <span class="n">train</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">test_transform</span><span class="p">,</span> <span class="n">download</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>

    <span class="n">train_dataset</span><span class="p">,</span> <span class="n">validation_dataset</span> <span class="o">=</span> <span class="n">train_validation_split</span><span class="p">(</span>
        <span class="n">full_train_dataset</span><span class="o">=</span><span class="n">full_train_dataset</span><span class="p">,</span>
        <span class="n">full_validation_dataset</span><span class="o">=</span><span class="n">full_validation_dataset</span><span class="p">,</span>
        <span class="n">train_labels</span><span class="o">=</span><span class="n">full_train_dataset</span><span class="o">.</span><span class="n">targets</span><span class="p">,</span>
        <span class="n">validation_set_size</span><span class="o">=</span><span class="n">validation_set_size</span><span class="p">,</span>
        <span class="n">validation_split_random_state</span><span class="o">=</span><span class="n">validation_split_random_state</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">test_dataset</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">CIFAR10</span><span class="p">(</span><span class="n">root</span> <span class="o">+</span> <span class="s2">&quot;data/CIFAR10&quot;</span><span class="p">,</span> <span class="n">train</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">test_transform</span><span class="p">,</span> <span class="n">download</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">SplitDataset</span><span class="p">(</span>
        <span class="n">input_size</span><span class="p">,</span>
        <span class="n">num_classes</span><span class="p">,</span>
        <span class="nb">dict</span><span class="p">(</span>
            <span class="n">validation_split_random_state</span><span class="o">=</span><span class="n">validation_split_random_state</span><span class="p">,</span>
            <span class="n">normalize_like_cifar10</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">train_augmentation</span><span class="o">=</span><span class="n">train_augmentation</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">NamedDataset</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;CIFAR-10 (Train, seed=</span><span class="si">{</span><span class="n">validation_split_random_state</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">)</span><span class="si">}</span><span class="s2"> samples)&quot;</span><span class="p">),</span>
        <span class="n">NamedDataset</span><span class="p">(</span><span class="n">validation_dataset</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;CIFAR-10 (Validation, seed=</span><span class="si">{</span><span class="n">validation_split_random_state</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">validation_dataset</span><span class="p">)</span><span class="si">}</span><span class="s2"> samples)&quot;</span><span class="p">),</span>
        <span class="n">NamedDataset</span><span class="p">(</span><span class="n">test_dataset</span><span class="p">,</span> <span class="s2">&quot;CIFAR-10 (Test)&quot;</span><span class="p">),</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">get_CIFAR100</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">validation_set_size</span><span class="p">,</span> <span class="n">validation_split_random_state</span><span class="p">,</span> <span class="n">normalize_like_cifar10</span><span class="p">,</span> <span class="n">train_augmentation</span><span class="p">):</span>
    <span class="n">input_size</span> <span class="o">=</span> <span class="mi">32</span>
    <span class="n">num_classes</span> <span class="o">=</span> <span class="mi">100</span>

    <span class="n">normalize</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">CIFAR10_NORMALIZE</span>
        <span class="k">if</span> <span class="n">normalize_like_cifar10</span>
        <span class="k">else</span> <span class="n">transforms</span><span class="o">.</span><span class="n">Normalize</span><span class="p">((</span><span class="mf">0.5071</span><span class="p">,</span> <span class="mf">0.4866</span><span class="p">,</span> <span class="mf">0.4409</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.2673</span><span class="p">,</span> <span class="mf">0.2564</span><span class="p">,</span> <span class="mf">0.2762</span><span class="p">))</span>
    <span class="p">)</span>

    <span class="n">test_transform</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">Compose</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">transforms</span><span class="o">.</span><span class="n">ToTensor</span><span class="p">(),</span>
            <span class="n">normalize</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">train_augmentation</span><span class="p">:</span>
        <span class="n">train_transform</span> <span class="o">=</span> <span class="n">transforms</span><span class="o">.</span><span class="n">Compose</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">transforms</span><span class="o">.</span><span class="n">RandomCrop</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">4</span><span class="p">),</span>
                <span class="n">transforms</span><span class="o">.</span><span class="n">RandomHorizontalFlip</span><span class="p">(),</span>
                <span class="n">transforms</span><span class="o">.</span><span class="n">ToTensor</span><span class="p">(),</span>
                <span class="n">normalize</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">train_transform</span> <span class="o">=</span> <span class="n">test_transform</span>

    <span class="n">full_train_dataset</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">CIFAR100</span><span class="p">(</span><span class="n">root</span> <span class="o">+</span> <span class="s2">&quot;data/CIFAR100&quot;</span><span class="p">,</span> <span class="n">train</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">train_transform</span><span class="p">,</span> <span class="n">download</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">full_validation_dataset</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">CIFAR100</span><span class="p">(</span>
        <span class="n">root</span> <span class="o">+</span> <span class="s2">&quot;data/CIFAR100&quot;</span><span class="p">,</span> <span class="n">train</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">test_transform</span><span class="p">,</span> <span class="n">download</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>

    <span class="n">train_dataset</span><span class="p">,</span> <span class="n">validation_dataset</span> <span class="o">=</span> <span class="n">train_validation_split</span><span class="p">(</span>
        <span class="n">full_train_dataset</span><span class="o">=</span><span class="n">full_train_dataset</span><span class="p">,</span>
        <span class="n">full_validation_dataset</span><span class="o">=</span><span class="n">full_validation_dataset</span><span class="p">,</span>
        <span class="n">train_labels</span><span class="o">=</span><span class="n">full_train_dataset</span><span class="o">.</span><span class="n">targets</span><span class="p">,</span>
        <span class="n">validation_set_size</span><span class="o">=</span><span class="n">validation_set_size</span><span class="p">,</span>
        <span class="n">validation_split_random_state</span><span class="o">=</span><span class="n">validation_split_random_state</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">test_dataset</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">CIFAR100</span><span class="p">(</span><span class="n">root</span> <span class="o">+</span> <span class="s2">&quot;data/CIFAR100&quot;</span><span class="p">,</span> <span class="n">train</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">test_transform</span><span class="p">,</span> <span class="n">download</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">SplitDataset</span><span class="p">(</span>
        <span class="n">input_size</span><span class="p">,</span>
        <span class="n">num_classes</span><span class="p">,</span>
        <span class="nb">dict</span><span class="p">(</span>
            <span class="n">validation_split_random_state</span><span class="o">=</span><span class="n">validation_split_random_state</span><span class="p">,</span>
            <span class="n">normalize_like_cifar10</span><span class="o">=</span><span class="n">normalize_like_cifar10</span><span class="p">,</span>
            <span class="n">train_augmentation</span><span class="o">=</span><span class="n">train_augmentation</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">NamedDataset</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;CIFAR-100 (Train, seed=</span><span class="si">{</span><span class="n">validation_split_random_state</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">)</span><span class="si">}</span><span class="s2"> samples)&quot;</span><span class="p">),</span>
        <span class="n">NamedDataset</span><span class="p">(</span><span class="n">validation_dataset</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;CIFAR-100 (Validation, seed=</span><span class="si">{</span><span class="n">validation_split_random_state</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">validation_dataset</span><span class="p">)</span><span class="si">}</span><span class="s2"> samples)&quot;</span><span class="p">),</span>
        <span class="n">NamedDataset</span><span class="p">(</span><span class="n">test_dataset</span><span class="p">,</span> <span class="s2">&quot;CIFAR-100 (Test)&quot;</span><span class="p">),</span>
    <span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_dataset" class="doc_header"><code>get_dataset</code><a href="https://github.com/blackhc/batchbald_redux/tree/master/batchbald_redux/datasets.py#L225" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_dataset</code>(<strong><code>name</code></strong>:<code>str</code>, <strong><code>root</code></strong>=<em><code>None</code></em>, <strong><code>validation_set_size</code></strong>=<em><code>0</code></em>, <strong><code>validation_split_random_state</code></strong>=<em><code>0</code></em>, <strong><code>normalize_like_cifar10</code></strong>=<em><code>False</code></em>, <strong><code>train_augmentation</code></strong>=<em><code>True</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_dataloaders" class="doc_header"><code>get_dataloaders</code><a href="https://github.com/blackhc/batchbald_redux/tree/master/batchbald_redux/datasets.py#L246" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_dataloaders</code>(<strong><code>split_dataset</code></strong>:<a href="/batchbald_redux/more_datasets.html#SplitDataset"><code>SplitDataset</code></a>, <strong><code>train_batch_size</code></strong>=<em><code>128</code></em>, <strong><code>eval_batch_size</code></strong>=<em><code>512</code></em>, <strong><code>train_shuffle</code></strong>=<em><code>True</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_dataloaders_by_name" class="doc_header"><code>get_dataloaders_by_name</code><a href="https://github.com/blackhc/batchbald_redux/tree/master/batchbald_redux/datasets.py#L264" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_dataloaders_by_name</code>(<strong><code>name</code></strong>:<code>str</code>, <strong><code>normalize_like_cifar10</code></strong>, <strong><code>train_augmentation</code></strong>, <strong><code>root</code></strong>=<em><code>None</code></em>, <strong><code>validation_set_size</code></strong>=<em><code>None</code></em>, <strong><code>validation_split_random_state</code></strong>=<em><code>None</code></em>, <strong><code>train_batch_size</code></strong>=<em><code>128</code></em>, <strong><code>eval_batch_size</code></strong>=<em><code>512</code></em>, <strong><code>train_shuffle</code></strong>=<em><code>True</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dataset_factories</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;SVHN&quot;</span><span class="p">:</span> <span class="n">get_SVHN</span><span class="p">,</span>
    <span class="s2">&quot;CIFAR-10&quot;</span><span class="p">:</span> <span class="n">get_CIFAR10</span><span class="p">,</span>
    <span class="s2">&quot;CIFAR-100&quot;</span><span class="p">:</span> <span class="n">get_CIFAR100</span><span class="p">,</span>
<span class="p">}</span>


<span class="k">def</span> <span class="nf">get_dataset</span><span class="p">(</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">root</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">validation_set_size</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">validation_split_random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">normalize_like_cifar10</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">train_augmentation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">):</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">root</span> <span class="k">if</span> <span class="n">root</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;./&quot;</span>
    <span class="n">validation_set_size</span> <span class="o">=</span> <span class="n">validation_set_size</span> <span class="k">if</span> <span class="n">validation_set_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span>
    <span class="n">validation_split_random_state</span> <span class="o">=</span> <span class="n">validation_split_random_state</span> <span class="k">if</span> <span class="n">validation_split_random_state</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span>
    <span class="n">normalize_like_cifar10</span> <span class="o">=</span> <span class="n">normalize_like_cifar10</span> <span class="k">if</span> <span class="n">normalize_like_cifar10</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">False</span>
    <span class="n">train_augmentation</span> <span class="o">=</span> <span class="n">train_augmentation</span> <span class="k">if</span> <span class="n">train_augmentation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">True</span>

    <span class="n">split_dataset</span> <span class="o">=</span> <span class="n">dataset_factories</span><span class="p">[</span><span class="n">name</span><span class="p">](</span>
        <span class="n">root</span><span class="p">,</span> <span class="n">validation_set_size</span><span class="p">,</span> <span class="n">validation_split_random_state</span><span class="p">,</span> <span class="n">normalize_like_cifar10</span><span class="p">,</span> <span class="n">train_augmentation</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">split_dataset</span>


<span class="k">def</span> <span class="nf">get_dataloaders</span><span class="p">(</span><span class="n">split_dataset</span><span class="p">:</span> <span class="n">SplitDataset</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">train_batch_size</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">eval_batch_size</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">train_shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;num_workers&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;pin_memory&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>

    <span class="n">train_loader</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">(</span><span class="n">split_dataset</span><span class="o">.</span><span class="n">train</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">train_batch_size</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="n">train_shuffle</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">validation_loader</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">(</span><span class="n">split_dataset</span><span class="o">.</span><span class="n">validation</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">eval_batch_size</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">test_loader</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">(</span><span class="n">split_dataset</span><span class="o">.</span><span class="n">test</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">eval_batch_size</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">SplitDataLoader</span><span class="p">(</span>
        <span class="n">split_dataset</span><span class="o">.</span><span class="n">input_size</span><span class="p">,</span>
        <span class="n">split_dataset</span><span class="o">.</span><span class="n">num_classes</span><span class="p">,</span>
        <span class="n">split_dataset</span><span class="o">.</span><span class="n">options</span><span class="p">,</span>
        <span class="n">train_loader</span><span class="p">,</span>
        <span class="n">validation_loader</span><span class="p">,</span>
        <span class="n">test_loader</span><span class="p">,</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">get_dataloaders_by_name</span><span class="p">(</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">normalize_like_cifar10</span><span class="p">,</span>
    <span class="n">train_augmentation</span><span class="p">,</span>
    <span class="n">root</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">validation_set_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">validation_split_random_state</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">train_batch_size</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span>
    <span class="n">eval_batch_size</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span>
    <span class="n">train_shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">):</span>
    <span class="n">split_dataset</span> <span class="o">=</span> <span class="n">get_dataset</span><span class="p">(</span>
        <span class="n">name</span><span class="p">,</span>
        <span class="n">root</span><span class="o">=</span><span class="n">root</span><span class="p">,</span>
        <span class="n">validation_set_size</span><span class="o">=</span><span class="n">validation_set_size</span><span class="p">,</span>
        <span class="n">validation_split_random_state</span><span class="o">=</span><span class="n">validation_split_random_state</span><span class="p">,</span>
        <span class="n">normalize_like_cifar10</span><span class="o">=</span><span class="n">normalize_like_cifar10</span><span class="p">,</span>
        <span class="n">train_augmentation</span><span class="o">=</span><span class="n">train_augmentation</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">split_dataloaders</span> <span class="o">=</span> <span class="n">get_dataloaders</span><span class="p">(</span>
        <span class="n">split_dataset</span><span class="p">,</span> <span class="n">train_batch_size</span><span class="o">=</span><span class="n">train_batch_size</span><span class="p">,</span> <span class="n">eval_batch_size</span><span class="o">=</span><span class="n">eval_batch_size</span><span class="p">,</span> <span class="n">train_shuffle</span><span class="o">=</span><span class="n">train_shuffle</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">split_dataloaders</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

