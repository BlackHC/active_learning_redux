---

title: Experiment EMNIST


keywords: fastai
sidebar: home_sidebar

summary: "Can we get better by training on our assumptions?"
description: "Can we get better by training on our assumptions?"
nb_path: "09b_experiment_emnist_bald.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 09b_experiment_emnist_bald.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Appended /home/blackhc/PycharmProjects/bald-ical/src to paths
Switched to directory /home/blackhc/PycharmProjects/bald-ical
%load_ext autoreload
%autoreload 2
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Import modules and functions were are going to use.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">dataclasses</span>
<span class="kn">import</span> <span class="nn">traceback</span>

<span class="kn">from</span> <span class="nn">blackhc.project</span> <span class="kn">import</span> <span class="n">is_run_from_ipython</span>
<span class="kn">from</span> <span class="nn">blackhc.project.experiment</span> <span class="kn">import</span> <span class="n">embedded_experiments</span>

<span class="kn">import</span> <span class="nn">batchbald_redux.acquisition_functions.bald</span>
<span class="kn">import</span> <span class="nn">batchbald_redux.acquisition_functions.batchbald</span>
<span class="kn">from</span> <span class="nn">batchbald_redux</span> <span class="kn">import</span> <span class="n">acquisition_functions</span><span class="p">,</span> <span class="n">baseline_acquisition_functions</span>
<span class="kn">from</span> <span class="nn">batchbald_redux.experiment_data</span> <span class="kn">import</span> <span class="n">StandardExperimentDataConfig</span>
<span class="kn">from</span> <span class="nn">batchbald_redux.emnist_models</span> <span class="kn">import</span> <span class="n">EMnistModelTrainer</span>
<span class="kn">from</span> <span class="nn">batchbald_redux.unified_experiment</span> <span class="kn">import</span> <span class="n">UnifiedExperiment</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">configs</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">UnifiedExperiment</span><span class="p">(</span>
        <span class="n">experiment_data_config</span><span class="o">=</span><span class="n">StandardExperimentDataConfig</span><span class="p">(</span>
            <span class="n">id_dataset_name</span><span class="o">=</span><span class="s2">&quot;BalancedEMNIST&quot;</span><span class="p">,</span>
            <span class="n">id_repetitions</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">initial_training_set_size</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">validation_set_size</span><span class="o">=</span><span class="mi">4096</span><span class="p">,</span>
            <span class="n">validation_split_random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">evaluation_set_size</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">add_dataset_noise</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">ood_dataset_config</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">seed</span><span class="o">=</span><span class="n">seed</span> <span class="o">+</span> <span class="mi">1765</span><span class="p">,</span>
        <span class="n">acquisition_function</span><span class="o">=</span><span class="n">acquisition_function</span><span class="p">,</span>
        <span class="n">acquisition_size</span><span class="o">=</span><span class="n">acquisition_size</span><span class="p">,</span>
        <span class="n">num_pool_samples</span><span class="o">=</span><span class="n">num_pool_samples</span><span class="p">,</span>
        <span class="n">max_training_set</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">model_trainer_factory</span><span class="o">=</span><span class="n">EMnistModelTrainer</span><span class="p">,</span>
        <span class="n">stochastic_mode</span><span class="o">=</span><span class="n">stochastic_mode</span><span class="p">,</span>
        <span class="n">coldness</span><span class="o">=</span><span class="n">coldness</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">acquisition_function</span> <span class="ow">in</span> <span class="p">[</span>
        <span class="n">batchbald_redux</span><span class="o">.</span><span class="n">acquisition_functions</span><span class="o">.</span><span class="n">bald</span><span class="o">.</span><span class="n">StochasticBALD</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="k">for</span> <span class="n">seed</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">acquisition_size</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">40</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">num_pool_samples</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">100</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">coldness</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="c1"># Already ran Power</span>
    <span class="k">for</span> <span class="n">stochastic_mode</span> <span class="ow">in</span> <span class="p">[</span>
        <span class="n">acquisition_functions</span><span class="o">.</span><span class="n">StochasticMode</span><span class="o">.</span><span class="n">Power</span><span class="p">,</span>
        <span class="n">acquisition_functions</span><span class="o">.</span><span class="n">StochasticMode</span><span class="o">.</span><span class="n">Softmax</span><span class="p">,</span>
    <span class="p">]</span>
<span class="p">]</span> <span class="o">+</span> <span class="p">[</span>
    <span class="n">UnifiedExperiment</span><span class="p">(</span>
        <span class="n">experiment_data_config</span><span class="o">=</span><span class="n">StandardExperimentDataConfig</span><span class="p">(</span>
            <span class="n">id_dataset_name</span><span class="o">=</span><span class="s2">&quot;BalancedEMNIST&quot;</span><span class="p">,</span>
            <span class="n">id_repetitions</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">initial_training_set_size</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">validation_set_size</span><span class="o">=</span><span class="mi">4096</span><span class="p">,</span>
            <span class="n">validation_split_random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">evaluation_set_size</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">add_dataset_noise</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">ood_dataset_config</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">seed</span><span class="o">=</span><span class="n">seed</span> <span class="o">+</span> <span class="mi">1765</span><span class="p">,</span>
        <span class="n">acquisition_function</span><span class="o">=</span><span class="n">acquisition_function</span><span class="p">,</span>
        <span class="n">acquisition_size</span><span class="o">=</span><span class="n">acquisition_size</span><span class="p">,</span>
        <span class="n">num_pool_samples</span><span class="o">=</span><span class="n">num_pool_samples</span><span class="p">,</span>
        <span class="n">max_training_set</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">model_trainer_factory</span><span class="o">=</span><span class="n">EMnistModelTrainer</span><span class="p">,</span>
        <span class="n">stochastic_mode</span><span class="o">=</span><span class="n">stochastic_mode</span><span class="p">,</span>
        <span class="n">coldness</span><span class="o">=</span><span class="n">coldness</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">acquisition_function</span> <span class="ow">in</span> <span class="p">[</span>
        <span class="n">batchbald_redux</span><span class="o">.</span><span class="n">acquisition_functions</span><span class="o">.</span><span class="n">bald</span><span class="o">.</span><span class="n">StochasticBALD</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="k">for</span> <span class="n">seed</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">acquisition_size</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">40</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">num_pool_samples</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">100</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">coldness</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="c1"># Already ran Power</span>
    <span class="k">for</span> <span class="n">stochastic_mode</span> <span class="ow">in</span> <span class="p">[</span>
        <span class="n">acquisition_functions</span><span class="o">.</span><span class="n">StochasticMode</span><span class="o">.</span><span class="n">Softrank</span><span class="p">,</span>
    <span class="p">]</span>
<span class="p">]</span> <span class="o">+</span> <span class="p">[</span>
    <span class="n">UnifiedExperiment</span><span class="p">(</span>
        <span class="n">experiment_data_config</span><span class="o">=</span><span class="n">StandardExperimentDataConfig</span><span class="p">(</span>
            <span class="n">id_dataset_name</span><span class="o">=</span><span class="s2">&quot;BalancedEMNIST&quot;</span><span class="p">,</span>
            <span class="n">id_repetitions</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">initial_training_set_size</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">validation_set_size</span><span class="o">=</span><span class="mi">4096</span><span class="p">,</span>
            <span class="n">validation_split_random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">evaluation_set_size</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">add_dataset_noise</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">ood_dataset_config</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">seed</span><span class="o">=</span><span class="n">seed</span> <span class="o">+</span> <span class="mi">1765</span><span class="p">,</span>
        <span class="n">acquisition_function</span><span class="o">=</span><span class="n">acquisition_function</span><span class="p">,</span>
        <span class="n">acquisition_size</span><span class="o">=</span><span class="n">acquisition_size</span><span class="p">,</span>
        <span class="n">num_pool_samples</span><span class="o">=</span><span class="n">num_pool_samples</span><span class="p">,</span>
        <span class="n">max_training_set</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">model_trainer_factory</span><span class="o">=</span><span class="n">EMnistModelTrainer</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">acquisition_function</span> <span class="ow">in</span> <span class="p">[</span>
        <span class="n">batchbald_redux</span><span class="o">.</span><span class="n">acquisition_functions</span><span class="o">.</span><span class="n">bald</span><span class="o">.</span><span class="n">BALD</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="k">for</span> <span class="n">seed</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">acquisition_size</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">40</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">num_pool_samples</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">100</span><span class="p">]</span>
<span class="p">]</span> <span class="o">+</span> <span class="p">[</span>
    <span class="n">UnifiedExperiment</span><span class="p">(</span>
        <span class="n">experiment_data_config</span><span class="o">=</span><span class="n">StandardExperimentDataConfig</span><span class="p">(</span>
            <span class="n">id_dataset_name</span><span class="o">=</span><span class="s2">&quot;BalancedEMNIST&quot;</span><span class="p">,</span>
            <span class="n">id_repetitions</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">initial_training_set_size</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">validation_set_size</span><span class="o">=</span><span class="mi">4096</span><span class="p">,</span> <span class="c1"># Increase the validation set to reduce memory pressure</span>
            <span class="n">validation_split_random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">evaluation_set_size</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">add_dataset_noise</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">ood_dataset_config</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">seed</span><span class="o">=</span><span class="n">seed</span> <span class="o">+</span> <span class="mi">1765</span><span class="p">,</span>
        <span class="n">acquisition_function</span><span class="o">=</span><span class="n">acquisition_function</span><span class="p">,</span>
        <span class="n">acquisition_size</span><span class="o">=</span><span class="n">acquisition_size</span><span class="p">,</span>
        <span class="n">num_pool_samples</span><span class="o">=</span><span class="n">num_pool_samples</span><span class="p">,</span>
        <span class="n">max_training_set</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">model_trainer_factory</span><span class="o">=</span><span class="n">EMnistModelTrainer</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">acquisition_function</span> <span class="ow">in</span> <span class="p">[</span>
        <span class="n">baseline_acquisition_functions</span><span class="o">.</span><span class="n">BADGE</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="k">for</span> <span class="n">seed</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">acquisition_size</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">40</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">num_pool_samples</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">10</span><span class="p">]</span>
<span class="p">]</span> <span class="o">+</span> <span class="p">[</span>
    <span class="n">UnifiedExperiment</span><span class="p">(</span>
        <span class="n">experiment_data_config</span><span class="o">=</span><span class="n">StandardExperimentDataConfig</span><span class="p">(</span>
            <span class="n">id_dataset_name</span><span class="o">=</span><span class="s2">&quot;BalancedEMNIST&quot;</span><span class="p">,</span>
            <span class="n">id_repetitions</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">initial_training_set_size</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">validation_set_size</span><span class="o">=</span><span class="mi">4096</span><span class="p">,</span>
            <span class="n">validation_split_random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">evaluation_set_size</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">add_dataset_noise</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">ood_dataset_config</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">seed</span><span class="o">=</span><span class="n">seed</span> <span class="o">+</span> <span class="mi">1765</span><span class="p">,</span>
        <span class="n">acquisition_function</span><span class="o">=</span><span class="n">acquisition_function</span><span class="p">,</span>
        <span class="n">acquisition_size</span><span class="o">=</span><span class="n">acquisition_size</span><span class="p">,</span>
        <span class="n">num_pool_samples</span><span class="o">=</span><span class="n">num_pool_samples</span><span class="p">,</span>
        <span class="n">max_training_set</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">model_trainer_factory</span><span class="o">=</span><span class="n">EMnistModelTrainer</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">acquisition_function</span> <span class="ow">in</span> <span class="p">[</span>
        <span class="n">batchbald_redux</span><span class="o">.</span><span class="n">acquisition_functions</span><span class="o">.</span><span class="n">batchbald</span><span class="o">.</span><span class="n">BatchBALD</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="k">for</span> <span class="n">seed</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">acquisition_size</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">5</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">num_pool_samples</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">20</span><span class="p">]</span>
<span class="p">]</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">is_run_from_ipython</span><span class="p">()</span> <span class="ow">and</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">job_id</span><span class="p">,</span> <span class="n">store</span> <span class="ow">in</span> <span class="n">embedded_experiments</span><span class="p">(</span><span class="vm">__file__</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">configs</span><span class="p">)):</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">configs</span><span class="p">[</span><span class="n">job_id</span><span class="p">]</span>
        <span class="n">config</span><span class="o">.</span><span class="n">seed</span> <span class="o">+=</span> <span class="n">job_id</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
        <span class="n">store</span><span class="p">[</span><span class="s2">&quot;config&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataclasses</span><span class="o">.</span><span class="n">asdict</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
        <span class="n">store</span><span class="p">[</span><span class="s2">&quot;log&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">config</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">store</span><span class="o">=</span><span class="n">store</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">store</span><span class="p">[</span><span class="s2">&quot;exception&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span>
            <span class="k">raise</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">configs</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>140</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">prettyprinter</span>

<span class="n">prettyprinter</span><span class="o">.</span><span class="n">install_extras</span><span class="p">({</span><span class="s2">&quot;dataclasses&quot;</span><span class="p">})</span>
<span class="n">prettyprinter</span><span class="o">.</span><span class="n">pprint</span><span class="p">(</span><span class="n">configs</span><span class="p">[</span><span class="mi">134</span><span class="p">:])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[
    batchbald_redux.unified_experiment.UnifiedExperiment(
        seed=1769,
        experiment_data_config=batchbald_redux.experiment_data.StandardExperimentDataConfig(
            id_dataset_name=&#39;EMNIST&#39;,
            id_repetitions=1,
            initial_training_set_size=0,
            validation_set_size=4096,
            validation_split_random_state=0,
            evaluation_set_size=0,
            add_dataset_noise=False,
            ood_dataset_config=None
        ),
        acquisition_size=40,
        max_training_set=300,
        num_pool_samples=10,
        # class
        acquisition_function=batchbald_redux.baseline_acquisition_functions.BADGE,
        # class
        train_eval_model=batchbald_redux.train_eval_model.TrainSelfDistillationEvalModel,
        # class
        model_trainer_factory=batchbald_redux.emnist_models.EMnistModelTrainer,
        epig_bootstrap_type=batchbald_redux.batchbald.BootstrapType.NO_BOOTSTRAP
    ),
    batchbald_redux.unified_experiment.UnifiedExperiment(
        seed=1765,
        experiment_data_config=batchbald_redux.experiment_data.StandardExperimentDataConfig(
            id_dataset_name=&#39;EMNIST&#39;,
            id_repetitions=1,
            initial_training_set_size=0,
            validation_set_size=4096,
            validation_split_random_state=0,
            evaluation_set_size=0,
            add_dataset_noise=False,
            ood_dataset_config=None
        ),
        max_training_set=300,
        num_pool_samples=10,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchBALD,
        # class
        train_eval_model=batchbald_redux.train_eval_model.TrainSelfDistillationEvalModel,
        # class
        model_trainer_factory=batchbald_redux.emnist_models.EMnistModelTrainer,
        epig_bootstrap_type=batchbald_redux.batchbald.BootstrapType.NO_BOOTSTRAP
    ),
    batchbald_redux.unified_experiment.UnifiedExperiment(
        seed=1766,
        experiment_data_config=batchbald_redux.experiment_data.StandardExperimentDataConfig(
            id_dataset_name=&#39;EMNIST&#39;,
            id_repetitions=1,
            initial_training_set_size=0,
            validation_set_size=4096,
            validation_split_random_state=0,
            evaluation_set_size=0,
            add_dataset_noise=False,
            ood_dataset_config=None
        ),
        max_training_set=300,
        num_pool_samples=10,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchBALD,
        # class
        train_eval_model=batchbald_redux.train_eval_model.TrainSelfDistillationEvalModel,
        # class
        model_trainer_factory=batchbald_redux.emnist_models.EMnistModelTrainer,
        epig_bootstrap_type=batchbald_redux.batchbald.BootstrapType.NO_BOOTSTRAP
    ),
    batchbald_redux.unified_experiment.UnifiedExperiment(
        seed=1767,
        experiment_data_config=batchbald_redux.experiment_data.StandardExperimentDataConfig(
            id_dataset_name=&#39;EMNIST&#39;,
            id_repetitions=1,
            initial_training_set_size=0,
            validation_set_size=4096,
            validation_split_random_state=0,
            evaluation_set_size=0,
            add_dataset_noise=False,
            ood_dataset_config=None
        ),
        max_training_set=300,
        num_pool_samples=10,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchBALD,
        # class
        train_eval_model=batchbald_redux.train_eval_model.TrainSelfDistillationEvalModel,
        # class
        model_trainer_factory=batchbald_redux.emnist_models.EMnistModelTrainer,
        epig_bootstrap_type=batchbald_redux.batchbald.BootstrapType.NO_BOOTSTRAP
    ),
    batchbald_redux.unified_experiment.UnifiedExperiment(
        seed=1768,
        experiment_data_config=batchbald_redux.experiment_data.StandardExperimentDataConfig(
            id_dataset_name=&#39;EMNIST&#39;,
            id_repetitions=1,
            initial_training_set_size=0,
            validation_set_size=4096,
            validation_split_random_state=0,
            evaluation_set_size=0,
            add_dataset_noise=False,
            ood_dataset_config=None
        ),
        max_training_set=300,
        num_pool_samples=10,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchBALD,
        # class
        train_eval_model=batchbald_redux.train_eval_model.TrainSelfDistillationEvalModel,
        # class
        model_trainer_factory=batchbald_redux.emnist_models.EMnistModelTrainer,
        epig_bootstrap_type=batchbald_redux.batchbald.BootstrapType.NO_BOOTSTRAP
    ),
    batchbald_redux.unified_experiment.UnifiedExperiment(
        seed=1769,
        experiment_data_config=batchbald_redux.experiment_data.StandardExperimentDataConfig(
            id_dataset_name=&#39;EMNIST&#39;,
            id_repetitions=1,
            initial_training_set_size=0,
            validation_set_size=4096,
            validation_split_random_state=0,
            evaluation_set_size=0,
            add_dataset_noise=False,
            ood_dataset_config=None
        ),
        max_training_set=300,
        num_pool_samples=10,
        # class
        acquisition_function=batchbald_redux.acquisition_functions.BatchBALD,
        # class
        train_eval_model=batchbald_redux.train_eval_model.TrainSelfDistillationEvalModel,
        # class
        model_trainer_factory=batchbald_redux.emnist_models.EMnistModelTrainer,
        epig_bootstrap_type=batchbald_redux.batchbald.BootstrapType.NO_BOOTSTRAP
    )
]
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">store</span> <span class="o">=</span> <span class="p">{}</span>

<span class="c1"># configs[0].max_training_epochs = 1</span>
<span class="c1"># configs[0].num_pool_samples = 5</span>
<span class="c1"># configs[0].evaluation_set_size = 1024</span>
<span class="n">configs</span><span class="p">[</span><span class="mi">135</span><span class="p">]</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">store</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>StandardExperimentDataConfig(id_dataset_name=&#39;EMNIST&#39;, id_repetitions=1, initial_training_set_size=0, validation_set_size=4096, validation_split_random_state=0, evaluation_set_size=0, add_dataset_noise=False, ood_dataset_config=None)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/home/blackhc/anaconda3/envs/active_learning/lib/python3.8/site-packages/sklearn/utils/__init__.py:1102: DeprecationWarning: `np.int` is a deprecated alias for the builtin `int`. To silence this warning, use `int` by itself. Doing this will not modify any behavior and is safe. When replacing `np.int`, you may wish to use e.g. `np.int64` or `np.int32` to specify the precision. If you wish to review your current use, check the release note link for additional information.
Deprecated in NumPy 1.20; for more details and guidance: https://numpy.org/devdocs/release/1.20.0-notes.html#deprecations
  return floored.astype(np.int)
/home/blackhc/anaconda3/envs/active_learning/lib/python3.8/site-packages/sklearn/utils/__init__.py:1102: DeprecationWarning: `np.int` is a deprecated alias for the builtin `int`. To silence this warning, use `int` by itself. Doing this will not modify any behavior and is safe. When replacing `np.int`, you may wish to use e.g. `np.int64` or `np.int32` to specify the precision. If you wish to review your current use, check the release note link for additional information.
Deprecated in NumPy 1.20; for more details and guidance: https://numpy.org/devdocs/release/1.20.0-notes.html#deprecations
  return floored.astype(np.int)
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Creating: BatchBALD(
	acquisition_size=5,
	num_pool_samples=100
)
Creating: EMnistModelTrainer(
	device=cuda,
	num_training_samples=1,
	num_validation_samples=20,
	max_training_epochs=300
)
Creating: TrainSelfDistillationEvalModel(
	num_pool_samples=100
)
Training set size 0:
Perf after training {&#39;accuracy&#39;: 0.00783164120595239, &#39;crossentropy&#39;: tensor(3.8564)}
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">KeyboardInterrupt</span>                         Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-8-568184c2444e&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">      4</span> <span class="ansi-red-fg"># configs[0].num_pool_samples = 5</span>
<span class="ansi-green-intense-fg ansi-bold">      5</span> <span class="ansi-red-fg"># configs[0].evaluation_set_size = 1024</span>
<span class="ansi-green-fg">----&gt; 6</span><span class="ansi-red-fg"> </span>configs<span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">135</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">.</span>run<span class="ansi-blue-fg">(</span>store<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/PycharmProjects/bald-ical/batchbald_redux/unified_experiment.py</span> in <span class="ansi-cyan-fg">run</span><span class="ansi-blue-fg">(self, store)</span>
<span class="ansi-green-intense-fg ansi-bold">    269</span>         )
<span class="ansi-green-intense-fg ansi-bold">    270</span> 
<span class="ansi-green-fg">--&gt; 271</span><span class="ansi-red-fg">         </span>active_learner<span class="ansi-blue-fg">(</span>store<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    272</span> 
<span class="ansi-green-intense-fg ansi-bold">    273</span> <span class="ansi-red-fg"># Cell</span>

<span class="ansi-green-fg">~/PycharmProjects/bald-ical/batchbald_redux/unified_experiment.py</span> in <span class="ansi-cyan-fg">__call__</span><span class="ansi-blue-fg">(self, log)</span>
<span class="ansi-green-intense-fg ansi-bold">    128</span> 
<span class="ansi-green-intense-fg ansi-bold">    129</span>             <span class="ansi-green-fg">if</span> isinstance<span class="ansi-blue-fg">(</span>acquisition_function<span class="ansi-blue-fg">,</span> CandidateBatchComputer<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 130</span><span class="ansi-red-fg">                 </span>candidate_batch <span class="ansi-blue-fg">=</span> acquisition_function<span class="ansi-blue-fg">.</span>compute_candidate_batch<span class="ansi-blue-fg">(</span>trained_model<span class="ansi-blue-fg">,</span> pool_loader<span class="ansi-blue-fg">,</span> self<span class="ansi-blue-fg">.</span>device<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    131</span>             <span class="ansi-green-fg">elif</span> isinstance<span class="ansi-blue-fg">(</span>acquisition_function<span class="ansi-blue-fg">,</span> EvalDatasetBatchComputer<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    132</span>                 <span class="ansi-green-fg">if</span> len<span class="ansi-blue-fg">(</span>data<span class="ansi-blue-fg">.</span>evaluation_dataset<span class="ansi-blue-fg">)</span> <span class="ansi-blue-fg">&gt;</span> <span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/PycharmProjects/bald-ical/batchbald_redux/acquisition_functions.py</span> in <span class="ansi-cyan-fg">compute_candidate_batch</span><span class="ansi-blue-fg">(self, model, pool_loader, device)</span>
<span class="ansi-green-intense-fg ansi-bold">     79</span>         log_probs_N_K_C <span class="ansi-blue-fg">=</span> model<span class="ansi-blue-fg">.</span>get_log_probs_N_K_C<span class="ansi-blue-fg">(</span>pool_loader<span class="ansi-blue-fg">,</span> self<span class="ansi-blue-fg">.</span>num_pool_samples<span class="ansi-blue-fg">,</span> device<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">&#34;cpu&#34;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     80</span> 
<span class="ansi-green-fg">---&gt; 81</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>get_candidate_batch<span class="ansi-blue-fg">(</span>log_probs_N_K_C<span class="ansi-blue-fg">,</span> device<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     82</span> 
<span class="ansi-green-intense-fg ansi-bold">     83</span>     <span class="ansi-green-fg">def</span> get_candidate_batch<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> log_probs_N_K_C<span class="ansi-blue-fg">,</span> device<span class="ansi-blue-fg">)</span> <span class="ansi-blue-fg">-&gt;</span> CandidateBatch<span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/PycharmProjects/bald-ical/batchbald_redux/acquisition_functions.py</span> in <span class="ansi-cyan-fg">get_candidate_batch</span><span class="ansi-blue-fg">(self, log_probs_N_K_C, device)</span>
<span class="ansi-green-intense-fg ansi-bold">    175</span>     <span class="ansi-green-fg">def</span> get_candidate_batch<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> log_probs_N_K_C<span class="ansi-blue-fg">,</span> device<span class="ansi-blue-fg">)</span> <span class="ansi-blue-fg">-&gt;</span> CandidateBatch<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    176</span>         <span class="ansi-red-fg"># Evaluate BALD scores</span>
<span class="ansi-green-fg">--&gt; 177</span><span class="ansi-red-fg">         candidate_batch = get_batch_bald_batch(
</span><span class="ansi-green-intense-fg ansi-bold">    178</span>             log_probs_N_K_C<span class="ansi-blue-fg">,</span>
<span class="ansi-green-intense-fg ansi-bold">    179</span>             batch_size<span class="ansi-blue-fg">=</span>self<span class="ansi-blue-fg">.</span>acquisition_size<span class="ansi-blue-fg">,</span>

<span class="ansi-green-fg">~/PycharmProjects/bald-ical/batchbald_redux/batchbald.py</span> in <span class="ansi-cyan-fg">get_batch_bald_batch</span><span class="ansi-blue-fg">(log_probs_N_K_C, batch_size, num_samples, dtype, device)</span>
<span class="ansi-green-intense-fg ansi-bold">    138</span>         <span class="ansi-green-fg">return</span> CandidateBatch<span class="ansi-blue-fg">(</span>candidate_scores<span class="ansi-blue-fg">,</span> candidate_indices<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    139</span> 
<span class="ansi-green-fg">--&gt; 140</span><span class="ansi-red-fg">     batchbald_scorer = BatchBALDScorer(
</span><span class="ansi-green-intense-fg ansi-bold">    141</span>         log_probs_N_K_C<span class="ansi-blue-fg">,</span>
<span class="ansi-green-intense-fg ansi-bold">    142</span>         max_size<span class="ansi-blue-fg">=</span>batch_size <span class="ansi-blue-fg">-</span> <span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">,</span>

<span class="ansi-green-fg">~/PycharmProjects/bald-ical/batchbald_redux/batchbald.py</span> in <span class="ansi-cyan-fg">__init__</span><span class="ansi-blue-fg">(self, log_probs_N_K_C, max_size, num_samples, dtype, device)</span>
<span class="ansi-green-intense-fg ansi-bold">     97</span>         self<span class="ansi-blue-fg">.</span>log_probs_N_K_C <span class="ansi-blue-fg">=</span> log_probs_N_K_C
<span class="ansi-green-intense-fg ansi-bold">     98</span> 
<span class="ansi-green-fg">---&gt; 99</span><span class="ansi-red-fg">         </span>self<span class="ansi-blue-fg">.</span>conditional_entropies_N <span class="ansi-blue-fg">=</span> compute_conditional_entropy<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>log_probs_N_K_C<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    100</span>         self<span class="ansi-blue-fg">.</span>batch_conditional_entropies <span class="ansi-blue-fg">=</span> <span class="ansi-cyan-fg">0</span>
<span class="ansi-green-intense-fg ansi-bold">    101</span> 

<span class="ansi-green-fg">~/PycharmProjects/bald-ical/batchbald_redux/batchbald.py</span> in <span class="ansi-cyan-fg">compute_conditional_entropy</span><span class="ansi-blue-fg">(log_probs_N_K_C)</span>
<span class="ansi-green-intense-fg ansi-bold">     35</span>     entropies_N <span class="ansi-blue-fg">=</span> torch<span class="ansi-blue-fg">.</span>empty<span class="ansi-blue-fg">(</span>N<span class="ansi-blue-fg">,</span> dtype<span class="ansi-blue-fg">=</span>torch<span class="ansi-blue-fg">.</span>double<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     36</span> 
<span class="ansi-green-fg">---&gt; 37</span><span class="ansi-red-fg">     </span>log_probs_N_K_C <span class="ansi-blue-fg">=</span> log_probs_N_K_C<span class="ansi-blue-fg">.</span>to<span class="ansi-blue-fg">(</span>torch<span class="ansi-blue-fg">.</span>double<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     38</span> 
<span class="ansi-green-intense-fg ansi-bold">     39</span>     pbar <span class="ansi-blue-fg">=</span> create_progress_bar<span class="ansi-blue-fg">(</span>N<span class="ansi-blue-fg">,</span> tqdm_args<span class="ansi-blue-fg">=</span>dict<span class="ansi-blue-fg">(</span>desc<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">&#34;Conditional Entropy&#34;</span><span class="ansi-blue-fg">,</span> leave<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">False</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">KeyboardInterrupt</span>: </pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

