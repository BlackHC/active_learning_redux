---

title: Uniform Target OOD Experiment


keywords: fastai
sidebar: home_sidebar

summary: "Can we get better by training on our assumptions?"
description: "Can we get better by training on our assumptions?"
nb_path: "09d_uniform_target_ood_experiment.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 09d_uniform_target_ood_experiment.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Appended /home/blackhc/PycharmProjects/bald-ical/src to paths
Switched to directory /home/blackhc/PycharmProjects/bald-ical
%load_ext autoreload
%autoreload 2
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Import modules and functions were are going to use.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">dataclasses</span>
<span class="kn">import</span> <span class="nn">traceback</span>
<span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Type</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">torch.utils.data</span>
<span class="kn">from</span> <span class="nn">blackhc.project</span> <span class="kn">import</span> <span class="n">is_run_from_ipython</span>
<span class="kn">from</span> <span class="nn">blackhc.project.experiment</span> <span class="kn">import</span> <span class="n">embedded_experiments</span>
<span class="kn">from</span> <span class="nn">torch.utils.data</span> <span class="kn">import</span> <span class="n">Dataset</span>

<span class="kn">import</span> <span class="nn">batchbald_redux.acquisition_functions</span> <span class="k">as</span> <span class="nn">acquisition_functions</span>
<span class="kn">from</span> <span class="nn">batchbald_redux.acquisition_functions</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">CandidateBatchComputer</span><span class="p">,</span>
    <span class="n">EvalCandidateBatchComputer</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">batchbald_redux.active_learning</span> <span class="kn">import</span> <span class="n">ActiveLearningData</span><span class="p">,</span> <span class="n">RandomFixedLengthSampler</span>
<span class="kn">from</span> <span class="nn">batchbald_redux.black_box_model_training</span> <span class="kn">import</span> <span class="n">evaluate</span><span class="p">,</span> <span class="n">train</span>
<span class="kn">from</span> <span class="nn">batchbald_redux.dataset_challenges</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">AdditiveGaussianNoise</span><span class="p">,</span>
    <span class="n">AliasDataset</span><span class="p">,</span>
    <span class="n">NamedDataset</span><span class="p">,</span>
    <span class="n">get_base_dataset_index</span><span class="p">,</span>
    <span class="n">get_target</span><span class="p">,</span>
    <span class="n">get_balanced_sample_indices_by_class</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">batchbald_redux.datasets</span> <span class="kn">import</span> <span class="n">train_validation_split</span>
<span class="kn">from</span> <span class="nn">batchbald_redux.di</span> <span class="kn">import</span> <span class="n">DependencyInjection</span>
<span class="kn">from</span> <span class="nn">batchbald_redux.fast_mnist</span> <span class="kn">import</span> <span class="n">FastFashionMNIST</span><span class="p">,</span> <span class="n">FastMNIST</span>
<span class="kn">from</span> <span class="nn">batchbald_redux.model_optimizer_factory</span> <span class="kn">import</span> <span class="n">ModelOptimizerFactory</span>
<span class="kn">from</span> <span class="nn">batchbald_redux.models</span> <span class="kn">import</span> <span class="n">MnistOptimizerFactory</span>
<span class="kn">from</span> <span class="nn">batchbald_redux.train_eval_model</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">TrainEvalModel</span><span class="p">,</span>
    <span class="n">TrainSelfDistillationEvalModel</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">batchbald_redux.trained_model</span> <span class="kn">import</span> <span class="n">TrainedMCDropoutModel</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="ExperimentData" class="doc_header"><code>class</code> <code>ExperimentData</code><a href="https://github.com/blackhc/batchbald_redux/tree/master/batchbald_redux/uniform_target_ood_experiment.py#L48" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>ExperimentData</code>(<strong><code>active_learning</code></strong>:<a href="/batchbald_redux/active_learning.html#ActiveLearningData"><code>ActiveLearningData</code></a>, <strong><code>ood_dataset</code></strong>:<a href="/batchbald_redux/dataset_challenges.html#NamedDataset"><code>NamedDataset</code></a>, <strong><code>validation_dataset</code></strong>:<code>Dataset</code>, <strong><code>test_dataset</code></strong>:<code>Dataset</code>, <strong><code>evaluation_dataset</code></strong>:<code>Dataset</code>, <strong><code>initial_training_set_indices</code></strong>:<code>[&lt;class 'int'&gt;]</code>, <strong><code>evaluation_set_indices</code></strong>:<code>[&lt;class 'int'&gt;]</code>)</p>
</blockquote>
<p>ExperimentData(active_learning: batchbald_redux.active_learning.ActiveLearningData, ood_dataset: batchbald_redux.dataset_challenges.NamedDataset, validation_dataset: torch.utils.data.dataset.Dataset, test_dataset: torch.utils.data.dataset.Dataset, evaluation_dataset: torch.utils.data.dataset.Dataset, initial_training_set_indices: [&lt;class 'int'&gt;], evaluation_set_indices: [&lt;class 'int'&gt;])</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="UniformTargetOodExperiment" class="doc_header"><code>class</code> <code>UniformTargetOodExperiment</code><a href="https://github.com/blackhc/batchbald_redux/tree/master/batchbald_redux/uniform_target_ood_experiment.py#L59" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>UniformTargetOodExperiment</code>(<strong><code>seed</code></strong>:<code>int</code>=<em><code>1337</code></em>, <strong><code>acquisition_size</code></strong>:<code>int</code>=<em><code>5</code></em>, <strong><code>max_training_set</code></strong>:<code>int</code>=<em><code>450</code></em>, <strong><code>num_pool_samples</code></strong>:<code>int</code>=<em><code>20</code></em>, <strong><code>num_validation_samples</code></strong>:<code>int</code>=<em><code>20</code></em>, <strong><code>num_training_samples</code></strong>:<code>int</code>=<em><code>1</code></em>, <strong><code>num_patience_epochs</code></strong>:<code>int</code>=<em><code>3</code></em>, <strong><code>max_training_epochs</code></strong>:<code>int</code>=<em><code>30</code></em>, <strong><code>training_batch_size</code></strong>:<code>int</code>=<em><code>64</code></em>, <strong><code>device</code></strong>:<code>str</code>=<em><code>'cuda'</code></em>, <strong><code>validation_set_size</code></strong>:<code>int</code>=<em><code>1024</code></em>, <strong><code>evaluation_set_size</code></strong>:<code>int</code>=<em><code>100</code></em>, <strong><code>validation_split_random_state</code></strong>:<code>int</code>=<em><code>0</code></em>, <strong><code>initial_training_set_size</code></strong>:<code>int</code>=<em><code>20</code></em>, <strong><code>min_samples_per_epoch</code></strong>:<code>int</code>=<em><code>5056</code></em>, <strong><code>mnist_repetitions</code></strong>:<code>float</code>=<em><code>1</code></em>, <strong><code>ood_fmnist_repetitions</code></strong>:<code>float</code>=<em><code>1</code></em>, <strong><code>add_dataset_noise</code></strong>:<code>bool</code>=<em><code>False</code></em>, <strong><code>acquisition_function</code></strong>:<code>Union</code>[<code>Type</code>[<a href="/batchbald_redux/acquisition_functions.html#CandidateBatchComputer"><code>CandidateBatchComputer</code></a>], <code>Type</code>[<a href="/batchbald_redux/acquisition_functions.html#EvalCandidateBatchComputer"><code>EvalCandidateBatchComputer</code></a>]]=<em><code>BALD</code></em>, <strong><code>train_eval_model</code></strong>:<a href="/batchbald_redux/train_eval_model.html#TrainEvalModel"><code>TrainEvalModel</code></a>=<em><code>TrainSelfDistillationEvalModel</code></em>, <strong><code>model_optimizer_factory</code></strong>:<code>Type</code>[<a href="/batchbald_redux/model_optimizer_factory.html#ModelOptimizerFactory"><code>ModelOptimizerFactory</code></a>]=<em><code>MnistOptimizerFactory</code></em>, <strong><code>acquisition_function_args</code></strong>:<code>dict</code>=<em><code>None</code></em>, <strong><code>temperature</code></strong>:<code>float</code>=<em><code>0.0</code></em>)</p>
</blockquote>
<p>UniformTargetOodExperiment(seed: int = 1337, acquisition_size: int = 5, max_training_set: int = 450, num_pool_samples: int = 20, num_validation_samples: int = 20, num_training_samples: int = 1, num_patience_epochs: int = 3, max_training_epochs: int = 30, training_batch_size: int = 64, device: str = 'cuda', validation_set_size: int = 1024, evaluation_set_size: int = 100, validation_split_random_state: int = 0, initial_training_set_size: int = 20, min_samples_per_epoch: int = 5056, mnist_repetitions: float = 1, ood_fmnist_repetitions: float = 1, add_dataset_noise: bool = False, acquisition_function: Union[Type[batchbald_redux.acquisition_functions.CandidateBatchComputer], Type[batchbald_redux.acquisition_functions.EvalCandidateBatchComputer]] = &lt;class 'batchbald_redux.acquisition_functions.BALD'&gt;, train_eval_model: batchbald_redux.train_eval_model.TrainEvalModel = &lt;class 'batchbald_redux.train_eval_model.TrainSelfDistillationEvalModel'&gt;, model_optimizer_factory: Type[batchbald_redux.model_optimizer_factory.ModelOptimizerFactory] = &lt;class 'batchbald_redux.models.MnistOptimizerFactory'&gt;, acquisition_function_args: dict = None, temperature: float = 0.0)</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">ExperimentData</span><span class="p">:</span>
    <span class="n">active_learning</span><span class="p">:</span> <span class="n">ActiveLearningData</span>
    <span class="n">ood_dataset</span><span class="p">:</span> <span class="n">NamedDataset</span>
    <span class="n">validation_dataset</span><span class="p">:</span> <span class="n">Dataset</span>
    <span class="n">test_dataset</span><span class="p">:</span> <span class="n">Dataset</span>
    <span class="n">evaluation_dataset</span><span class="p">:</span> <span class="n">Dataset</span>
    <span class="n">initial_training_set_indices</span><span class="p">:</span> <span class="p">[</span><span class="nb">int</span><span class="p">]</span>
    <span class="n">evaluation_set_indices</span><span class="p">:</span> <span class="p">[</span><span class="nb">int</span><span class="p">]</span>


<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">UniformTargetOodExperiment</span><span class="p">:</span>
    <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1337</span>
    <span class="n">acquisition_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">max_training_set</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">450</span>
    <span class="n">num_pool_samples</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span>
    <span class="n">num_validation_samples</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span>
    <span class="n">num_training_samples</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">num_patience_epochs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">max_training_epochs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span>
    <span class="n">training_batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">64</span>
    <span class="n">device</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;cuda&quot;</span>
    <span class="n">validation_set_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1024</span>
    <span class="n">evaluation_set_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="mi">10</span>
    <span class="n">validation_split_random_state</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">initial_training_set_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span>
    <span class="n">min_samples_per_epoch</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5056</span>
    <span class="n">mnist_repetitions</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">ood_fmnist_repetitions</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">add_dataset_noise</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">acquisition_function</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span>
        <span class="n">Type</span><span class="p">[</span><span class="n">CandidateBatchComputer</span><span class="p">],</span> <span class="n">Type</span><span class="p">[</span><span class="n">EvalCandidateBatchComputer</span><span class="p">]</span>
    <span class="p">]</span> <span class="o">=</span> <span class="n">acquisition_functions</span><span class="o">.</span><span class="n">BALD</span>
    <span class="n">train_eval_model</span><span class="p">:</span> <span class="n">TrainEvalModel</span> <span class="o">=</span> <span class="n">TrainSelfDistillationEvalModel</span>
    <span class="n">model_optimizer_factory</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">ModelOptimizerFactory</span><span class="p">]</span> <span class="o">=</span> <span class="n">MnistOptimizerFactory</span>
    <span class="n">acquisition_function_args</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">temperature</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="k">def</span> <span class="nf">load_experiment_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ExperimentData</span><span class="p">:</span>
        <span class="c1"># num_classes = 10, input_size = 28</span>
        <span class="n">full_train_dataset</span> <span class="o">=</span> <span class="n">NamedDataset</span><span class="p">(</span>
            <span class="n">FastFashionMNIST</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">train</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">download</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">),</span> <span class="s2">&quot;FastFashionMNIST (train)&quot;</span>
        <span class="p">)</span>

        <span class="n">ood_dataset</span> <span class="o">=</span> <span class="n">FastMNIST</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">train</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">download</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
        <span class="n">ood_dataset</span> <span class="o">=</span> <span class="n">NamedDataset</span><span class="p">(</span><span class="n">ood_dataset</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;OoD Dataset: FastMNIST (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">ood_dataset</span><span class="p">)</span><span class="si">}</span><span class="s2"> samples)&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ood_fmnist_repetitions</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">ood_dataset</span> <span class="o">=</span> <span class="n">ood_dataset</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ood_fmnist_repetitions</span>

        <span class="n">train_dataset</span><span class="p">,</span> <span class="n">validation_dataset</span> <span class="o">=</span> <span class="n">train_validation_split</span><span class="p">(</span>
            <span class="n">full_train_dataset</span><span class="o">=</span><span class="n">full_train_dataset</span><span class="p">,</span>
            <span class="n">full_validation_dataset</span><span class="o">=</span><span class="n">full_train_dataset</span><span class="p">,</span>
            <span class="n">train_labels</span><span class="o">=</span><span class="n">full_train_dataset</span><span class="o">.</span><span class="n">get_targets</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">(),</span>
            <span class="n">validation_set_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">validation_set_size</span><span class="p">,</span>
            <span class="n">validation_split_random_state</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">validation_split_random_state</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">train_dataset</span> <span class="o">=</span> <span class="n">AliasDataset</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;FastFashionMNIST (train; </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">)</span><span class="si">}</span><span class="s2"> samples)&quot;</span><span class="p">)</span>
        <span class="n">validation_dataset</span> <span class="o">=</span> <span class="n">AliasDataset</span><span class="p">(</span>
            <span class="n">validation_dataset</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;FastFashionMNIST (validation; </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">validation_dataset</span><span class="p">)</span><span class="si">}</span><span class="s2"> samples)&quot;</span>
        <span class="p">)</span>

        <span class="c1"># If we reduce the train set, we need to do so before picking the initial train set.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mnist_repetitions</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">train_dataset</span> <span class="o">=</span> <span class="n">train_dataset</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">mnist_repetitions</span>

        <span class="n">num_classes</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="o">.</span><span class="n">get_num_classes</span><span class="p">()</span>
        <span class="n">initial_samples_per_class</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_training_set_size</span> <span class="o">//</span> <span class="n">num_classes</span>
        <span class="n">evaluation_set_samples_per_class</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_set_size</span> <span class="o">//</span> <span class="n">num_classes</span>
        <span class="n">samples_per_class</span> <span class="o">=</span> <span class="n">initial_samples_per_class</span> <span class="o">+</span> <span class="n">evaluation_set_samples_per_class</span>
        <span class="n">balanced_samples_indices</span> <span class="o">=</span> <span class="n">get_balanced_sample_indices_by_class</span><span class="p">(</span>
            <span class="n">train_dataset</span><span class="p">,</span>
            <span class="n">num_classes</span><span class="o">=</span><span class="n">num_classes</span><span class="p">,</span>
            <span class="n">samples_per_class</span><span class="o">=</span><span class="n">samples_per_class</span><span class="p">,</span>
            <span class="n">seed</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">validation_split_random_state</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">initial_training_set_indices</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">idx</span> <span class="k">for</span> <span class="n">by_class</span> <span class="ow">in</span> <span class="n">balanced_samples_indices</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">by_class</span><span class="p">[:</span><span class="n">initial_samples_per_class</span><span class="p">]</span>
        <span class="p">]</span>
        <span class="n">evaluation_set_indices</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">idx</span> <span class="k">for</span> <span class="n">by_class</span> <span class="ow">in</span> <span class="n">balanced_samples_indices</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">by_class</span><span class="p">[</span><span class="n">initial_samples_per_class</span><span class="p">:]</span>
        <span class="p">]</span>

        <span class="c1"># If we over-sample the train set, we do so after picking the initial train set to avoid duplicates.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mnist_repetitions</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">train_dataset</span> <span class="o">=</span> <span class="n">train_dataset</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">mnist_repetitions</span>

        <span class="n">train_dataset</span> <span class="o">=</span> <span class="n">train_dataset</span><span class="o">.</span><span class="n">one_hot</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span> <span class="o">+</span> <span class="n">ood_dataset</span><span class="o">.</span><span class="n">uniform_target</span><span class="p">(</span><span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">add_dataset_noise</span><span class="p">:</span>
            <span class="n">train_dataset</span> <span class="o">=</span> <span class="n">AdditiveGaussianNoise</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>

        <span class="n">test_dataset</span> <span class="o">=</span> <span class="n">FastFashionMNIST</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="n">train</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">test_dataset</span> <span class="o">=</span> <span class="n">NamedDataset</span><span class="p">(</span><span class="n">test_dataset</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;FastFashionMNIST (test, </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">test_dataset</span><span class="p">)</span><span class="si">}</span><span class="s2"> samples)&quot;</span><span class="p">)</span>

        <span class="n">active_learning_data</span> <span class="o">=</span> <span class="n">ActiveLearningData</span><span class="p">(</span><span class="n">train_dataset</span><span class="p">)</span>

        <span class="n">active_learning_data</span><span class="o">.</span><span class="n">acquire_base_indices</span><span class="p">(</span><span class="n">initial_training_set_indices</span><span class="p">)</span>
        <span class="n">evaluation_dataset</span> <span class="o">=</span> <span class="n">AliasDataset</span><span class="p">(</span>
            <span class="n">active_learning_data</span><span class="o">.</span><span class="n">extract_dataset_from_base_indices</span><span class="p">(</span><span class="n">evaluation_set_indices</span><span class="p">),</span>
            <span class="sa">f</span><span class="s2">&quot;Evaluation Set (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">evaluation_set_indices</span><span class="p">)</span><span class="si">}</span><span class="s2"> samples)&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">ExperimentData</span><span class="p">(</span>
            <span class="n">active_learning</span><span class="o">=</span><span class="n">active_learning_data</span><span class="p">,</span>
            <span class="n">ood_dataset</span><span class="o">=</span><span class="n">ood_dataset</span><span class="p">,</span>
            <span class="n">validation_dataset</span><span class="o">=</span><span class="n">validation_dataset</span><span class="p">,</span>
            <span class="n">test_dataset</span><span class="o">=</span><span class="n">test_dataset</span><span class="p">,</span>
            <span class="n">evaluation_dataset</span><span class="o">=</span><span class="n">evaluation_dataset</span><span class="p">,</span>
            <span class="n">initial_training_set_indices</span><span class="o">=</span><span class="n">initial_training_set_indices</span><span class="p">,</span>
            <span class="n">evaluation_set_indices</span><span class="o">=</span><span class="n">evaluation_set_indices</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># Simple Dependency Injection</span>
    <span class="k">def</span> <span class="nf">create_acquisition_function</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">di</span> <span class="o">=</span> <span class="n">DependencyInjection</span><span class="p">(</span><span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">di</span><span class="o">.</span><span class="n">create_dataclass_type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">acquisition_function</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">create_train_eval_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">runtime_config</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TrainEvalModel</span><span class="p">:</span>
        <span class="n">config</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="nb">vars</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="o">**</span><span class="n">runtime_config</span><span class="p">}</span>
        <span class="n">di</span> <span class="o">=</span> <span class="n">DependencyInjection</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">return</span> <span class="n">di</span><span class="o">.</span><span class="n">create_dataclass_type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">train_eval_model</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">store</span><span class="p">):</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>

        <span class="c1"># Active Learning setup</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_experiment_data</span><span class="p">()</span>
        <span class="n">store</span><span class="p">[</span><span class="s2">&quot;dataset_info&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">training</span><span class="o">=</span><span class="nb">repr</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">active_learning</span><span class="o">.</span><span class="n">base_dataset</span><span class="p">),</span> <span class="n">test</span><span class="o">=</span><span class="nb">repr</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">test_dataset</span><span class="p">))</span>
        <span class="n">store</span><span class="p">[</span><span class="s2">&quot;initial_training_set_indices&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">initial_training_set_indices</span>
        <span class="n">store</span><span class="p">[</span><span class="s2">&quot;evaluation_set_indices&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">evaluation_set_indices</span>

        <span class="n">train_loader</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">(</span>
            <span class="n">data</span><span class="o">.</span><span class="n">active_learning</span><span class="o">.</span><span class="n">training_dataset</span><span class="p">,</span>
            <span class="n">batch_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">training_batch_size</span><span class="p">,</span>
            <span class="n">sampler</span><span class="o">=</span><span class="n">RandomFixedLengthSampler</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">active_learning</span><span class="o">.</span><span class="n">training_dataset</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_samples_per_epoch</span><span class="p">),</span>
            <span class="n">drop_last</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">pool_loader</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">(</span>
            <span class="n">data</span><span class="o">.</span><span class="n">active_learning</span><span class="o">.</span><span class="n">pool_dataset</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">drop_last</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>

        <span class="n">validation_loader</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">validation_dataset</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">drop_last</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">test_loader</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataLoader</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">test_dataset</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">drop_last</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="n">store</span><span class="p">[</span><span class="s2">&quot;active_learning_steps&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">active_learning_steps</span> <span class="o">=</span> <span class="n">store</span><span class="p">[</span><span class="s2">&quot;active_learning_steps&quot;</span><span class="p">]</span>

        <span class="n">acquisition_function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_acquisition_function</span><span class="p">()</span>

        <span class="c1"># Active Training Loop</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">training_set_size</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">active_learning</span><span class="o">.</span><span class="n">training_dataset</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Training set size </span><span class="si">{</span><span class="n">training_set_size</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>

            <span class="c1"># iteration_log = dict(training={}, pool_training={}, evaluation_metrics=None, acquisition=None)</span>
            <span class="n">active_learning_steps</span><span class="o">.</span><span class="n">append</span><span class="p">({})</span>
            <span class="n">iteration_log</span> <span class="o">=</span> <span class="n">active_learning_steps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

            <span class="n">iteration_log</span><span class="p">[</span><span class="s2">&quot;training&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="n">model_optimizer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_optimizer_factory</span><span class="p">()</span><span class="o">.</span><span class="n">create_model_optimizer</span><span class="p">()</span>

            <span class="n">loss</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">KLDivLoss</span><span class="p">(</span><span class="n">log_target</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">reduction</span><span class="o">=</span><span class="s2">&quot;batchmean&quot;</span><span class="p">)</span>

            <span class="n">train</span><span class="p">(</span>
                <span class="n">model</span><span class="o">=</span><span class="n">model_optimizer</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
                <span class="n">optimizer</span><span class="o">=</span><span class="n">model_optimizer</span><span class="o">.</span><span class="n">optimizer</span><span class="p">,</span>
                <span class="n">training_samples</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_training_samples</span><span class="p">,</span>
                <span class="n">validation_samples</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_validation_samples</span><span class="p">,</span>
                <span class="n">train_loader</span><span class="o">=</span><span class="n">train_loader</span><span class="p">,</span>
                <span class="n">validation_loader</span><span class="o">=</span><span class="n">validation_loader</span><span class="p">,</span>
                <span class="n">patience</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_patience_epochs</span><span class="p">,</span>
                <span class="n">max_epochs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_training_epochs</span><span class="p">,</span>
                <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span>
                <span class="n">training_log</span><span class="o">=</span><span class="n">iteration_log</span><span class="p">[</span><span class="s2">&quot;training&quot;</span><span class="p">],</span>
                <span class="n">loss</span><span class="o">=</span><span class="n">loss</span><span class="p">,</span>
                <span class="n">validation_loss</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">NLLLoss</span><span class="p">(),</span>
            <span class="p">)</span>

            <span class="n">evaluation_metrics</span> <span class="o">=</span> <span class="n">evaluate</span><span class="p">(</span>
                <span class="n">model</span><span class="o">=</span><span class="n">model_optimizer</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
                <span class="n">num_samples</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_validation_samples</span><span class="p">,</span>
                <span class="n">loader</span><span class="o">=</span><span class="n">test_loader</span><span class="p">,</span>
                <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">iteration_log</span><span class="p">[</span><span class="s2">&quot;evaluation_metrics&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">evaluation_metrics</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Perf after training </span><span class="si">{</span><span class="n">evaluation_metrics</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">training_set_size</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_training_set</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Done.&quot;</span><span class="p">)</span>
                <span class="k">break</span>

            <span class="n">trained_model</span> <span class="o">=</span> <span class="n">TrainedMCDropoutModel</span><span class="p">(</span><span class="n">num_samples</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_pool_samples</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">model_optimizer</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">acquisition_function</span><span class="p">,</span> <span class="n">CandidateBatchComputer</span><span class="p">):</span>
                <span class="n">candidate_batch</span> <span class="o">=</span> <span class="n">acquisition_function</span><span class="o">.</span><span class="n">compute_candidate_batch</span><span class="p">(</span><span class="n">trained_model</span><span class="p">,</span> <span class="n">pool_loader</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">acquisition_function</span><span class="p">,</span> <span class="n">EvalCandidateBatchComputer</span><span class="p">):</span>
                <span class="n">current_max_epochs</span> <span class="o">=</span> <span class="n">iteration_log</span><span class="p">[</span><span class="s2">&quot;training&quot;</span><span class="p">][</span><span class="s2">&quot;best_epoch&quot;</span><span class="p">]</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluation_set_size</span><span class="p">:</span>
                    <span class="n">eval_dataset</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">evaluation_dataset</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">eval_dataset</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">active_learning</span><span class="o">.</span><span class="n">pool_dataset</span>

                <span class="n">train_eval_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_train_eval_model</span><span class="p">(</span>
                    <span class="nb">dict</span><span class="p">(</span>
                        <span class="n">max_epochs</span><span class="o">=</span><span class="n">current_max_epochs</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="n">training_dataset</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">active_learning</span><span class="o">.</span><span class="n">training_dataset</span><span class="p">,</span>
                        <span class="n">eval_dataset</span><span class="o">=</span><span class="n">eval_dataset</span><span class="p">,</span>
                        <span class="n">validation_loader</span><span class="o">=</span><span class="n">validation_loader</span><span class="p">,</span>
                        <span class="n">trained_model</span><span class="o">=</span><span class="n">trained_model</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>

                <span class="n">iteration_log</span><span class="p">[</span><span class="s2">&quot;eval_training&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">trained_eval_model</span> <span class="o">=</span> <span class="n">train_eval_model</span><span class="p">(</span><span class="n">training_log</span><span class="o">=</span><span class="n">iteration_log</span><span class="p">[</span><span class="s2">&quot;eval_training&quot;</span><span class="p">],</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>

                <span class="n">candidate_batch</span> <span class="o">=</span> <span class="n">acquisition_function</span><span class="o">.</span><span class="n">compute_candidate_batch</span><span class="p">(</span>
                    <span class="n">trained_model</span><span class="p">,</span> <span class="n">trained_eval_model</span><span class="p">,</span> <span class="n">pool_loader</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown acquisition function </span><span class="si">{</span><span class="n">acquisition_function</span><span class="si">}</span><span class="s2">!&quot;</span><span class="p">)</span>

            <span class="n">candidate_global_dataset_indices</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">candidate_labels</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">candidate_batch</span><span class="o">.</span><span class="n">indices</span><span class="p">:</span>
                <span class="n">base_di</span> <span class="o">=</span> <span class="n">get_base_dataset_index</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">active_learning</span><span class="o">.</span><span class="n">pool_dataset</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
                <span class="n">dataset_type</span> <span class="o">=</span> <span class="s2">&quot;ood&quot;</span> <span class="k">if</span> <span class="n">base_di</span><span class="o">.</span><span class="n">dataset</span> <span class="o">==</span> <span class="n">data</span><span class="o">.</span><span class="n">ood_dataset</span> <span class="k">else</span> <span class="s2">&quot;id&quot;</span>
                <span class="n">candidate_global_dataset_indices</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">dataset_type</span><span class="p">,</span> <span class="n">base_di</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
                <span class="n">label</span> <span class="o">=</span> <span class="n">get_target</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">active_learning</span><span class="o">.</span><span class="n">pool_dataset</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
                <span class="n">candidate_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>

            <span class="n">iteration_log</span><span class="p">[</span><span class="s2">&quot;acquisition&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
                <span class="n">indices</span><span class="o">=</span><span class="n">candidate_global_dataset_indices</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">candidate_labels</span><span class="p">,</span> <span class="n">scores</span><span class="o">=</span><span class="n">candidate_batch</span><span class="o">.</span><span class="n">scores</span>
            <span class="p">)</span>

            <span class="n">data</span><span class="o">.</span><span class="n">active_learning</span><span class="o">.</span><span class="n">acquire</span><span class="p">(</span><span class="n">candidate_batch</span><span class="o">.</span><span class="n">indices</span><span class="p">)</span>

            <span class="nb">print</span><span class="p">(</span><span class="n">candidate_batch</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">candidate_global_dataset_indices</span><span class="p">)</span>

            <span class="n">ls</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">score</span><span class="si">:</span><span class="s2">.4</span><span class="si">}</span><span class="s2">)&quot;</span> <span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">score</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">candidate_labels</span><span class="p">,</span> <span class="n">candidate_batch</span><span class="o">.</span><span class="n">scores</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Acquiring (label, score)s: </span><span class="si">{</span><span class="n">ls</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">UniformTargetOodExperiment</span><span class="p">(</span><span class="n">mnist_repetitions</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span><span class="n">device</span><span class="o">=</span><span class="s2">&quot;cpu&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">load_experiment_data</span><span class="p">()</span><span class="o">.</span><span class="n">active_learning</span><span class="o">.</span><span class="n">base_dataset</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>((FastMNIST (train; 58976 samples))~x0.1 | one_hot_targets{&#39;num_classes&#39;: 10}) + (&#39;OoD Dataset (60000 samples)&#39; | uniform_targets{&#39;num_classes&#39;: 10})</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">experiment</span> <span class="o">=</span> <span class="n">UniformTargetOodExperiment</span><span class="p">(</span>
    <span class="n">seed</span><span class="o">=</span><span class="mi">1120</span><span class="p">,</span>
    <span class="n">max_training_epochs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">num_patience_epochs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">max_training_set</span><span class="o">=</span><span class="mi">20</span><span class="o">+</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">acquisition_function</span><span class="o">=</span><span class="n">acquisition_functions</span><span class="o">.</span><span class="n">BALD</span><span class="p">,</span>
    <span class="n">acquisition_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">num_pool_samples</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">temperature</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
    <span class="n">mnist_repetitions</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">device</span><span class="o">=</span><span class="s2">&quot;cuda&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">experiment</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>

<span class="n">experiment</span> <span class="o">=</span> <span class="n">UniformTargetOodExperiment</span><span class="p">(</span>
    <span class="n">seed</span><span class="o">=</span><span class="mi">1120</span><span class="p">,</span>
    <span class="n">max_training_epochs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">num_patience_epochs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">max_training_set</span><span class="o">=</span><span class="mi">20</span><span class="o">+</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">acquisition_function</span><span class="o">=</span><span class="n">acquisition_functions</span><span class="o">.</span><span class="n">EvalBALD</span><span class="p">,</span>
    <span class="n">acquisition_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">num_pool_samples</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">temperature</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
    <span class="n">mnist_repetitions</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">device</span><span class="o">=</span><span class="s2">&quot;cuda&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">experiment</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">KeyboardInterrupt</span>                         Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-5-e1b8b325830d&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">     15</span> 
<span class="ansi-green-intense-fg ansi-bold">     16</span> results <span class="ansi-blue-fg">=</span> <span class="ansi-blue-fg">{</span><span class="ansi-blue-fg">}</span>
<span class="ansi-green-fg">---&gt; 17</span><span class="ansi-red-fg"> </span>experiment<span class="ansi-blue-fg">.</span>run<span class="ansi-blue-fg">(</span>results<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     18</span> 
<span class="ansi-green-intense-fg ansi-bold">     19</span> experiment = UniformTargetOodExperiment(

<span class="ansi-green-fg">&lt;ipython-input-3-d3e5f8584d5b&gt;</span> in <span class="ansi-cyan-fg">run</span><span class="ansi-blue-fg">(self, store)</span>
<span class="ansi-green-intense-fg ansi-bold">    130</span> 
<span class="ansi-green-intense-fg ansi-bold">    131</span>         <span class="ansi-red-fg"># Active Learning setup</span>
<span class="ansi-green-fg">--&gt; 132</span><span class="ansi-red-fg">         </span>data <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>load_experiment_data<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    133</span>         store<span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">&#34;dataset_info&#34;</span><span class="ansi-blue-fg">]</span> <span class="ansi-blue-fg">=</span> dict<span class="ansi-blue-fg">(</span>training<span class="ansi-blue-fg">=</span>repr<span class="ansi-blue-fg">(</span>data<span class="ansi-blue-fg">.</span>active_learning<span class="ansi-blue-fg">.</span>base_dataset<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span> test<span class="ansi-blue-fg">=</span>repr<span class="ansi-blue-fg">(</span>data<span class="ansi-blue-fg">.</span>test_dataset<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    134</span>         store<span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">&#34;initial_training_set_indices&#34;</span><span class="ansi-blue-fg">]</span> <span class="ansi-blue-fg">=</span> data<span class="ansi-blue-fg">.</span>initial_training_set_indices

<span class="ansi-green-fg">&lt;ipython-input-3-d3e5f8584d5b&gt;</span> in <span class="ansi-cyan-fg">load_experiment_data</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">     90</span>             train_dataset <span class="ansi-blue-fg">=</span> train_dataset <span class="ansi-blue-fg">*</span> self<span class="ansi-blue-fg">.</span>mnist_repetitions
<span class="ansi-green-intense-fg ansi-bold">     91</span> 
<span class="ansi-green-fg">---&gt; 92</span><span class="ansi-red-fg">         </span>train_dataset <span class="ansi-blue-fg">=</span> train_dataset<span class="ansi-blue-fg">.</span>one_hot<span class="ansi-blue-fg">(</span>device<span class="ansi-blue-fg">=</span>self<span class="ansi-blue-fg">.</span>device<span class="ansi-blue-fg">)</span> <span class="ansi-blue-fg">+</span> ood_dataset<span class="ansi-blue-fg">.</span>uniform_target<span class="ansi-blue-fg">(</span>device<span class="ansi-blue-fg">=</span>self<span class="ansi-blue-fg">.</span>device<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     93</span> 
<span class="ansi-green-intense-fg ansi-bold">     94</span>         <span class="ansi-green-fg">if</span> self<span class="ansi-blue-fg">.</span>add_dataset_noise<span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/PycharmProjects/bald-ical/batchbald_redux/dataset_challenges.py</span> in <span class="ansi-cyan-fg">one_hot</span><span class="ansi-blue-fg">(self, dtype, device)</span>
<span class="ansi-green-intense-fg ansi-bold">    517</span> <span class="ansi-blue-fg">@</span>patch
<span class="ansi-green-intense-fg ansi-bold">    518</span> <span class="ansi-green-fg">def</span> one_hot<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">:</span> AliasDataset<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">*</span><span class="ansi-blue-fg">,</span> dtype<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">,</span> device<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 519</span><span class="ansi-red-fg">     </span><span class="ansi-green-fg">return</span> OneHotDataset<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> dtype<span class="ansi-blue-fg">=</span>dtype<span class="ansi-blue-fg">,</span> device<span class="ansi-blue-fg">=</span>device<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    520</span> 
<span class="ansi-green-intense-fg ansi-bold">    521</span> 

<span class="ansi-green-fg">~/PycharmProjects/bald-ical/batchbald_redux/dataset_challenges.py</span> in <span class="ansi-cyan-fg">__init__</span><span class="ansi-blue-fg">(self, dataset, num_classes, dtype, device)</span>
<span class="ansi-green-intense-fg ansi-bold">    508</span>         targets <span class="ansi-blue-fg">=</span> torch<span class="ansi-blue-fg">.</span>zeros<span class="ansi-blue-fg">(</span>N<span class="ansi-blue-fg">,</span> num_classes<span class="ansi-blue-fg">,</span> dtype<span class="ansi-blue-fg">=</span>dtype<span class="ansi-blue-fg">,</span> device<span class="ansi-blue-fg">=</span>device<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    509</span>         <span class="ansi-red-fg"># TODO: use get_targets() here, which will require a refactoring</span>
<span class="ansi-green-fg">--&gt; 510</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">for</span> i<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">(</span>_<span class="ansi-blue-fg">,</span> label<span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">in</span> enumerate<span class="ansi-blue-fg">(</span>dataset<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    511</span>             targets<span class="ansi-blue-fg">[</span>i<span class="ansi-blue-fg">,</span> label<span class="ansi-blue-fg">]</span> <span class="ansi-blue-fg">=</span> <span class="ansi-cyan-fg">1.0</span>
<span class="ansi-green-intense-fg ansi-bold">    512</span> 

<span class="ansi-green-fg">~/PycharmProjects/bald-ical/batchbald_redux/dataset_challenges.py</span> in <span class="ansi-cyan-fg">__getitem__</span><span class="ansi-blue-fg">(self, idx)</span>
<span class="ansi-green-intense-fg ansi-bold">     48</span> 
<span class="ansi-green-intense-fg ansi-bold">     49</span>     <span class="ansi-green-fg">def</span> __getitem__<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> idx<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">---&gt; 50</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>dataset<span class="ansi-blue-fg">[</span>idx<span class="ansi-blue-fg">]</span>
<span class="ansi-green-intense-fg ansi-bold">     51</span> 
<span class="ansi-green-intense-fg ansi-bold">     52</span>     <span class="ansi-green-fg">def</span> __len__<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/anaconda3/envs/active_learning/lib/python3.8/site-packages/torch/utils/data/dataset.py</span> in <span class="ansi-cyan-fg">__getitem__</span><span class="ansi-blue-fg">(self, idx)</span>
<span class="ansi-green-intense-fg ansi-bold">    270</span> 
<span class="ansi-green-intense-fg ansi-bold">    271</span>     <span class="ansi-green-fg">def</span> __getitem__<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> idx<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 272</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>dataset<span class="ansi-blue-fg">[</span>self<span class="ansi-blue-fg">.</span>indices<span class="ansi-blue-fg">[</span>idx<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">]</span>
<span class="ansi-green-intense-fg ansi-bold">    273</span> 
<span class="ansi-green-intense-fg ansi-bold">    274</span>     <span class="ansi-green-fg">def</span> __len__<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/PycharmProjects/bald-ical/batchbald_redux/dataset_challenges.py</span> in <span class="ansi-cyan-fg">__getitem__</span><span class="ansi-blue-fg">(self, idx)</span>
<span class="ansi-green-intense-fg ansi-bold">     48</span> 
<span class="ansi-green-intense-fg ansi-bold">     49</span>     <span class="ansi-green-fg">def</span> __getitem__<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> idx<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">---&gt; 50</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>dataset<span class="ansi-blue-fg">[</span>idx<span class="ansi-blue-fg">]</span>
<span class="ansi-green-intense-fg ansi-bold">     51</span> 
<span class="ansi-green-intense-fg ansi-bold">     52</span>     <span class="ansi-green-fg">def</span> __len__<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/PycharmProjects/bald-ical/batchbald_redux/fast_mnist.py</span> in <span class="ansi-cyan-fg">__getitem__</span><span class="ansi-blue-fg">(self, index)</span>
<span class="ansi-green-intense-fg ansi-bold">     36</span>             tuple<span class="ansi-blue-fg">:</span> <span class="ansi-blue-fg">(</span>image<span class="ansi-blue-fg">,</span> target<span class="ansi-blue-fg">)</span> where target <span class="ansi-green-fg">is</span> index of the target <span class="ansi-green-fg">class</span><span class="ansi-blue-fg">.</span>
<span class="ansi-green-intense-fg ansi-bold">     37</span>         &#34;&#34;&#34;
<span class="ansi-green-fg">---&gt; 38</span><span class="ansi-red-fg">         </span>img<span class="ansi-blue-fg">,</span> target <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>data<span class="ansi-blue-fg">[</span>index<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">,</span> self<span class="ansi-blue-fg">.</span>targets<span class="ansi-blue-fg">[</span>index<span class="ansi-blue-fg">]</span>
<span class="ansi-green-intense-fg ansi-bold">     39</span> 
<span class="ansi-green-intense-fg ansi-bold">     40</span>         <span class="ansi-green-fg">return</span> img<span class="ansi-blue-fg">,</span> target

<span class="ansi-red-fg">KeyboardInterrupt</span>: </pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">results</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;dataset_info&#39;: {&#39;training&#39;: &#34;(FastMNIST (train; 58976 samples)) + (&#39;OoD Dataset (60000 samples)&#39; | constant_target{&#39;target&#39;: tensor(-1, device=&#39;cuda:0&#39;), &#39;num_classes&#39;: 10})&#34;,
  &#39;test&#39;: &#34;&#39;FastMNIST (test, 10000 samples)&#39;&#34;},
 &#39;initial_training_set_indices&#39;: [30392,
  53434,
  12640,
  8533,
  22304,
  37915,
  58226,
  44119,
  3091,
  14640,
  58125,
  39579,
  43812,
  53689,
  52296,
  46037,
  22015,
  40334,
  57520,
  43803],
 &#39;active_learning_steps&#39;: [{&#39;training&#39;: {&#39;epochs&#39;: [], &#39;best_epoch&#39;: None},
   &#39;evaluation_metrics&#39;: {&#39;accuracy&#39;: 0.1129,
    &#39;crossentropy&#39;: 2.35244740562439},
   &#39;acquisition&#39;: {&#39;indices&#39;: [(&#39;ood&#39;, 27822),
     (&#39;id&#39;, 32367),
     (&#39;id&#39;, 55086),
     (&#39;id&#39;, 53929),
     (&#39;id&#39;, 48696),
     (&#39;ood&#39;, 37815),
     (&#39;ood&#39;, 47304),
     (&#39;ood&#39;, 28667),
     (&#39;ood&#39;, 40866),
     (&#39;ood&#39;, 35119)],
    &#39;labels&#39;: [-1, 1, 7, 6, 2, -1, -1, -1, -1, -1],
    &#39;scores&#39;: [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]}},
  {&#39;training&#39;: {&#39;epochs&#39;: [], &#39;best_epoch&#39;: None},
   &#39;evaluation_metrics&#39;: {&#39;accuracy&#39;: 0.071,
    &#39;crossentropy&#39;: 2.376102001571655},
   &#39;acquisition&#39;: {&#39;indices&#39;: [(&#39;id&#39;, 41002),
     (&#39;id&#39;, 35972),
     (&#39;ood&#39;, 49270),
     (&#39;id&#39;, 37994),
     (&#39;id&#39;, 44052),
     (&#39;ood&#39;, 16809),
     (&#39;ood&#39;, 24609),
     (&#39;ood&#39;, 33944),
     (&#39;id&#39;, 58767),
     (&#39;id&#39;, 6319)],
    &#39;labels&#39;: [7, 0, -1, 7, 4, -1, -1, -1, 1, 7],
    &#39;scores&#39;: [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]}},
  {&#39;training&#39;: {&#39;epochs&#39;: [], &#39;best_epoch&#39;: None},
   &#39;evaluation_metrics&#39;: {&#39;accuracy&#39;: 0.111,
    &#39;crossentropy&#39;: 2.3350587436676027},
   &#39;acquisition&#39;: {&#39;indices&#39;: [(&#39;ood&#39;, 56587),
     (&#39;id&#39;, 20397),
     (&#39;id&#39;, 6873),
     (&#39;id&#39;, 56019),
     (&#39;id&#39;, 48733),
     (&#39;ood&#39;, 1957),
     (&#39;id&#39;, 26231),
     (&#39;ood&#39;, 14359),
     (&#39;id&#39;, 41930),
     (&#39;id&#39;, 1835)],
    &#39;labels&#39;: [-1, 3, 8, 8, 5, -1, 8, -1, 4, 6],
    &#39;scores&#39;: [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]}},
  {&#39;training&#39;: {&#39;epochs&#39;: [], &#39;best_epoch&#39;: None},
   &#39;evaluation_metrics&#39;: {&#39;accuracy&#39;: 0.1119,
    &#39;crossentropy&#39;: 2.3316191219329836},
   &#39;acquisition&#39;: {&#39;indices&#39;: [(&#39;id&#39;, 43865),
     (&#39;id&#39;, 53636),
     (&#39;id&#39;, 27693),
     (&#39;id&#39;, 35820),
     (&#39;id&#39;, 2731),
     (&#39;ood&#39;, 7893),
     (&#39;ood&#39;, 1823),
     (&#39;id&#39;, 31015),
     (&#39;ood&#39;, 39435),
     (&#39;ood&#39;, 14496)],
    &#39;labels&#39;: [3, 8, 1, 1, 1, -1, -1, 0, -1, -1],
    &#39;scores&#39;: [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]}},
  {&#39;training&#39;: {&#39;epochs&#39;: [], &#39;best_epoch&#39;: None},
   &#39;evaluation_metrics&#39;: {&#39;accuracy&#39;: 0.1152,
    &#39;crossentropy&#39;: 2.3408010501861574},
   &#39;acquisition&#39;: {&#39;indices&#39;: [(&#39;ood&#39;, 22190),
     (&#39;ood&#39;, 49199),
     (&#39;ood&#39;, 40750),
     (&#39;ood&#39;, 33436),
     (&#39;ood&#39;, 30495),
     (&#39;ood&#39;, 57037),
     (&#39;ood&#39;, 11806),
     (&#39;id&#39;, 13194),
     (&#39;id&#39;, 33972),
     (&#39;ood&#39;, 48450)],
    &#39;labels&#39;: [-1, -1, -1, -1, -1, -1, -1, 9, 5, -1],
    &#39;scores&#39;: [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]}},
  {&#39;training&#39;: {&#39;epochs&#39;: [], &#39;best_epoch&#39;: None},
   &#39;evaluation_metrics&#39;: {&#39;accuracy&#39;: 0.0855,
    &#39;crossentropy&#39;: 2.3611250312805176},
   &#39;acquisition&#39;: {&#39;indices&#39;: [(&#39;ood&#39;, 39262),
     (&#39;id&#39;, 34937),
     (&#39;id&#39;, 15956),
     (&#39;id&#39;, 1193),
     (&#39;id&#39;, 44982),
     (&#39;id&#39;, 24303),
     (&#39;id&#39;, 30815),
     (&#39;ood&#39;, 35232),
     (&#39;ood&#39;, 36119),
     (&#39;id&#39;, 17484)],
    &#39;labels&#39;: [-1, 1, 8, 8, 9, 2, 4, -1, -1, 6],
    &#39;scores&#39;: [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]}},
  {&#39;training&#39;: {&#39;epochs&#39;: [], &#39;best_epoch&#39;: None},
   &#39;evaluation_metrics&#39;: {&#39;accuracy&#39;: 0.0985,
    &#39;crossentropy&#39;: 2.33388900718689},
   &#39;acquisition&#39;: {&#39;indices&#39;: [(&#39;ood&#39;, 19019),
     (&#39;ood&#39;, 50212),
     (&#39;ood&#39;, 25348),
     (&#39;ood&#39;, 21148),
     (&#39;ood&#39;, 21958),
     (&#39;id&#39;, 28372),
     (&#39;ood&#39;, 4170),
     (&#39;id&#39;, 40862),
     (&#39;id&#39;, 6085),
     (&#39;ood&#39;, 4347)],
    &#39;labels&#39;: [-1, -1, -1, -1, -1, 5, -1, 6, 6, -1],
    &#39;scores&#39;: [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]}},
  {&#39;training&#39;: {&#39;epochs&#39;: [], &#39;best_epoch&#39;: None},
   &#39;evaluation_metrics&#39;: {&#39;accuracy&#39;: 0.1075,
    &#39;crossentropy&#39;: 2.3253658111572264},
   &#39;acquisition&#39;: {&#39;indices&#39;: [(&#39;ood&#39;, 5177),
     (&#39;id&#39;, 46455),
     (&#39;ood&#39;, 35272),
     (&#39;ood&#39;, 22434),
     (&#39;ood&#39;, 308),
     (&#39;ood&#39;, 16607),
     (&#39;id&#39;, 50405),
     (&#39;ood&#39;, 26672),
     (&#39;ood&#39;, 12838),
     (&#39;id&#39;, 21140)],
    &#39;labels&#39;: [-1, 6, -1, -1, -1, -1, 4, -1, -1, 4],
    &#39;scores&#39;: [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]}},
  {&#39;training&#39;: {&#39;epochs&#39;: [], &#39;best_epoch&#39;: None},
   &#39;evaluation_metrics&#39;: {&#39;accuracy&#39;: 0.1254,
    &#39;crossentropy&#39;: 2.3452716808319094},
   &#39;acquisition&#39;: {&#39;indices&#39;: [(&#39;ood&#39;, 21307),
     (&#39;id&#39;, 45937),
     (&#39;id&#39;, 35010),
     (&#39;ood&#39;, 3929),
     (&#39;ood&#39;, 49439),
     (&#39;ood&#39;, 26422),
     (&#39;id&#39;, 15513),
     (&#39;ood&#39;, 12990),
     (&#39;id&#39;, 46837),
     (&#39;ood&#39;, 43248)],
    &#39;labels&#39;: [-1, 7, 3, -1, -1, -1, 7, -1, 0, -1],
    &#39;scores&#39;: [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]}},
  {&#39;training&#39;: {&#39;epochs&#39;: [], &#39;best_epoch&#39;: None},
   &#39;evaluation_metrics&#39;: {&#39;accuracy&#39;: 0.0982,
    &#39;crossentropy&#39;: 2.338535634994507},
   &#39;acquisition&#39;: {&#39;indices&#39;: [(&#39;ood&#39;, 2970),
     (&#39;id&#39;, 33981),
     (&#39;id&#39;, 17247),
     (&#39;id&#39;, 28983),
     (&#39;id&#39;, 22921),
     (&#39;id&#39;, 43607),
     (&#39;ood&#39;, 8139),
     (&#39;id&#39;, 45633),
     (&#39;id&#39;, 48652),
     (&#39;ood&#39;, 46241)],
    &#39;labels&#39;: [-1, 9, 5, 3, 7, 7, -1, 6, 8, -1],
    &#39;scores&#39;: [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]}},
  {&#39;training&#39;: {&#39;epochs&#39;: [], &#39;best_epoch&#39;: None},
   &#39;evaluation_metrics&#39;: {&#39;accuracy&#39;: 0.1139,
    &#39;crossentropy&#39;: 2.3268737857818604},
   &#39;acquisition&#39;: {&#39;indices&#39;: [(&#39;ood&#39;, 5285),
     (&#39;ood&#39;, 33865),
     (&#39;ood&#39;, 26001),
     (&#39;id&#39;, 47531),
     (&#39;ood&#39;, 11312),
     (&#39;ood&#39;, 1265),
     (&#39;id&#39;, 56554),
     (&#39;id&#39;, 16369),
     (&#39;ood&#39;, 40025),
     (&#39;id&#39;, 19670)],
    &#39;labels&#39;: [-1, -1, -1, 2, -1, -1, 5, 7, -1, 5],
    &#39;scores&#39;: [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]}},
  {&#39;training&#39;: {&#39;epochs&#39;: [], &#39;best_epoch&#39;: None},
   &#39;evaluation_metrics&#39;: {&#39;accuracy&#39;: 0.0858,
    &#39;crossentropy&#39;: 2.340250019454956},
   &#39;acquisition&#39;: {&#39;indices&#39;: [(&#39;ood&#39;, 52831),
     (&#39;ood&#39;, 22388),
     (&#39;id&#39;, 17241),
     (&#39;ood&#39;, 20468),
     (&#39;id&#39;, 22538),
     (&#39;ood&#39;, 45415),
     (&#39;id&#39;, 56063),
     (&#39;id&#39;, 20651),
     (&#39;id&#39;, 52190),
     (&#39;id&#39;, 48078)],
    &#39;labels&#39;: [-1, -1, 2, -1, 1, -1, 5, 4, 5, 5],
    &#39;scores&#39;: [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]}},
  {&#39;training&#39;: {&#39;epochs&#39;: [], &#39;best_epoch&#39;: None},
   &#39;evaluation_metrics&#39;: {&#39;accuracy&#39;: 0.1047,
    &#39;crossentropy&#39;: 2.3441019859313963},
   &#39;acquisition&#39;: {&#39;indices&#39;: [(&#39;ood&#39;, 23255),
     (&#39;id&#39;, 49078),
     (&#39;id&#39;, 34456),
     (&#39;id&#39;, 7426),
     (&#39;id&#39;, 32375),
     (&#39;ood&#39;, 28384),
     (&#39;id&#39;, 53279),
     (&#39;ood&#39;, 46297),
     (&#39;id&#39;, 23174),
     (&#39;ood&#39;, 722)],
    &#39;labels&#39;: [-1, 4, 6, 4, 8, -1, 9, -1, 4, -1],
    &#39;scores&#39;: [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]}},
  {&#39;training&#39;: {&#39;epochs&#39;: [], &#39;best_epoch&#39;: None},
   &#39;evaluation_metrics&#39;: {&#39;accuracy&#39;: 0.1025,
    &#39;crossentropy&#39;: 2.3361153217315676},
   &#39;acquisition&#39;: {&#39;indices&#39;: [(&#39;ood&#39;, 56973),
     (&#39;ood&#39;, 12847),
     (&#39;ood&#39;, 52008),
     (&#39;ood&#39;, 35025),
     (&#39;id&#39;, 14647),
     (&#39;id&#39;, 48238),
     (&#39;id&#39;, 41955),
     (&#39;id&#39;, 44784),
     (&#39;id&#39;, 37767),
     (&#39;id&#39;, 5447)],
    &#39;labels&#39;: [-1, -1, -1, -1, 9, 2, 2, 2, 4, 7],
    &#39;scores&#39;: [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]}},
  {&#39;training&#39;: {&#39;epochs&#39;: [], &#39;best_epoch&#39;: None}}]}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">experiment</span> <span class="o">=</span> <span class="n">Experiment</span><span class="p">(</span>
    <span class="n">max_training_epochs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_training_set</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">acquisition_function</span><span class="o">=</span><span class="n">AcquisitionFunction</span><span class="o">.</span><span class="n">randombaldical</span>
<span class="p">)</span>

<span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">experiment</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>

<span class="n">results</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Training set size 20:
RestoringEarlyStopping: Restoring best parameters. (Score: -6.529030114412308)
RestoringEarlyStopping: Restoring optimizer.
Perf after training {&#39;accuracy&#39;: 0.5367, &#39;crossentropy&#39;: 6.438035237884521}
RestoringEarlyStopping: Restoring best parameters. (Score: -5.1637596152722836)
RestoringEarlyStopping: Restoring optimizer.
Acquiring (label, score)s: 8 (0.8711), 8 (0.8687), 3 (0.876), 3 (0.8465), 3 (0.8811)
Training set size 25:
RestoringEarlyStopping: Restoring best parameters. (Score: -4.6851686127483845)
RestoringEarlyStopping: Restoring optimizer.
Perf after training {&#39;accuracy&#39;: 0.6256, &#39;crossentropy&#39;: 4.484497045135498}
Done.
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;initial_training_set_indices&#39;: [38043,
  40091,
  17418,
  2094,
  39879,
  3133,
  5011,
  40683,
  54379,
  24287,
  9849,
  59305,
  39508,
  39356,
  8758,
  52579,
  13655,
  7636,
  21562,
  41329],
 &#39;active_learning_steps&#39;: [{&#39;training&#39;: {&#39;epochs&#39;: [{&#39;accuracy&#39;: 0.538818359375,
      &#39;crossentropy&#39;: 6.529030114412308}],
    &#39;best_epoch&#39;: 1},
   &#39;evalution_metrics&#39;: {&#39;accuracy&#39;: 0.5367,
    &#39;crossentropy&#39;: 6.438035237884521},
   &#39;pool_training&#39;: {&#39;epochs&#39;: [{&#39;accuracy&#39;: 0.531005859375,
      &#39;crossentropy&#39;: 5.1637596152722836}],
    &#39;best_epoch&#39;: 1},
   &#39;acquisition&#39;: {&#39;indices&#39;: [63338, 10856, 63452, 81864, 109287],
    &#39;labels&#39;: [8, 8, 3, 3, 3],
    &#39;scores&#39;: [0.8710822958846325,
     0.8687216999221631,
     0.8759664372823723,
     0.8464646732511746,
     0.8810812784952251]}},
  {&#39;training&#39;: {&#39;epochs&#39;: [{&#39;accuracy&#39;: 0.62255859375,
      &#39;crossentropy&#39;: 4.6851686127483845}],
    &#39;best_epoch&#39;: 1},
   &#39;evalution_metrics&#39;: {&#39;accuracy&#39;: 0.6256,
    &#39;crossentropy&#39;: 4.484497045135498}}]}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">configs</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">UniformTargetOodExperiment</span><span class="p">(</span>
        <span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="o">+</span><span class="mi">1234</span><span class="p">,</span>
        <span class="n">acquisition_function</span><span class="o">=</span><span class="n">acquisition_functions</span><span class="o">.</span><span class="n">EvalBALD</span><span class="p">,</span>
        <span class="n">acquisition_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="n">num_pool_samples</span><span class="o">=</span><span class="n">num_pool_samples</span><span class="p">,</span>
        <span class="n">evaluation_set_size</span><span class="o">=</span><span class="n">evaluation_set_size</span><span class="p">,</span>
        <span class="n">temperature</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">seed</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">evaluation_set_size</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span><span class="mi">1000</span><span class="p">,</span><span class="mi">10000</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">num_pool_samples</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">100</span><span class="p">]</span>
<span class="p">]</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">is_run_from_ipython</span><span class="p">()</span> <span class="ow">and</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">job_id</span><span class="p">,</span> <span class="n">store</span> <span class="ow">in</span> <span class="n">embedded_experiments</span><span class="p">(</span><span class="vm">__file__</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">configs</span><span class="p">)):</span>
        <span class="n">config</span> <span class="o">=</span> <span class="n">configs</span><span class="p">[</span><span class="n">job_id</span><span class="p">]</span>
        <span class="n">config</span><span class="o">.</span><span class="n">seed</span> <span class="o">+=</span> <span class="n">job_id</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
        <span class="n">store</span><span class="p">[</span><span class="s2">&quot;config&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dataclasses</span><span class="o">.</span><span class="n">asdict</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
        <span class="n">store</span><span class="p">[</span><span class="s2">&quot;log&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">config</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">store</span><span class="o">=</span><span class="n">store</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">store</span><span class="p">[</span><span class="s2">&quot;exception&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">traceback</span><span class="o">.</span><span class="n">format_exc</span><span class="p">()</span>
            <span class="k">raise</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">configs</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>20</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">configs</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[UniformTargetOodExperiment(seed=1234, acquisition_size=10, max_training_set=450, num_pool_samples=100, num_validation_samples=20, num_training_samples=1, num_patience_epochs=3, max_training_epochs=30, training_batch_size=64, device=&#39;cuda&#39;, validation_set_size=1024, evaluation_set_size=100, validation_split_random_state=0, initial_training_set_size=20, min_samples_per_epoch=5056, mnist_repetitions=1, ood_fmnist_repetitions=1, add_dataset_noise=False, acquisition_function=&lt;class &#39;batchbald_redux.acquisition_functions.TemperedEvalBALD&#39;&gt;, train_eval_model=&lt;class &#39;batchbald_redux.train_eval_model.TrainSelfDistillationEvalModel&#39;&gt;, model_optimizer_factory=&lt;class &#39;batchbald_redux.models.MnistOptimizerFactory&#39;&gt;, acquisition_function_args=None, temperature=8),
 UniformTargetOodExperiment(seed=1234, acquisition_size=10, max_training_set=450, num_pool_samples=100, num_validation_samples=20, num_training_samples=1, num_patience_epochs=3, max_training_epochs=30, training_batch_size=64, device=&#39;cuda&#39;, validation_set_size=1024, evaluation_set_size=1000, validation_split_random_state=0, initial_training_set_size=20, min_samples_per_epoch=5056, mnist_repetitions=1, ood_fmnist_repetitions=1, add_dataset_noise=False, acquisition_function=&lt;class &#39;batchbald_redux.acquisition_functions.TemperedEvalBALD&#39;&gt;, train_eval_model=&lt;class &#39;batchbald_redux.train_eval_model.TrainSelfDistillationEvalModel&#39;&gt;, model_optimizer_factory=&lt;class &#39;batchbald_redux.models.MnistOptimizerFactory&#39;&gt;, acquisition_function_args=None, temperature=8),
 UniformTargetOodExperiment(seed=1235, acquisition_size=10, max_training_set=450, num_pool_samples=100, num_validation_samples=20, num_training_samples=1, num_patience_epochs=3, max_training_epochs=30, training_batch_size=64, device=&#39;cuda&#39;, validation_set_size=1024, evaluation_set_size=100, validation_split_random_state=0, initial_training_set_size=20, min_samples_per_epoch=5056, mnist_repetitions=1, ood_fmnist_repetitions=1, add_dataset_noise=False, acquisition_function=&lt;class &#39;batchbald_redux.acquisition_functions.TemperedEvalBALD&#39;&gt;, train_eval_model=&lt;class &#39;batchbald_redux.train_eval_model.TrainSelfDistillationEvalModel&#39;&gt;, model_optimizer_factory=&lt;class &#39;batchbald_redux.models.MnistOptimizerFactory&#39;&gt;, acquisition_function_args=None, temperature=8),
 UniformTargetOodExperiment(seed=1235, acquisition_size=10, max_training_set=450, num_pool_samples=100, num_validation_samples=20, num_training_samples=1, num_patience_epochs=3, max_training_epochs=30, training_batch_size=64, device=&#39;cuda&#39;, validation_set_size=1024, evaluation_set_size=1000, validation_split_random_state=0, initial_training_set_size=20, min_samples_per_epoch=5056, mnist_repetitions=1, ood_fmnist_repetitions=1, add_dataset_noise=False, acquisition_function=&lt;class &#39;batchbald_redux.acquisition_functions.TemperedEvalBALD&#39;&gt;, train_eval_model=&lt;class &#39;batchbald_redux.train_eval_model.TrainSelfDistillationEvalModel&#39;&gt;, model_optimizer_factory=&lt;class &#39;batchbald_redux.models.MnistOptimizerFactory&#39;&gt;, acquisition_function_args=None, temperature=8),
 UniformTargetOodExperiment(seed=1236, acquisition_size=10, max_training_set=450, num_pool_samples=100, num_validation_samples=20, num_training_samples=1, num_patience_epochs=3, max_training_epochs=30, training_batch_size=64, device=&#39;cuda&#39;, validation_set_size=1024, evaluation_set_size=100, validation_split_random_state=0, initial_training_set_size=20, min_samples_per_epoch=5056, mnist_repetitions=1, ood_fmnist_repetitions=1, add_dataset_noise=False, acquisition_function=&lt;class &#39;batchbald_redux.acquisition_functions.TemperedEvalBALD&#39;&gt;, train_eval_model=&lt;class &#39;batchbald_redux.train_eval_model.TrainSelfDistillationEvalModel&#39;&gt;, model_optimizer_factory=&lt;class &#39;batchbald_redux.models.MnistOptimizerFactory&#39;&gt;, acquisition_function_args=None, temperature=8),
 UniformTargetOodExperiment(seed=1236, acquisition_size=10, max_training_set=450, num_pool_samples=100, num_validation_samples=20, num_training_samples=1, num_patience_epochs=3, max_training_epochs=30, training_batch_size=64, device=&#39;cuda&#39;, validation_set_size=1024, evaluation_set_size=1000, validation_split_random_state=0, initial_training_set_size=20, min_samples_per_epoch=5056, mnist_repetitions=1, ood_fmnist_repetitions=1, add_dataset_noise=False, acquisition_function=&lt;class &#39;batchbald_redux.acquisition_functions.TemperedEvalBALD&#39;&gt;, train_eval_model=&lt;class &#39;batchbald_redux.train_eval_model.TrainSelfDistillationEvalModel&#39;&gt;, model_optimizer_factory=&lt;class &#39;batchbald_redux.models.MnistOptimizerFactory&#39;&gt;, acquisition_function_args=None, temperature=8),
 UniformTargetOodExperiment(seed=1237, acquisition_size=10, max_training_set=450, num_pool_samples=100, num_validation_samples=20, num_training_samples=1, num_patience_epochs=3, max_training_epochs=30, training_batch_size=64, device=&#39;cuda&#39;, validation_set_size=1024, evaluation_set_size=100, validation_split_random_state=0, initial_training_set_size=20, min_samples_per_epoch=5056, mnist_repetitions=1, ood_fmnist_repetitions=1, add_dataset_noise=False, acquisition_function=&lt;class &#39;batchbald_redux.acquisition_functions.TemperedEvalBALD&#39;&gt;, train_eval_model=&lt;class &#39;batchbald_redux.train_eval_model.TrainSelfDistillationEvalModel&#39;&gt;, model_optimizer_factory=&lt;class &#39;batchbald_redux.models.MnistOptimizerFactory&#39;&gt;, acquisition_function_args=None, temperature=8),
 UniformTargetOodExperiment(seed=1237, acquisition_size=10, max_training_set=450, num_pool_samples=100, num_validation_samples=20, num_training_samples=1, num_patience_epochs=3, max_training_epochs=30, training_batch_size=64, device=&#39;cuda&#39;, validation_set_size=1024, evaluation_set_size=1000, validation_split_random_state=0, initial_training_set_size=20, min_samples_per_epoch=5056, mnist_repetitions=1, ood_fmnist_repetitions=1, add_dataset_noise=False, acquisition_function=&lt;class &#39;batchbald_redux.acquisition_functions.TemperedEvalBALD&#39;&gt;, train_eval_model=&lt;class &#39;batchbald_redux.train_eval_model.TrainSelfDistillationEvalModel&#39;&gt;, model_optimizer_factory=&lt;class &#39;batchbald_redux.models.MnistOptimizerFactory&#39;&gt;, acquisition_function_args=None, temperature=8),
 UniformTargetOodExperiment(seed=1238, acquisition_size=10, max_training_set=450, num_pool_samples=100, num_validation_samples=20, num_training_samples=1, num_patience_epochs=3, max_training_epochs=30, training_batch_size=64, device=&#39;cuda&#39;, validation_set_size=1024, evaluation_set_size=100, validation_split_random_state=0, initial_training_set_size=20, min_samples_per_epoch=5056, mnist_repetitions=1, ood_fmnist_repetitions=1, add_dataset_noise=False, acquisition_function=&lt;class &#39;batchbald_redux.acquisition_functions.TemperedEvalBALD&#39;&gt;, train_eval_model=&lt;class &#39;batchbald_redux.train_eval_model.TrainSelfDistillationEvalModel&#39;&gt;, model_optimizer_factory=&lt;class &#39;batchbald_redux.models.MnistOptimizerFactory&#39;&gt;, acquisition_function_args=None, temperature=8),
 UniformTargetOodExperiment(seed=1238, acquisition_size=10, max_training_set=450, num_pool_samples=100, num_validation_samples=20, num_training_samples=1, num_patience_epochs=3, max_training_epochs=30, training_batch_size=64, device=&#39;cuda&#39;, validation_set_size=1024, evaluation_set_size=1000, validation_split_random_state=0, initial_training_set_size=20, min_samples_per_epoch=5056, mnist_repetitions=1, ood_fmnist_repetitions=1, add_dataset_noise=False, acquisition_function=&lt;class &#39;batchbald_redux.acquisition_functions.TemperedEvalBALD&#39;&gt;, train_eval_model=&lt;class &#39;batchbald_redux.train_eval_model.TrainSelfDistillationEvalModel&#39;&gt;, model_optimizer_factory=&lt;class &#39;batchbald_redux.models.MnistOptimizerFactory&#39;&gt;, acquisition_function_args=None, temperature=8),
 UniformTargetOodExperiment(seed=1239, acquisition_size=10, max_training_set=450, num_pool_samples=100, num_validation_samples=20, num_training_samples=1, num_patience_epochs=3, max_training_epochs=30, training_batch_size=64, device=&#39;cuda&#39;, validation_set_size=1024, evaluation_set_size=100, validation_split_random_state=0, initial_training_set_size=20, min_samples_per_epoch=5056, mnist_repetitions=1, ood_fmnist_repetitions=1, add_dataset_noise=False, acquisition_function=&lt;class &#39;batchbald_redux.acquisition_functions.TemperedEvalBALD&#39;&gt;, train_eval_model=&lt;class &#39;batchbald_redux.train_eval_model.TrainSelfDistillationEvalModel&#39;&gt;, model_optimizer_factory=&lt;class &#39;batchbald_redux.models.MnistOptimizerFactory&#39;&gt;, acquisition_function_args=None, temperature=8),
 UniformTargetOodExperiment(seed=1239, acquisition_size=10, max_training_set=450, num_pool_samples=100, num_validation_samples=20, num_training_samples=1, num_patience_epochs=3, max_training_epochs=30, training_batch_size=64, device=&#39;cuda&#39;, validation_set_size=1024, evaluation_set_size=1000, validation_split_random_state=0, initial_training_set_size=20, min_samples_per_epoch=5056, mnist_repetitions=1, ood_fmnist_repetitions=1, add_dataset_noise=False, acquisition_function=&lt;class &#39;batchbald_redux.acquisition_functions.TemperedEvalBALD&#39;&gt;, train_eval_model=&lt;class &#39;batchbald_redux.train_eval_model.TrainSelfDistillationEvalModel&#39;&gt;, model_optimizer_factory=&lt;class &#39;batchbald_redux.models.MnistOptimizerFactory&#39;&gt;, acquisition_function_args=None, temperature=8),
 UniformTargetOodExperiment(seed=1240, acquisition_size=10, max_training_set=450, num_pool_samples=100, num_validation_samples=20, num_training_samples=1, num_patience_epochs=3, max_training_epochs=30, training_batch_size=64, device=&#39;cuda&#39;, validation_set_size=1024, evaluation_set_size=100, validation_split_random_state=0, initial_training_set_size=20, min_samples_per_epoch=5056, mnist_repetitions=1, ood_fmnist_repetitions=1, add_dataset_noise=False, acquisition_function=&lt;class &#39;batchbald_redux.acquisition_functions.TemperedEvalBALD&#39;&gt;, train_eval_model=&lt;class &#39;batchbald_redux.train_eval_model.TrainSelfDistillationEvalModel&#39;&gt;, model_optimizer_factory=&lt;class &#39;batchbald_redux.models.MnistOptimizerFactory&#39;&gt;, acquisition_function_args=None, temperature=8),
 UniformTargetOodExperiment(seed=1240, acquisition_size=10, max_training_set=450, num_pool_samples=100, num_validation_samples=20, num_training_samples=1, num_patience_epochs=3, max_training_epochs=30, training_batch_size=64, device=&#39;cuda&#39;, validation_set_size=1024, evaluation_set_size=1000, validation_split_random_state=0, initial_training_set_size=20, min_samples_per_epoch=5056, mnist_repetitions=1, ood_fmnist_repetitions=1, add_dataset_noise=False, acquisition_function=&lt;class &#39;batchbald_redux.acquisition_functions.TemperedEvalBALD&#39;&gt;, train_eval_model=&lt;class &#39;batchbald_redux.train_eval_model.TrainSelfDistillationEvalModel&#39;&gt;, model_optimizer_factory=&lt;class &#39;batchbald_redux.models.MnistOptimizerFactory&#39;&gt;, acquisition_function_args=None, temperature=8),
 UniformTargetOodExperiment(seed=1241, acquisition_size=10, max_training_set=450, num_pool_samples=100, num_validation_samples=20, num_training_samples=1, num_patience_epochs=3, max_training_epochs=30, training_batch_size=64, device=&#39;cuda&#39;, validation_set_size=1024, evaluation_set_size=100, validation_split_random_state=0, initial_training_set_size=20, min_samples_per_epoch=5056, mnist_repetitions=1, ood_fmnist_repetitions=1, add_dataset_noise=False, acquisition_function=&lt;class &#39;batchbald_redux.acquisition_functions.TemperedEvalBALD&#39;&gt;, train_eval_model=&lt;class &#39;batchbald_redux.train_eval_model.TrainSelfDistillationEvalModel&#39;&gt;, model_optimizer_factory=&lt;class &#39;batchbald_redux.models.MnistOptimizerFactory&#39;&gt;, acquisition_function_args=None, temperature=8),
 UniformTargetOodExperiment(seed=1241, acquisition_size=10, max_training_set=450, num_pool_samples=100, num_validation_samples=20, num_training_samples=1, num_patience_epochs=3, max_training_epochs=30, training_batch_size=64, device=&#39;cuda&#39;, validation_set_size=1024, evaluation_set_size=1000, validation_split_random_state=0, initial_training_set_size=20, min_samples_per_epoch=5056, mnist_repetitions=1, ood_fmnist_repetitions=1, add_dataset_noise=False, acquisition_function=&lt;class &#39;batchbald_redux.acquisition_functions.TemperedEvalBALD&#39;&gt;, train_eval_model=&lt;class &#39;batchbald_redux.train_eval_model.TrainSelfDistillationEvalModel&#39;&gt;, model_optimizer_factory=&lt;class &#39;batchbald_redux.models.MnistOptimizerFactory&#39;&gt;, acquisition_function_args=None, temperature=8),
 UniformTargetOodExperiment(seed=1242, acquisition_size=10, max_training_set=450, num_pool_samples=100, num_validation_samples=20, num_training_samples=1, num_patience_epochs=3, max_training_epochs=30, training_batch_size=64, device=&#39;cuda&#39;, validation_set_size=1024, evaluation_set_size=100, validation_split_random_state=0, initial_training_set_size=20, min_samples_per_epoch=5056, mnist_repetitions=1, ood_fmnist_repetitions=1, add_dataset_noise=False, acquisition_function=&lt;class &#39;batchbald_redux.acquisition_functions.TemperedEvalBALD&#39;&gt;, train_eval_model=&lt;class &#39;batchbald_redux.train_eval_model.TrainSelfDistillationEvalModel&#39;&gt;, model_optimizer_factory=&lt;class &#39;batchbald_redux.models.MnistOptimizerFactory&#39;&gt;, acquisition_function_args=None, temperature=8),
 UniformTargetOodExperiment(seed=1242, acquisition_size=10, max_training_set=450, num_pool_samples=100, num_validation_samples=20, num_training_samples=1, num_patience_epochs=3, max_training_epochs=30, training_batch_size=64, device=&#39;cuda&#39;, validation_set_size=1024, evaluation_set_size=1000, validation_split_random_state=0, initial_training_set_size=20, min_samples_per_epoch=5056, mnist_repetitions=1, ood_fmnist_repetitions=1, add_dataset_noise=False, acquisition_function=&lt;class &#39;batchbald_redux.acquisition_functions.TemperedEvalBALD&#39;&gt;, train_eval_model=&lt;class &#39;batchbald_redux.train_eval_model.TrainSelfDistillationEvalModel&#39;&gt;, model_optimizer_factory=&lt;class &#39;batchbald_redux.models.MnistOptimizerFactory&#39;&gt;, acquisition_function_args=None, temperature=8),
 UniformTargetOodExperiment(seed=1243, acquisition_size=10, max_training_set=450, num_pool_samples=100, num_validation_samples=20, num_training_samples=1, num_patience_epochs=3, max_training_epochs=30, training_batch_size=64, device=&#39;cuda&#39;, validation_set_size=1024, evaluation_set_size=100, validation_split_random_state=0, initial_training_set_size=20, min_samples_per_epoch=5056, mnist_repetitions=1, ood_fmnist_repetitions=1, add_dataset_noise=False, acquisition_function=&lt;class &#39;batchbald_redux.acquisition_functions.TemperedEvalBALD&#39;&gt;, train_eval_model=&lt;class &#39;batchbald_redux.train_eval_model.TrainSelfDistillationEvalModel&#39;&gt;, model_optimizer_factory=&lt;class &#39;batchbald_redux.models.MnistOptimizerFactory&#39;&gt;, acquisition_function_args=None, temperature=8),
 UniformTargetOodExperiment(seed=1243, acquisition_size=10, max_training_set=450, num_pool_samples=100, num_validation_samples=20, num_training_samples=1, num_patience_epochs=3, max_training_epochs=30, training_batch_size=64, device=&#39;cuda&#39;, validation_set_size=1024, evaluation_set_size=1000, validation_split_random_state=0, initial_training_set_size=20, min_samples_per_epoch=5056, mnist_repetitions=1, ood_fmnist_repetitions=1, add_dataset_noise=False, acquisition_function=&lt;class &#39;batchbald_redux.acquisition_functions.TemperedEvalBALD&#39;&gt;, train_eval_model=&lt;class &#39;batchbald_redux.train_eval_model.TrainSelfDistillationEvalModel&#39;&gt;, model_optimizer_factory=&lt;class &#39;batchbald_redux.models.MnistOptimizerFactory&#39;&gt;, acquisition_function_args=None, temperature=8)]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

